<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="avalonia, 时代的寒流">
    <meta name="description" content="项目结构


第一项：使用codebehind
第二项：使用mvvm框架，支持windows，macos 和linux
第三项：cross-platform 支持windows，macos 和linux，ios，android，wasm
项">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>avalonia | 时代的寒流</title>
    <link rel="icon" type="image/png" href="../../../../favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="../../../../libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="../../../../libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="../../../../libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="../../../../libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="../../../../libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="../../../../css/matery.css">
<link rel="stylesheet" type="text/css" href="../../../../css/my.css">
<link rel="stylesheet" type="text/css" href="../../../../css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="../../../../libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="../../../../css/post.css">




    
        <link rel="stylesheet" type="text/css" href="../../../../css/reward.css">
    



    <script src="../../../../libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 8.1.1"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="../../../../index.html" class="waves-effect waves-light">
                    
                    <img src="../../../../medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">时代的寒流</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../index.html" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>联系</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="../../../../friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="../../../../medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">时代的寒流</div>
        <div class="logo-desc">
            
            不断寻找人生的真谛
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="../../../../index.html" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			联系
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="../../../../friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('../../../../medias/featureimages/23.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">avalonia</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2026-01-29
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p><img src="/2026/01/29/Avalonia/assets/image-20260112221236868.png" alt="image-20260112221236868"></p>
<span id="more"></span>

<p>第一项：使用codebehind</p>
<p>第二项：使用mvvm框架，支持windows，macos 和linux</p>
<p>第三项：cross-platform 支持windows，macos 和linux，ios，android，wasm</p>
<p>项目结构</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260112224345382.png" alt="image-20260112224345382"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">program.cs中的代码解释</span><br><span class="line">internal sealed class Program</span><br><span class="line">&#123;</span><br><span class="line">    [STAThread] //单线程</span><br><span class="line">    public static void Main(string[] args) =&gt; BuildAvaloniaApp()</span><br><span class="line">        .StartWithClassicDesktopLifetime(args);//启动应用程序生命周期管理</span><br><span class="line"></span><br><span class="line">    // Avalonia configuration, don&#x27;t remove; also used by visual designer.</span><br><span class="line">    public static AppBuilder BuildAvaloniaApp()</span><br><span class="line">        =&gt; AppBuilder.Configure&lt;App&gt;()//设置启动文件为APP.axaml.cs类</span><br><span class="line">            .UsePlatformDetect()//设置平台，windows，linux，macos</span><br><span class="line">            .WithInterFont()//设置字体</span><br><span class="line">            .LogToTrace();//设置日志</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mainwindow中的解释</span><br><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;这是 Avalonia UI 本身的XAML命名空间声明。这是必需的，否则文件将无法被识别为Avalonia XAML文档；</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;这是XAML语言命名空间的声明；</span><br><span class="line">        x:Class=&quot;AvaloniaApplication1.MainWindow&quot;&gt;这是上面声明的扩展（用于&#x27;x&#x27;）告诉XAML编译器在文件中找到相关联的类的位置。</span><br><span class="line">&lt;/Window&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">App.xaml代码的解释</span><br><span class="line">&lt;Application xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaAppPro1.App&quot;</span><br><span class="line">             xmlns:local=&quot;using:AvaloniaAppPro1&quot;</span><br><span class="line">             RequestedThemeVariant=&quot;Default&quot;&gt;//主题颜色，包含default,Dark,Light</span><br><span class="line">    &lt;Application.DataTemplates&gt;</span><br><span class="line">        &lt;local:ViewLocator/&gt;</span><br><span class="line">    &lt;/Application.DataTemplates&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;Application.Styles&gt;</span><br><span class="line">        &lt;FluentTheme /&gt;</span><br><span class="line">    &lt;/Application.Styles&gt;</span><br><span class="line">&lt;/Application&gt;</span><br></pre></td></tr></table></figure>

<p>App.xaml.cs解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public partial class App : Application</span><br><span class="line">&#123;</span><br><span class="line">    public override void Initialize()</span><br><span class="line">    &#123;</span><br><span class="line">        AvaloniaXamlLoader.Load(this);//加载app.axaml这个文件</span><br><span class="line">    &#125;</span><br><span class="line">	//框架加载完成，可创建窗口等操作</span><br><span class="line">    public override void OnFrameworkInitializationCompleted()</span><br><span class="line">    &#123;</span><br><span class="line">        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)//判断是否是桌面环境</span><br><span class="line">        &#123;</span><br><span class="line">            DisableAvaloniaDataAnnotationValidation();</span><br><span class="line">            desktop.MainWindow = new MainWindow</span><br><span class="line">            &#123;</span><br><span class="line">                // 为主窗口(MainView)设置数据上下文(DataContext)</span><br><span class="line">                // 这样 MainView 及其所有子控件都能访问到 MainViewModel 里的数据。绑定方式二：在xaml中生命datacontext进行绑定</span><br><span class="line">                DataContext = new MainWindowViewModel(),//绑定view和viewmodel</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        base.OnFrameworkInitializationCompleted();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void DisableAvaloniaDataAnnotationValidation()</span><br><span class="line">    &#123;</span><br><span class="line">        // Get an array of plugins to remove</span><br><span class="line">        var dataValidationPluginsToRemove =</span><br><span class="line">            BindingPlugins.DataValidators.OfType&lt;DataAnnotationsValidationPlugin&gt;().ToArray();</span><br><span class="line"></span><br><span class="line">        // remove each entry found</span><br><span class="line">        foreach (var plugin in dataValidationPluginsToRemove)</span><br><span class="line">        &#123;</span><br><span class="line">            BindingPlugins.DataValidators.Remove(plugin);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="virtual"><a href="#virtual" class="headerlink" title="virtual"></a>virtual</h2><p><code>virtual</code> 译为 “虚拟的”，在 C# 中用于修饰<strong>方法、属性、索引器或事件</strong>，核心作用是：<strong>允许子类通过 <code>override</code> 关键字重写（覆盖）基类的这个成员</strong>。</p>
<h2 id="CodeBehind-代码后置"><a href="#CodeBehind-代码后置" class="headerlink" title="CodeBehind:(代码后置)"></a>CodeBehind:(代码后置)</h2><p>代码后台文件通常具有<code>.axaml.cs</code>文件扩展名，并且通常在IDE中显示在XAML文件的下一级.在使用code-behind时，通常需要访问在XAML中定义的控件。需要通过在XAML中使用<code>Name</code>（或<code>x:Name</code>）属性为所需的控件指定名称。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Name=&quot;greetingButton&quot;&gt;Hello World&lt;/Button&gt;</span><br><span class="line"> 可以通过code-behind中自动生成的greetingButton字段访问该按钮：</span><br><span class="line"> public MainWindow()</span><br><span class="line">       &#123;</span><br><span class="line">           InitializeComponent();</span><br><span class="line">           greetingButton.Content = &quot;Goodbye Cruel World!&quot;;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<h2 id="布局控件："><a href="#布局控件：" class="headerlink" title="布局控件："></a>布局控件：</h2><p>所有控件及其属性可参考文档Avalonia Control Gallery：<a target="_blank" rel="noopener" href="https://github.com/AvaloniaUI/ControlCatalogStandalone">https://github.com/AvaloniaUI/ControlCatalogStandalone</a></p>
<p>布局控件：<a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/building-layouts/panels-overview">https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/building-layouts/panels-overview</a></p>
<p>Grid</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102527502.png" alt="image-20260111102527502"></p>
<p>StackPanel:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102607285.png" alt="image-20260111102607285"></p>
<p>DockPanel:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102648592.png" alt="image-20260111102648592"></p>
<p>WrapPanel:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102742081.png" alt="image-20260111102742081"></p>
<p>Canvas:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102809582.png" alt="image-20260111102809582"></p>
<p>UniformGrid:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111102826353.png" alt="image-20260111102826353"></p>
<h3 id="布局属性："><a href="#布局属性：" class="headerlink" title="布局属性："></a>布局属性：</h3><p><a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/building-layouts/alignment-margins-and-padding">https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/building-layouts/alignment-margins-and-padding</a></p>
<p>HorizontalAlignment和VerticalAlignment:</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111103027102.png" alt="image-20260111103027102"></p>
<p>margin与pading,Spacing之间的区别：</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111170856089.png" alt="image-20260111170856089"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111104902951.png" alt="image-20260111104902951"></p>
<p>Spacing：用来设置子元素之间的间距</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111110035976.png" alt="image-20260111110035976"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111110111108.png" alt="image-20260111110111108"></p>
<h2 id="内置控件"><a href="#内置控件" class="headerlink" title="内置控件"></a>内置控件</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/controls/builtin-controls">https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/controls/builtin-controls</a>)</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111105147266.png" alt="image-20260111105147266"></p>
<p>重点：Border:border通常用来包裹其他的控件,为其添加边框圆角背景色等视觉效果</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111105648715.png" alt="image-20260111105648715"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111110437172.png" alt="image-20260111110437172"></p>
<p>常用主题库和控件库：</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111112258778.png" alt="image-20260111112258778"></p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><p>为什么需要资源？假设现在有一个应用，界面上有很多按钮，文本框，面板等控件，你希望所有的按钮都用统一的颜色字体和圆角样式，方便后期统一调整和维护，如果每个控件都单独设置属性不仅代码冗余而且维护成本极高，这个时候资源系统就能帮你解决这些问题。通过集中声明和复用资源可以让界面的风格统一在修改样式的时候只需要修改一个地方所有引用的地方都会自动更新。（将属性值抽离出来生成资源）。</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111140459747.png" alt="image-20260111140459747"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111140544490.png" alt="image-20260111140544490"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111140850272.png" alt="image-20260111140850272"></p>
<p>第二种方式：将资源卸载文件里面，然后使用ResourceInclude来引用</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111140939143.png" alt="image-20260111140939143"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111141037096.png" alt="image-20260111141037096"></p>
<p>将资源可以存放的地方</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111141342829.png" alt="image-20260111141342829"></p>
<p>使用资源</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111141458763.png" alt="image-20260111141458763"></p>
<p>举例：</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111141546387.png" alt="image-20260111141546387"></p>
<p>资源查找顺序</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111141716966.png" alt="image-20260111141716966"></p>
<h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><p>如果我们希望统一管理控件的外观，比如所有按钮都长成一样，鼠标在悬停的时候有特殊的效果。仅仅靠资源还不够，这个时候我们就需要样式系统了。样式可以让我们批量定义控件的外观和交互逻辑及大提示的UI开发的效率和可维护性。（将控件的动态行为抽离出来）</p>
<p>声明样式</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111142644291.png" alt="image-20260111142644291"></p>
<p>引用样式</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111142735497.png" alt="image-20260111142735497"></p>
<p>样式选择器</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111142913101.png" alt="image-20260111142913101"></p>
<p>举例</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143020236.png" alt="image-20260111143020236"></p>
<p>举例引用第三方控件的样式</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143127524.png" alt="image-20260111143127524"></p>
<p>选择所有属于Button或者继承Button类型的控件</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143236786.png" alt="image-20260111143236786"></p>
<p>选择Name为NameButton的控件</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143438405.png" alt="image-20260111143438405"></p>
<p>类选择器</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143508801.png" alt="image-20260111143508801"></p>
<p>伪类选择器</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143636561.png" alt="image-20260111143636561"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143647706.png" alt="image-20260111143647706"></p>
<p>举例</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143908991.png" alt="image-20260111143908991"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111143940079.png" alt="image-20260111143940079"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111144017866.png" alt="image-20260111144017866"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111144033190.png" alt="image-20260111144033190"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111144212132.png" alt="image-20260111144212132"></p>
<p>样式的优先级（就近原则）</p>
<h2 id="控件主题"><a href="#控件主题" class="headerlink" title="控件主题"></a>控件主题</h2><h2 id="绑定（binding）"><a href="#绑定（binding）" class="headerlink" title="绑定（binding）"></a>绑定（binding）</h2><p><a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/data/data-binding/">https://docs.avaloniaui.net/zh-Hans/docs/basics/data/data-binding/</a></p>
<p>通常情况下使用数据上下文进行绑定，将view与viewmodel绑定起来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">前端的代码如何能够识别出后端的属性是通过数据上下文即datacontext实现的。</span><br><span class="line">绑定方式一：通过后端绑定</span><br><span class="line">desktop.MainWindow = new MainWindow</span><br><span class="line">        &#123;</span><br><span class="line">        //何为dataContext,实际上就是将前端xaml中的标签定义为一个类或者对象，将其与后端的对象对应起来。这样 MainView 及其所有子控件都能访问到 MainViewModel 里的数据</span><br><span class="line">        // 为主窗口(MainView)设置数据上下文(DataContext)</span><br><span class="line">            DataContext = new MainWindowViewModel(),</span><br><span class="line">        &#125;;</span><br><span class="line"> 绑定方式二：在前端xaml文件中进行绑定       </span><br><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        。。。</span><br><span class="line">        Icon=&quot;/Assets/avalonia-logo.ico&quot;</span><br><span class="line">        Title=&quot;PoetryPro&quot;</span><br><span class="line">        &lt;!--&gt;ServiceLocator已被注册为全局资源，通过ServiceLocator找到ResultViewModel&lt;--&gt;</span><br><span class="line">        DataContext=&quot;&#123;Binding ResultViewModel , Source=&#123;StaticResource ServiceLocator&#125;&#125;&quot;&gt; </span><br><span class="line"></span><br><span class="line">    &lt;StackPanel&gt;</span><br><span class="line">    &lt;Button Content=&quot;SemiAvalonia&quot;&gt;&lt;/Button&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<p>我们先在MainWIndow.axaml文件中写定义一个TextBlock控件，用于后续讲解，完整代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:vm=&quot;using:avalonia_demo.ViewModels&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;200&quot; d:DesignHeight=&quot;80&quot;</span><br><span class="line">        x:Class=&quot;avalonia_demo.Views.MainWindow&quot;</span><br><span class="line">        Title=&quot;avalonia_demo&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;StackPanel&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;hello avalonia&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>这样直接把TextBlock控件中的文本信息直接写死，会带来维护不便的问题。</p>
<p>举个例子，如果你想修改上述TextBlock的Text属性值，可以通过代码直接修改控件的属性值：先给TextBlock命个名，然后在代码中通过 Name.Text 的方式来修改值。修改的核心代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextBlock Name=&quot;TestText&quot; Text=&quot;hello avalonia&quot;&gt;&lt;/TextBlock&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestText.Text = &quot;hello avalonia new&quot;;</span><br></pre></td></tr></table></figure>


<p>这种方式既不方便，也不利于维护。avalonia中的常用做法是，给最外层的根节点-Window 设置一个对象，将Text属性与这个对象中的一个成员变量进行绑定，这个设置的对象，我们就叫数据上下文-DataContext。</p>
<p>可能这么说还是不太好理解，我们拿示例演示一下。</p>
<p>我们在App.axaml.cs文件中，找到初始化窗口的代码：desktop.MainWindow &#x3D; new MainWindow();</p>
<p>这里我们给MainWindow的DataContext（数据上下文属性）设置赋值，这个赋值对象我们取名为MainWindowViewModel，这个MainWindowViewModel的代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public class MainWindowViewModel</span><br><span class="line">&#123;</span><br><span class="line">    public string? PageDesc &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在新建MainWindow对象时，将对象的DataContext属性设置为MainWindowViewModel的实例</p>
<pre><code>public override void OnFrameworkInitializationCompleted()
{
    if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
    {
        desktop.MainWindow = new MainWindow()
        {
            // 给 MainWindow 添加数据上下文
            DataContext = new MainWindowViewModel()
			{
                PageDesc = &quot;avalonia ui&quot;
            }
        };
    }

    base.OnFrameworkInitializationCompleted();
}
</code></pre>
<p>这个MainWindowViewModel中定义了一个PageDesc的属性，属性值为”avalonia ui”，我想让这个属性中的内容，以文本的形式呈现到页面里，应该怎么做呢？</p>
<p>我们可以使用一堆花括号+Binding关键字，去指定控件属性要绑定DataContext对象的哪一个属性。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study.MainWindow&quot;</span><br><span class="line">        Title=&quot;avalonia_study&quot;&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;Binding PageDesc&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>上述代码就是指定TextBlock的Text属性，与DataContext的PageDesc属性相绑定。</p>
<p>好，让我们回过头来，看如何在MainWindow.axaml文件中，指定DataContext类型是什么，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study.MainWindow&quot;</span><br><span class="line">        xmlns:vm=&quot;clr-namespace:avalonia_study.ViewModels&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainWindowViewModel&quot;</span><br><span class="line">        Title=&quot;avalonia_study&quot;&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;Binding PageDesc&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>在WIndow节点中新加了两行代码：xmlns:vm&#x3D;”clr-namespace:avalonia_study.ViewModels”和x:DataType&#x3D;“vm:MainWindowViewModel”</p>
<p>先来看x:DataType，就是指定DataContext的数据类型是什么，前面的vm: 表示是哪个命名空间下的MainWIndowViewModel类。</p>
<p>而vm，对应的就是xmlns:vm&#x3D;“clr-namespace:avalonia_study.ViewModels” clr-namespace:后面的那个命名空间，也可以用using代替：</p>
<p>xmlns:vm&#x3D;”using:avalonia_study.ViewModels”</p>
<p>最后，我们再来介绍下CompiledBinding。当你启用编译绑定时，如果如果使用了CompiledBinding去做绑定，那么剩下的Binding关键字，会默认在后台变更成ReflectionBinding ，代码如下：</p>
<pre><code>    &lt;StackPanel&gt;
            &lt;!--使用CompiledBinding--&gt;
            &lt;TextBlock Text=&quot;{CompiledBinding PageDesc}&quot;&gt;&lt;/TextBlock&gt;
            &lt;!--这里虽然用的Binding，但是实际运行时，使用的是ReflectionBinding--&gt;
            &lt;TextBlock Text=&quot;{Binding PageDesc}&quot;&gt;&lt;/TextBlock&gt;
    &lt;/StackPanel&gt;
</code></pre>
<p><strong>设计时绑定</strong><br>我们安装了预览窗口，这个窗口的实现机制，类似于在后台的镜像环境跑了个代码，把跑出的结果呈现出来。我们可以手动在镜像环境，给窗口的DataContext属性赋值。这个机制就是设计时绑定。添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study.MainWindow&quot;</span><br><span class="line">        xmlns:vm=&quot;using:avalonia_study.ViewModels&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainWindowViewModel&quot;</span><br><span class="line">        Title=&quot;avalonia_study&quot;&gt;</span><br><span class="line">        &lt;!--设计时指定数据上下文对象--&gt;</span><br><span class="line">        &lt;Design.DataContext&gt;</span><br><span class="line">                &lt;!--这里就相当于new MainWindowViewModel()，并将对象赋给DataContext属性--&gt;</span><br><span class="line">                &lt;vm:MainWindowViewModel&gt;&lt;/vm:MainWindowViewModel&gt;</span><br><span class="line">        &lt;/Design.DataContext&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;CompiledBinding PageDesc&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>需要重点强调的是，Design.DataContext的设置，只会影响预览窗口相关的内容，代码实际跑起来之后，Design.DataContext中的内容会被舍弃，相当于没有。</p>
<p>这里我们再验证一下，给MainWindowViewModel对象的PageDesc属性赋值：</p>
<pre><code>    &lt;Design.DataContext&gt;
            &lt;vm:MainWindowViewModel&gt;
                    &lt;!--给PageDesc赋值--&gt;
                    &lt;vm:MainWindowViewModel.PageDesc&gt;test2&lt;/vm:MainWindowViewModel.PageDesc&gt;
            &lt;/vm:MainWindowViewModel&gt;
    &lt;/Design.DataContext&gt;
</code></pre>
<p>可以看到预览页面显示了test2，但是实际跑起来的时候并不是test2</p>
<p><strong>所有控件都有DataContext属性</strong><br>其实，不光上面讲的window有DataContext属性，每个控件，都有DataContext属性，我们来演示一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study.MainWindow&quot;</span><br><span class="line">        xmlns:vm=&quot;using:avalonia_study.ViewModels&quot;</span><br><span class="line">        Title=&quot;avalonia_study&quot;&gt;</span><br><span class="line">	&lt;StackPanel&gt;</span><br><span class="line">		&lt;!--x:DataType指定控件的编译时DataContext类型--&gt;</span><br><span class="line">		&lt;TextBlock x:DataType=&quot;vm:MainWindowViewModel&quot; Text=&quot;&#123;Binding PageDesc&#125;&quot;&gt;</span><br><span class="line">            &lt;TextBlock.DataContext&gt;</span><br><span class="line">                    &lt;vm:MainWindowViewModel&gt;</span><br><span class="line">                            &lt;vm:MainWindowViewModel.PageDesc&gt;test333&lt;/vm:MainWindowViewModel.PageDesc&gt;</span><br><span class="line">                    &lt;/vm:MainWindowViewModel&gt;</span><br><span class="line">            &lt;/TextBlock.DataContext&gt;</span><br><span class="line">    	&lt;/TextBlock&gt;</span><br><span class="line">	&lt;/StackPanel&gt;</span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>我们所以我们再这里单独为TextBlock单独设置了DataContext属性.</p>
<p>或者我们也可以在代码中去设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study.MainWindow&quot;</span><br><span class="line">        xmlns:vm=&quot;using:avalonia_study.ViewModels&quot;</span><br><span class="line">        Title=&quot;avalonia_study&quot;&gt;</span><br><span class="line">		&lt;StackPanel&gt;</span><br><span class="line">			&lt;!--通过Name属性定义控件名--&gt;</span><br><span class="line">			&lt;TextBlock Name=&quot;TextBlockDemo&quot; Text=&quot;&#123;ReflectionBinding PageDesc&#125;&quot;&gt;</span><br><span class="line">	    	&lt;/TextBlock&gt;</span><br><span class="line">		&lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>


<p>在MainWindow.axaml.cs文件中手动设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindow : Window</span><br><span class="line">&#123;</span><br><span class="line">    public MainWindow()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">        TextBlockDemo.DataContext = new MainWindowViewModel()</span><br><span class="line">        &#123;</span><br><span class="line">            PageDesc = &quot;test222&quot;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>讲到这里，我们提一个问题：TextBlock组件，是如何找到要绑定的DataContext的呢？它是这么一套逻辑：首先TextBlock会先找自己身上，有没有设置DataContext属性，如果找到，就用这个，如果没找到，再往上层找，找到父节点设置的DataContext（本例中是StackPanel节点），如果还没找到，接着往上找，一直找到WIndow节点设置的DataContext。官方的示意图如下：</p>
<p>右边的那个Object可以先不用管，这是mvvm中的内容，大家先理解左边的部分就行。</p>
<p>这里我们演示一下，如何让子控件找到到父控件的DataContext</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;300&quot; d:DesignHeight=&quot;110&quot;</span><br><span class="line">        Width=&quot;800&quot; Height=&quot;450&quot;</span><br><span class="line">        x:Class=&quot;avalonia_study_demo.MainWindow&quot;</span><br><span class="line">        xmlns:vm=&quot;using:avalonia_study_demo.ViewModels&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainWindowViewModel&quot;</span><br><span class="line">        Title=&quot;avalonia_study_demo1&quot;&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    &lt;!--这里指定父控件的DataContext类型--&gt;</span><br><span class="line">    &lt;StackPanel x:DataType=&quot;vm:StackPanelDataContext&quot;&gt;</span><br><span class="line">        &lt;!--这里真正为父控件的DataContext赋值--&gt;</span><br><span class="line">        &lt;StackPanel.DataContext&gt;</span><br><span class="line">            &lt;vm:StackPanelDataContext&gt;&lt;/vm:StackPanelDataContext&gt;</span><br><span class="line">        &lt;/StackPanel.DataContext&gt;</span><br><span class="line">        &lt;!--找到的DataContext就是父控件的DataContext--&gt;</span><br><span class="line">        &lt;TextBlock Text=&quot;&#123;Binding StackPageDesc&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<p>引入每个控件都有DataContext的概念之后，我们再引入一个概念：类型转化。</p>
<p>我们先定义一个StackPanel包裹TextBlock的代码：</p>
<pre><code>    &lt;StackPanel&gt;
            &lt;TextBlock&gt;&lt;/TextBlock&gt;
    &lt;/StackPanel&gt;
</code></pre>
<p>这时我们给StackPanel定义个DataContext对象：StackPanelViewModel，里面有一个PageDesc的string类型的属性。我们想将PageDesc属性，与TextBlock的Text属性进行绑定，要怎么做呢。</p>
<p>首先定义一个StackPanelViewModel，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">namespace avalonia_study.ViewModels;</span><br><span class="line">public class StackPanelViewModel</span><br><span class="line">&#123;</span><br><span class="line">    public string PageDesc &#123; get; set; &#125; = &quot;avalonia ui&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>然后我要在MainWindow的构造函数后，给StackPanel的DataContext赋值为StackPanelViewModel的对象，我需要在MainWindow.axaml文件中给StackPanel命名：</p>
<pre><code>    &lt;StackPanel Name=&quot;TestStackPanel&quot;&gt;
            &lt;TextBlock&gt;&lt;/TextBlock&gt;
    &lt;/StackPanel&gt;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindow : Window</span><br><span class="line">&#123;</span><br><span class="line">    public MainWindow()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line"></span><br><span class="line">        TestStackPanel.DataContext = new StackPanelViewModel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>好，这时StackPanel组件自身也有DataContext了。如果，我想让TexkBlock的Text属性，绑定到StackPanel的DataConetxt的PageDesc属性上，需要这么写：</p>
<pre><code>    &lt;StackPanel Name=&quot;TestStackPanel&quot;&gt;
            &lt;TextBlock Text=&quot;{Binding $parent.((vm:StackPanelViewModel)DataContext).PageDesc}&quot;&gt;&lt;/TextBlock&gt;
    &lt;/StackPanel&gt;
</code></pre>
<p>$parent是指获取父组件，因为不能确定父组件的DataContext属性是什么类型的，所以这里用了个强转，然后再获取PageDesc属性</p>
<p>这里再稍微做一点延伸：如果想获取的不是父组件的DataContext，而是其他组件的呢？可以给目标组件取个名字，通过 #名字 的形式获取，完整代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">		 &lt;StackPanel Name=&quot;TestStackPanel&quot;&gt;</span><br><span class="line">                &lt;TextBlock Name=&quot;TestBlockDemo&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                &lt;TextBlock Text=&quot;&#123;Binding #TestBlockDemo.((vm:StackPanelViewModel)DataContext).PageDesc&#125;&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public partial class MainWindow : Window</span><br><span class="line">&#123;</span><br><span class="line">    public MainWindow()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line"></span><br><span class="line">        TestBlockDemo.DataContext = new StackPanelViewModel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>在wpf中有3种方法可以将View与ViewModel连接起来。</p>
<p>1.在XAML中</p>
<p>第1步</p>
<p>将LoginViewModel的命名空间添加到LoginVIew.xaml。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:local=&quot;clr-namespace:WPF_DataContext.VIewModel&quot; </span><br></pre></td></tr></table></figure>

<p>使用UserControl的DataContext属性来分配ViewModel</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">UserControl.DataContext</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">local:LoginViewModel</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">UserControl.DataContext</span>&gt;</span></span><br><span class="line"></span><br><span class="line">使用时，xaml文件课识别后端的Message属性</span><br><span class="line"><span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">Text</span>=<span class="string">&quot;&#123;Binding Message&#125;&quot;</span> <span class="attr">HorizontalAlignment</span>=<span class="string">&quot;Center&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>

<p>2.后台代码分配</p>
<p>在这种方法中，我们将使用<em>RegisterView。 打开RegisterView</em>的代码隐藏类，即<em>RegisterView.xaml.cs</em>并设置<em>this.DataContext</em>值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.DataContext = <span class="keyword">new</span> RegisterViewModel(); <span class="comment">//利用codebehind通过datacontext将view与viewmodel进行连接</span></span><br></pre></td></tr></table></figure>

<p>您的最终 RegiserView.xaml.cs 将类似于以下代码片段，</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">RegisterView</span> : <span class="title">UserControl</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">RegisterView</span>()</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            InitializeComponent();  </span><br><span class="line">            <span class="keyword">this</span>.DataContext = <span class="keyword">new</span> RegisterViewModel();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">使用时直接如下：</span><br><span class="line">&lt;TextBlock Text=<span class="string">&quot;&#123;Binding Message&#125;&quot;</span> HorizontalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;    </span><br></pre></td></tr></table></figure>

<p>3.视图模型定位</p>
<p>ViewModelLocator 集中代码以连接View和ViewModel。这意味着它为我们提供了将 View 与 ViewModel 绑定的松耦合方式，通过这种方法，View 不需要对它所连接的 ViewModel 进行硬编码。所以基本上我们用五步方法自动化整个过程，</p>
<ul>
<li>第 1 步：确定视图，例如<em>LoginView</em>。</li>
<li>第2步：确定ViewModel，如果我们正确地遵循命名约定，那么View的名称总是以ViewModel结尾。例如 <em>LoginViewModel</em>。</li>
<li>第 3 步：从第 2 步中获得 ViewModel 类型后，您需要创建该 ViewModel 类型的实例。</li>
<li>第 4 步：创建一个 ViewModel 实例</li>
<li>第 5 步：设置视图的 DataContext。</li>
</ul>
<p>所有这些步骤都发生在运行时，这就是为什么 View 在编译时不必担心它的 ViewModel 绑定。</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111162735106.png" alt="image-20260111162735106"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111162847865.png" alt="image-20260111162847865"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111162812088.png" alt="image-20260111162812088"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111162907763.png" alt="image-20260111162907763"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111162957224.png" alt="image-20260111162957224"></p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260111163008310.png" alt="image-20260111163008310"></p>
<p>样式绑定：</p>
<p>绑定到控件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextBox Name=&quot;other&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 绑定到命名为 other 控件的 Text 属性 --&gt;</span><br><span class="line">&lt;TextBlock Text=&quot;&#123;Binding #other.Text&#125;&quot;/&gt;</span><br><span class="line"></span><br><span class="line">绑定到祖先控件</span><br><span class="line">&lt;Border Tag=&quot;Hello World!&quot;&gt;</span><br><span class="line">  &lt;TextBlock Text=&quot;&#123;Binding $parent.Tag&#125;&quot;/&gt;</span><br><span class="line">&lt;/Border&gt;</span><br></pre></td></tr></table></figure>

<p>转换器绑定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;</span><br><span class="line">    &lt;local:MyConverter x:Key=&quot;converter1&quot;/&gt;</span><br><span class="line">&lt;/Window.Resources&gt;</span><br><span class="line"> </span><br><span class="line">&lt;TextBlock Text=&quot;&#123;Binding Value, Converter=&#123;StaticResource converter1&#125;&#125;&quot;/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="行为（behavior）"><a href="#行为（behavior）" class="headerlink" title="行为（behavior）"></a>行为（behavior）</h2><p>behavior是通过事件去调整前端其他控件的行为，而以往是通过事件调用后端的方法。例如点击按钮触发抽屉栏</p>
<p>比如你有 10 个 Button 都需要 “点击后禁用 5 秒” 的逻辑，用<code>Click</code>事件需要写 10 次重复代码（或调用公共方法），而用 Behavior 只需封装一次，然后在 10 个 Button 上附加该行为即可，大幅减少冗余代码。</p>
<ol>
<li><code>ICommand</code> 是 MVVM 模式的核心组成部分，它的唯一职责是将页面上的用户交互（如按钮点击、列表选择）对应的「业务逻辑」封装在 ViewModel 中，完全与视图（View）解耦。它关注的是「用户操作后要执行什么业务功能」（比如提交表单、查询数据、删除记录、导航页面），不关心视图控件的状态变化，也不包含任何与 UI 相关的逻辑。</li>
</ol>
<p>​	ICommand的主要功能：</p>
<p>​	（1）按钮点击后<strong>提交表单数据</strong>到服务器；</p>
<p>​	（2）列表项点击后<strong>查询该项目的详情数据</strong>；</p>
<p>​	（3）删除按钮点击后<strong>删除选中的数据记录</strong>并更新列表；</p>
<p>​	（4）保存按钮点击后<strong>校验表单数据合法性</strong>并持久化到本地；</p>
<p>​	（5）导航按钮点击后<strong>跳转到指定页面</strong>（导航逻辑若涉及业务参数，也归属业务逻辑）。</p>
<ol start="2">
<li><p>Behavior:它关注的是「用户如何与控件进行交互，以及交互过程中控件的 UI 状态如何变化」（比如按钮点击后延迟 5 秒禁用、输入框回车触发提交、鼠标拖拽控件、双击列表项触发事件），不关心后续的业务功能，也不包含任何与业务相关的逻辑。<strong>(总结</strong>：前者操作的是viewmodel层，而后者操作的是view层)。</p>
<p>Behavior的主要功能：</p>
<p>（1）按钮点击后<strong>禁用自身 5 秒</strong>（防止重复点击）；</p>
<p>（2）输入框输入完成后<strong>按下回车键触发提交</strong>；</p>
<p>（3）列表控件<strong>双击项</strong>（而非单击）触发事件；</p>
<p>（4）鼠标<strong>拖拽控件</strong>改变其位置或大小；</p>
<p>（5）文本框<strong>输入内容时实时限制输入长度</strong>并改变边框颜色。</p>
</li>
</ol>
<p>使用方法：<a target="_blank" rel="noopener" href="https://www.php.cn/faq/1893927.html">https://www.php.cn/faq/1893927.html</a></p>
<p>1.nuget安装 Avalonia.Xaml.Behaviors</p>
<p>2.加入声明</p>
<p>xmlns:i&#x3D;”using:Avalonia.Xaml.Interactivity”<br>xmlns:ia&#x3D;”using:Avalonia.Xaml.Interactions.Core”</p>
<ol start="3">
<li>使用，支持的常见事件名包括<strong>Click</strong>、<strong>Loaded</strong>、<strong>Unloaded</strong>、<strong>PointerPressed</strong>、<strong>PointerReleased</strong>、<strong>LostFocus</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;button content=&quot;保存&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;interactivity:interaction.behaviors&gt;</span><br><span class="line"></span><br><span class="line">    &lt;behaviors:eventtriggerbehavior eventname=&quot;Click&quot;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;behaviors:invokecommandaction command=&quot;&#123;Binding SaveCommand&#125;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/behaviors:invokecommandaction&gt;&lt;/behaviors:eventtriggerbehavior&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/interactivity:interaction.behaviors&gt;</span><br><span class="line"></span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p><strong>使用场景：</strong>（1）页面初次打开时，自动加载数据库中的数据</p>
<p>​            （2）构建事件与命令之间的关联，一个事件对应哪个命令</p>
</li>
</ol>
<p>适合初始化数据、设置状态等场景：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;grid&gt;</span><br><span class="line"></span><br><span class="line">  &lt;interactivity:interaction.behaviors&gt;</span><br><span class="line"></span><br><span class="line">    &lt;behaviors:loadedtrigger&gt;</span><br><span class="line"></span><br><span class="line">      &lt;behaviors:invokecommandaction command=&quot;&#123;Binding LoadCommand&#125;&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/behaviors:invokecommandaction&gt;&lt;/behaviors:loadedtrigger&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/interactivity:interaction.behaviors&gt;</span><br><span class="line"></span><br><span class="line">&lt;/grid&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>自定义行为，例如TextBox 在 <code>IsVisible=true</code> 时自动聚焦并全选</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class FocusOnVisibleBehavior : Behavior&lt;textbox&gt;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    protected override void OnAttached()</span><br><span class="line">    &#123;</span><br><span class="line">        base.OnAttached();</span><br><span class="line">        AssociatedObject?.PropertyChanged += OnPropertyChanged;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&lt;button class=&quot;copy-button&quot;&gt;复制&lt;/button&gt;&lt;button class=&quot;copy-button&quot; style=&quot;margin-left: 5px; margin-right: 5px;&quot;&gt;AI写代码&lt;/button&gt;&lt;pre class=&quot;brush:php;toolbar:false;&quot;&gt;</span><br><span class="line"></span><br><span class="line">private void OnPropertyChanged(object sender, AvaloniaPropertyChangedEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    if (e.Property == Visual.IsVisibleProperty &amp;&amp; AssociatedObject?.IsVisible == true)</span><br><span class="line">    &#123;</span><br><span class="line">        AssociatedObject.Focus();</span><br><span class="line">        AssociatedObject.SelectAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected override void OnDetaching() =&gt; </span><br><span class="line">    AssociatedObject?.PropertyChanged -= OnPropertyChanged;&lt;/pre&gt;&lt;p&gt;&#125;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">XAML中直接引用</span><br><span class="line">&lt;!-- xmlns:local=&quot;using:YourApp.Behaviors&quot; --&gt;</span><br><span class="line">&lt;button class=&quot;copy-button&quot;&gt;复制&lt;/button&gt;&lt;button class=&quot;copy-button&quot; style=&quot;margin-left: 5px; margin-right: 5px;&quot;&gt;</span><br><span class="line">AI写代码</span><br><span class="line">&lt;/button&gt;</span><br><span class="line">&lt;textbox local:focusonvisiblebehavior.attached=&quot;True&quot;&gt;&lt;/textbox&gt;</span><br><span class="line">不复杂但容易忽略：行为只在控件生命周期内有效，确保 ViewModel 中的命令是 ICommand类型（推荐用[RelayCommand]）</span><br><span class="line">&lt;/textbox&gt;</span><br></pre></td></tr></table></figure>



<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1971290721341399380">Avalonia 09: 应用程序生命周期 - 知乎</a></p>
<p>Avalonia 应用程序的生命周期大体分为以下阶段：</p>
<ul>
<li><strong>启动</strong>：Program.Main()，应用程序入口。配置 AppBuilder 并启动应用；</li>
<li><strong>框架初始化</strong>：App.Initialize()，加载 <a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=266214237&content_type=Article&match_order=1&q=XAML&zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3Njg0NTY1ODIsInEiOiJYQU1MIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjY2MjE0MjM3LCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.MpekC7S7ZJ-fbrJrv1h_1zhvgx9fdjtc-ic1IELSYVM&zhida_source=entity">XAML</a>、注册全局资源、主题等；</li>
<li><strong>应用启动</strong>： App.OnFrameworkInitializationCompleted()，框架准备完成，可创建主窗口（MainWindow）;</li>
<li><strong>运行中</strong>：UI 线程循环，响应事件、绑定数据、用户交互;</li>
<li><strong>退出</strong>：Window.Closing &#x2F; App.Shutdown()，用户关闭窗口或主动退出。执行清理逻辑</li>
</ul>
<p>Window的生命周期是指Window从创建到销毁的整个过程，包括初始化、显示、激活、关闭等状态。</p>
<h2 id="资产"><a href="#资产" class="headerlink" title="资产"></a>资产</h2><p><a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/assets">https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/assets</a></p>
<p>Avalonia .NET Core MVVM应用程序解决方案模板会创建一个名为<code>Assets</code>的文件夹（包含<code>avalonia-logo.ico</code>文件），并在项目文件中添加一个元素来包含其中的任何文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;ItemGroup&gt;</span><br><span class="line">  &lt;AvaloniaResource Include=&quot;Assets\**&quot;/&gt;</span><br><span class="line">&lt;/ItemGroup&gt;</span><br><span class="line">引用资产</span><br><span class="line">&lt;Image Source=&quot;icon.png&quot;/&gt;</span><br><span class="line">&lt;Image Source=&quot;images/icon.png&quot;/&gt;</span><br><span class="line">&lt;Image Source=&quot;../icon.png&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="无限滚动"><a href="#无限滚动" class="headerlink" title="无限滚动"></a>无限滚动</h2><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>需要解决的问题？</p>
<p>我们定义下这个控件</p>
<pre><code>    &lt;StackPanel&gt;
            &lt;TextBox Margin=&quot;10&quot; Text=&quot;{Binding PageDesc}&quot;&gt;&lt;/TextBox&gt;
    &lt;/StackPanel&gt;
</code></pre>
<p>TextBox是定义了一个文本输入框，其中的Text属性指的是文本框中输入的内容。</p>
<p>之前我们提到过，每个控件都有自己默认的一个Binding Mode，TextBox的Mode属性是TwoWay，也就是说控件的Text属性与绑定的PageDesc属性，相互影响，一个属性改变之后，另一个属性也会跟着变。</p>
<p>我们为了验证这个结论，将MainWindowViewModel的属性更改一下，让属性变更的时候打印新值到控制台：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line"></span><br><span class="line">namespace avalonia_study.ViewModels;</span><br><span class="line"></span><br><span class="line">public class MainWindowViewModel</span><br><span class="line">&#123;</span><br><span class="line">    private string? _pageDesc;</span><br><span class="line"></span><br><span class="line">    public string? PageDesc</span><br><span class="line">    &#123;</span><br><span class="line">        get =&gt; _pageDesc;</span><br><span class="line">        set</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;new PageDesc is:&quot; + value);</span><br><span class="line">            _pageDesc = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">我们把代码运行起来，修改TextBox控件中的文本（也就是控件的Text属性修改），你会发现控制台打印了相关内容，所以我们可以得出结论：当控件的Text文本修改的时候，DataContext对应绑定的属性也会同步修改。（说明前端的view中的数值修改，则viewmodel中的也会随之发生变化）</span><br></pre></td></tr></table></figure>

<p>接下来我们想验证MainWindowViewModel的属性修改时，TextBox中的Text属性也会同步修改。为了验证这么一个场景，我们设计如下场景：引入一个按钮，当点击按钮的时候，MainWindowViewModel的PageDesc属性加个a字符。代码如下：</p>
<pre><code>    &lt;StackPanel&gt;
            &lt;TextBox Margin=&quot;10&quot; Text=&quot;{Binding PageDesc}&quot;&gt;&lt;/TextBox&gt;
            &lt;!--引入一个按钮控件，并绑定点击事件--&gt;
            &lt;Button Click=&quot;Button_OnClick&quot;&gt;&lt;/Button&gt;
    &lt;/StackPanel&gt;
</code></pre>
<p>MainWindow中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindow : Window</span><br><span class="line">&#123;</span><br><span class="line">    public MainWindow()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void Button_OnClick(object? sender, RoutedEventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        // 改变MainWindow的DataContext的PageDesc属性</span><br><span class="line">        ((MainWindowViewModel)DataContext).PageDesc += &#x27;a&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>然而让人悲伤的是，似乎PageDesc的属性变动，并没有影响到TextBox的Text属性（说明viewmodel中的值发生变化并未引起xaml中的值发生变化，即仍然为单单向绑定）。原因是什么呢？</p>
<p>这里当PageDesc属性变动时，并没有“通知”与这个属性绑定的控件属性。所以在这里，我们需要引入一个通知的机制。因此我们将MainWindowViewModel中的代码改造如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line"></span><br><span class="line">namespace avalonia_study.ViewModels;</span><br><span class="line"></span><br><span class="line">// INotifyPropertyChanged 是 .NET 提供的一个接口，类可以实现该接口以表示属性已更改其值。</span><br><span class="line">public class MainWindowViewModel: INotifyPropertyChanged</span><br><span class="line">&#123;</span><br><span class="line">    // 因实现接口引入的PropertyChangedEventHandler</span><br><span class="line">    public event PropertyChangedEventHandler? PropertyChanged;</span><br><span class="line">    private string? _pageDesc;</span><br><span class="line">    public string? PageDesc</span><br><span class="line">    &#123;</span><br><span class="line">        get =&gt; _pageDesc;</span><br><span class="line">        set</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(&quot;new PageDesc is:&quot; + value);</span><br><span class="line">            _pageDesc = value;</span><br><span class="line">            // 广播通知所有的绑定者，告诉它们数据已经改变</span><br><span class="line">            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(nameof(PageDesc)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>通过PropertyChanged?.Invoke方法，通知绑定了PageDesc的控件，PageDesc的值已经变更，你们跟着同步变。这下我们再运行代码尝试，会发现已经实现了我们期望的功能。</p>
<p>好，接下啦我们看下如何简化上面的代码。引入一个第三方的工具包：CommunityToolkit.Mvvm。将上面的代码修改如下：</p>
<p>using CommunityToolkit.Mvvm.ComponentModel;</p>
<p>namespace avalonia_study.ViewModels;</p>
<p>public partial class MainWindowViewModel: ObservableObject<br>{<br>    [ObservableProperty]<br>    private string? _pageDesc;&#x2F;&#x2F;注意，使用ObservableProperty特性时，属性必须首字母小写或者使用下划线开头<br>}</p>
<p>使用 MVVM Toolkit 简化 INotifyPropertyChanged,通过使用其 <code>ObservableObject</code> 类以及 Source Generators 功能结合 <code>[ObservableProperty]</code> Attribute.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"></span><br><span class="line">public partial class MyViewModel : ObservableObject</span><br><span class="line">&#123;</span><br><span class="line">    [ObservableProperty]</span><br><span class="line">    private string _name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们再说下Command模式。之前我们定义Button的点击操作，是在Click里面去做的。也可以用Command的形式去做，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Command=&quot;&#123;Binding AddItem&#125;&quot;&gt;add&lt;/Button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public partial class MainWindowViewModel: ObservableObject</span><br><span class="line">&#123;</span><br><span class="line">    [ObservableProperty]</span><br><span class="line">    private string? _pageDesc = &quot;abcd&quot;;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    [RelayCommand]</span><br><span class="line">    public void AddItem()</span><br><span class="line">    &#123;</span><br><span class="line">        PageDesc += &#x27;a&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里先解答大家可能会有的两个疑问：</p>
<p>为什么用command和click的效果看着是一样的？</p>
<p>通过查看源码发现，Click中调用了Command方法</p>
<p>既然两者一样，那我为什么不用click而要用command，click看着还更简单诶</p>
<p>个人关于这块的理解是：有时候一个窗口或控件，会绑定不同的DataContext，如果用click，还需要对DataContext的类型做判断后，采用不同的逻辑</p>
<h2 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h2><p>用到了ViewLocator，参考张引的视频，博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18976504">Avalonia 学习笔记04. Page Navigation（页面导航） - simonoct - 博客园</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        &lt;!--当Content发生变化时就会显示Content页面，注意：根据RootNavigationService内部的原理，Binding Content中的Content实际上是个ViewModel，</span><br><span class="line">        所以要想显示页面，在RootNavigationService中去不断改变Content，引起属性变化</span><br><span class="line">        avalonia 中 ContentControl 会自动将 Content 作为自身 DataContext，一旦content发生变化，此时框架会触发ServiceLocator中滚动 Match 方法，然后是build方法，将ViewModel转换为对应的View，最终显示在ContentControl中--&gt;</span><br><span class="line">        &lt;!--当前页面需要嵌套另一个页面就使用ContentControl控件，控件中的Content属性相当于当前ContentControl的datacontext，对应的是其他的ViewModel，这样如果绑定到不同的页面我们只需要改变Content即可--&gt;</span><br><span class="line">        &lt;ContentControl Content=&quot;&#123;Binding Content&#125;&quot;&gt;</span><br><span class="line">			</span><br><span class="line">        &lt;/ContentControl&gt;</span><br><span class="line">        </span><br><span class="line">后端的</span><br></pre></td></tr></table></figure>



<h2 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h2><p><a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/guides/data-binding/how-to-create-a-custom-data-binding-converter">https://docs.avaloniaui.net/zh-Hans/docs/guides/data-binding/how-to-create-a-custom-data-binding-converter</a></p>
<p><strong>转换器</strong> 是一个实现了特定接口的类，它的核心作用是：<strong>在数据绑定过程中，对源数据和目标控件之间的数值进行双向或单向的格式转换</strong>。当源数据的类型 ≠ 控件需要的类型时，就使用转换器。比如：源数据是布尔值 <code>true/false</code>，但控件（如 Button）需要的是 <code>Visibility</code> 枚举（Visible&#x2F;Collapsed）。</p>
<h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><p>单值转换器（IValueConverter）和多值转换器（IMultiValueConverter）</p>
<h4 id="常见使用场景（通过转换器实现映射关系）"><a href="#常见使用场景（通过转换器实现映射关系）" class="headerlink" title="常见使用场景（通过转换器实现映射关系）"></a>常见使用场景（通过转换器实现映射关系）</h4><ol>
<li><strong>类型转换</strong>：bool ↔ Visibility、int ↔ string、DateTime ↔ 格式化字符串（如 “2026-01-23”）。将布尔值转换为颜色：true-&gt;绿色，false-&gt;红色</li>
<li><strong>值映射</strong>：数字枚举（如 0&#x2F;1&#x2F;2）↔ 文字描述（“未开始”&#x2F;“进行中”&#x2F;“已完成”）。</li>
<li><strong>条件判断</strong>：根据数值范围显示不同样式 &#x2F; 文本（如数值 &gt; 100 显示 “超标”，否则显示 “正常”）。</li>
</ol>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p>Avalonia 中所有转换器都需要实现 <code>IValueConverter</code> 接口，这个接口包含两个核心方法：</p>
<ol>
<li><p><code>Convert</code>：从<strong>源数据 → 目标控件</strong>的转换（最常用）。</p>
</li>
<li><p><code>ConvertBack</code>：从<strong>目标控件 → 源数据</strong>的转换（双向绑定时使用）。</p>
<p>举例：一个Button控件，当实现 “布尔值为 true 时控件显示，false 时隐藏”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 自定义转换器：布尔值 → Visibility</span><br><span class="line">public class BoolToVisibilityConverter : IValueConverter</span><br><span class="line">&#123;</span><br><span class="line">    // 源数据（bool）→ 目标控件（Visibility）</span><br><span class="line">    public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture)</span><br><span class="line">    &#123;</span><br><span class="line">        // 校验输入值是否为bool类型</span><br><span class="line">        if (value is bool boolValue)</span><br><span class="line">        &#123;</span><br><span class="line">            // true → Visible（显示），false → Collapsed（隐藏且不占空间）</span><br><span class="line">            return boolValue ? Visibility.Visible : Visibility.Collapsed;</span><br><span class="line">        &#125;</span><br><span class="line">        // 非bool值默认隐藏</span><br><span class="line">        return Visibility.Collapsed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 目标控件 → 源数据（双向绑定时用，这里不需要则返回null）</span><br><span class="line">    public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)</span><br><span class="line">    &#123;</span><br><span class="line">        if (value is Visibility visibility)</span><br><span class="line">        &#123;</span><br><span class="line">            return visibility == Visibility.Visible;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 XAML 中使用转换器</p>
<ol>
<li><p>先在 XAML 中引入转换器所在的命名空间:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:converters=&quot;using:YourApp.Converters&quot;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>注册声明转换器实例</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window.Resources&gt;  </span><br><span class="line">	&lt;converters:BoolToVisibilityConverter x:Key=&quot;BoolToVisibility&quot;/&gt; &lt;/Window.Resources&gt;</span><br></pre></td></tr></table></figure>

<p>3.在绑定中使用转换器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Content=&quot;测试按钮&quot;</span><br><span class="line">        Visibility=&quot;&#123;Binding IsShowButton, Converter=&#123;StaticResource BoolToVisibility&#125;&#125;&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/689871389">WPF打包成单个可执行的exe文件 - 知乎</a></p>
<h2 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h2><p><strong>1.设置窗口大小</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window 。。。</span><br><span class="line">		//设置预览时窗口大小</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;400&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">       。。。</span><br><span class="line">        Title=&quot;AvaloniaProTest2&quot;</span><br><span class="line">        //设置程序运行时窗口大小</span><br><span class="line">        Width=&quot;400&quot;</span><br><span class="line">        Height=&quot;450&quot;&gt;</span><br></pre></td></tr></table></figure>



<p><strong>2.调试代码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">using Avalonia.Interactivity;</span><br><span class="line">using System.Diagnostics;</span><br><span class="line">在方法中加入下面一句</span><br><span class="line">Debug.WriteLine($&quot;Click! Celsius=&#123;Celsius.Text&#125;&quot;);</span><br></pre></td></tr></table></figure>

<p><strong>3.Partial的作用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如App.axaml文件最终会将其编译为一个App的类，而App.axaml.cs最终也会编译为一个App类，这样就会类名重复，导致报错，因此使用Partial指明最终将这两个文件编译为同一个App类.</span><br></pre></td></tr></table></figure>

<p><strong>4.null与“”与String.empty的区别</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">null 它不是一个有效的字符串实例，意味着该变量在堆内存中没有对应的内存空间分配</span><br><span class="line">&quot;&quot;  它表示一个有效的字符串实例，只是这个实例的内容为空（长度为 0，不含任何字符）。</span><br><span class="line">String.empty其本质就是一个内容为空的字符串实例（长度为 0），与“”本质一样</span><br><span class="line">举例</span><br><span class="line">string strNull = null;</span><br><span class="line">string strEmpty1 = &quot;&quot;;</span><br><span class="line">string strEmpty2 = string.Empty;</span><br><span class="line"></span><br><span class="line">// 报错：NullReferenceException，null 没有对应的实例，无法调用 Length 属性</span><br><span class="line">int length1 = strNull.Length;</span><br><span class="line">// 正常执行，返回 0（空字符串的长度为 0）</span><br><span class="line">int length2 = strEmpty1.Length; // 0</span><br><span class="line">int length3 = strEmpty2.Length; // 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">为什么定义字符串变量时需要给它指定为空字符串？</span><br><span class="line">1.如果默认将字符串设为 null，为了保证程序健壮性，你在使用该字符串的任何地方，都必须先添加 null 判断逻辑（if (str != null)），否则就有抛出异常的风险。</span><br><span class="line"></span><br><span class="line">变量默认设为 null（冗余且繁琐）：</span><br><span class="line">string str = null; // 默认null</span><br><span class="line">// 使用前必须先做null检查，否则可能报错</span><br><span class="line">if (str != null &amp;&amp; str.Length &gt; 5) </span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;字符串长度大于5&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.变量默认设为空字符串（简洁且高效）：</span><br><span class="line">string str = string.Empty; // 默认空字符串</span><br><span class="line">// 无需null检查，直接使用，逻辑更简洁</span><br><span class="line">if (str.Length &gt; 5) </span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(&quot;字符串长度大于5&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">如果不给字符串变量指定默认值会怎么样？</span><br><span class="line">1.如果是在方法、if 代码块、for 循环等内部声明的局部字符串变量，只声明不手动赋值（「什么也不写」），编译阶段就会报错，无法通过编译，更无法运行。</span><br><span class="line">public void TestMethod()</span><br><span class="line">&#123;</span><br><span class="line">    // 只声明局部字符串变量，不手动赋值（什么也不写）</span><br><span class="line">    string str; </span><br><span class="line">    </span><br><span class="line">    // 尝试使用该变量（即使只是打印）</span><br><span class="line">    Console.WriteLine(str); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.如果是在类或结构体中声明的字符串成员变量（字段），只声明不手动赋值（「什么也不写」），编译可以通过，且会被编译器自动初始化为 null</span><br><span class="line">// 定义一个类</span><br><span class="line">public class TestClass</span><br><span class="line">&#123;</span><br><span class="line">    // 只声明字符串成员变量，不手动赋值（什么也不写）</span><br><span class="line">    public string str; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 调用测试</span><br><span class="line">public void Test()</span><br><span class="line">&#123;</span><br><span class="line">    TestClass testObj = new TestClass();</span><br><span class="line">    // 打印成员变量str的值，结果为 null</span><br><span class="line">    Console.WriteLine(testObj.str == null); // 输出：True</span><br><span class="line">    Console.WriteLine(testObj.str); // 控制台打印：空行（控制台输出null字符串时显示为空）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5.record关键字与class的区别</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.声明record时（默认等价于record class），对象实例创建后无法修改其属性值，天生具备线程安全和数据一致性的优势。</span><br><span class="line">// 简化声明</span><br><span class="line">public record Person(string Name, int Age);</span><br><span class="line"></span><br><span class="line">// 完整声明（显式指定属性）</span><br><span class="line">public record Student</span><br><span class="line">&#123;</span><br><span class="line">    public string StudentId &#123; get; init; &#125; // init设置器，仅初始化时可赋值</span><br><span class="line">    public string Name &#123; get; init; &#125;</span><br><span class="line">    public int Grade &#123; get; init; &#125;</span><br><span class="line">&#125;</span><br><span class="line">var person = new Person(&quot;张三&quot;, 28);</span><br><span class="line">person.Name = &quot;李四&quot;; // 编译错误：无法对init只写属性赋值</span><br><span class="line"></span><br><span class="line">2.基于值的相等性判断（而非引用相等性）</span><br><span class="line">普通class的相等性（==、Equals()）默认判断引用地址是否相同（即是否为同一个对象），而record默认重写了Object.Equals()、==、!=等方法，相等性判断基于所有属性的值是否完全一致，与对象引用无关。</span><br></pre></td></tr></table></figure>

<p><strong>6.项目分层</strong></p>
<p>UI层调用ViewModel层，ViewModel层调用Service层</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260115075922291.png" alt="image-20260115075922291"></p>
<p>（1）.Dao层&#x3D;Business层<br>DAO（Data Access Object） 模型就是写一个类，把访问数据库的代码封装起来，DAO在数据库与业务逻辑（Service）之间。</p>
<p>Dao是数据访问层，Dao的作用是封装对数据库的访问：增删改查，不涉及业务逻辑，只是达到按某个条件获得指定数据的要求。</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260114201557134.png" alt="image-20260114201557134"></p>
<p>（2）.Entity层<br>Entity层，顾名思义就是实体层，放置一个个实体，及其相应的set、get方法。如果想要对数据库进行一些操作（比如说读取）的话，就要先写entity层。</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260114201730375.png" alt="image-20260114201730375"></p>
<p>（3.）Service层</p>
<p>Service被称作业务逻辑层。顾名思义，它处理逻辑上的业务，而不去考虑具体的实现。</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260114201829847.png" alt="image-20260114201829847"></p>
<p>（4）Controller层&#x3D;ViewModel层</p>
<p>（5）UI层&#x3D;Page层&#x3D;View层</p>
<p><strong>7.const与static readonly的区别</strong></p>
<p>两者都可以表示常量，const是程序编译时确定，而static readonly是程序运行是确定。const可以使用static readonly替代，但后者不能被const替代。</p>
<ol start="8">
<li><strong>可空合并运算符</strong>（<code>??</code>）和<strong>可空合并赋值运算符</strong>（<code>??=</code>）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1. </span><br><span class="line">?? 是一个二元运算符，核心功能是：判断左侧操作数是否为 null，如果不为 null，则返回左侧操作数；如果为 null，则返回右侧操作数。</span><br><span class="line">它的本质是简化 if (x != null) return x; else return y;</span><br><span class="line">// 传统if判断（冗余）</span><br><span class="line">string str = null;</span><br><span class="line">string result;</span><br><span class="line">if (str != null)</span><br><span class="line">&#123;</span><br><span class="line">    result = str;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    result = &quot;默认字符串&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 合并运算符写法（简洁）</span><br><span class="line">string result = str ?? &quot;默认字符串&quot;;</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">??= 是 ?? 的衍生运算符，核心功能是：判断左侧变量是否为 null，如果为 null，则将右侧操作数的值赋值给左侧变量；如果不为 null，则不执行任何操作（保持左侧变量原有值）</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p><strong>&#x3D;&gt;</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">举例</span><br><span class="line">get=&gt; _massage 等价于</span><br><span class="line">get（）</span><br><span class="line">&#123;</span><br><span class="line">  return _massage//有返回值</span><br><span class="line">&#125;</span><br><span class="line">举例2</span><br><span class="line">public async Task InsertAsync() =&gt;</span><br><span class="line">    await _poetryStorage.InsertAsync( new Poetry &#123; Name = &quot;Name&quot; + new Random().Next() &#125;);</span><br><span class="line">等价于</span><br><span class="line">public async Task InsertAsync()</span><br><span class="line">	&#123;</span><br><span class="line">		var  =  new Poetry();</span><br><span class="line">		poetry.Name=&quot;Name&quot; + new Random().Next();</span><br><span class="line">    	await _poetryStorage.InsertAsync(poetry);//无返回值</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>10.服务定位</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_47896156/article/details/129719053">https://blog.csdn.net/weixin_47896156/article/details/129719053</a></p>
<p>当你已经手动创建并初始化好了某个对象，希望将其放入 DI 容器中，<strong>让整个应用共享该实例</strong>（例如：预配置的第三方客户端、<strong>全局配置对象</strong>）。</p>
<p>使用<code>ServiceCollection</code>的<code>AddSingleton&lt;T&gt;(T instance)</code>方法，直接将现成实例注册为单例</p>
<p>第二种方法</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260118133248119.png" alt="image-20260118133248119"></p>
<p>**11.**x:DataType&#x3D;”vm:MainWindowViewModel”是用来检测是否能够进行绑定的。</p>
<p><strong>12.通过反射获取项目中的资源文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DbName=“文件名”</span><br><span class="line">typeof(类名).Assembly.GetName().Name.ToString()+&quot;.&quot;+DbName)</span><br></pre></td></tr></table></figure>

<p><strong>13.文件中改类名或者变量名</strong>，使用ctrl+R统一修改</p>
<p><strong>14.某个方法中调用了异步方法，则该方法也必须被声明为异步方法。</strong></p>
<p><strong>15.json转类</strong>，在菜单栏选择 <strong>编辑 → 选择性粘贴 → 将 JSON 粘贴为类</strong></p>
<p><strong>16.遇事不决先编译</strong></p>
<p>**17.**引入nuget包之后发现无法使用，可能是因为nuget包与avalonia版本不匹配，需要更改nuget包版本</p>
<p><strong>18</strong>.avalonia创建UserControl页面时，建立的默认的命名空间是错误的，需要手动修改（属于bug）</p>
<p>**19.程序运行流程：**program.cs -&gt; app.xaml.cs-&gt;mainwindow-&gt;……各种导航了</p>
<p><strong>20.is与as的区别</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">is 用于判断一个对象是否是指定的类型，返回一个 bool 布尔值，它只做判断，不做转换。新版本中is可以进行转换</span><br><span class="line">value is int count  可以拆解为两层逻辑：</span><br><span class="line">判断：检查 value 是否是 int 类型；</span><br><span class="line">赋值：如果判断为 true，则将 value 转换为 int 类型，并赋值给变量 count；如果为 false，count 变量不会被赋值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">as 用于安全的类型转换，它会尝试将对象转换为指定类型：</span><br><span class="line">如果转换成功，返回转换后的对象；</span><br><span class="line">如果转换失败，返回 null（而非抛出异常）；</span><br><span class="line">value as int   </span><br></pre></td></tr></table></figure>

<p>2**1：省略if，else的方法。**使用is ，as等等，使用&#x3D;&gt;等等</p>
<p><strong>22：wpf、avalonia中事件与命令的关系。</strong></p>
<p>在button中，可以使用view中的command命令绑定到viewmodel对应的方法，其默认执行的事件是click事件，但是在其他控件中没有对应的默认关系，所以需要使用行为（behavior）去关联事件与command之间的关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListBox Grid.Row=&quot;1&quot;</span><br><span class="line">             ItemsSource=&quot;&#123;Binding Source=&#123;x:Static lvm:MenuItem.MenuItems&#125;&#125;&quot;</span><br><span class="line">             SelectedItem=&quot;&#123;Binding SelectedMenuItem, Mode=TwoWay&#125;&quot;&gt;</span><br><span class="line">        &lt;!-- 使用Interaction.Triggers将SelectionChanged事件转为命令 --&gt;</span><br><span class="line">        &lt;i:Interaction.Triggers&gt;</span><br><span class="line">            &lt;i:EventTrigger EventName=&quot;SelectionChanged&quot;&gt;</span><br><span class="line">                &lt;i:InvokeCommandAction Command=&quot;&#123;Binding MenuTappedCommand&#125;&quot;</span><br><span class="line">                                       CommandParameter=&quot;&#123;Binding SelectedItem, RelativeSource=&#123;RelativeSource AncestorType=ListBox&#125;&#125;&quot;/&gt;</span><br><span class="line">            &lt;/i:EventTrigger&gt;</span><br><span class="line">        &lt;/i:Interaction.Triggers&gt;</span><br><span class="line">    &lt;/ListBox&gt;</span><br></pre></td></tr></table></figure>

<p><strong>23.设计某一个功能时</strong>，按照serviceice层，viewmodel层和View层的方式进行设计，因为View层仅仅是显示界面，其调用Viewmodel层，而Viewmodel层是调用Service层</p>
<p>**24.解决xaml回车后属性不对齐的问题：**工具-》 选项-》格式化-》在单独的行上对齐</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260124104144777.png" alt="image-20260124104144777"></p>
<p><strong>25.按钮乱码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更改字体后重启vs</span><br><span class="line">&lt;Button Content=&quot;中文按钮&quot; FontFamily=&quot;Microsoft YaHei&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>**26.函数什么时候加async？**调用其他异步函数的时候</p>
<p><strong>27.ItemsControl和ListBox的区别</strong></p>
<p>ItemsControl用来展示多组控件(没有selecteditem选中功能)，而listbox用来展示多组数据（有selecteditem选中功能）</p>
<p>28.this关键字：this关键字在哪个类中就属于哪个类，与该方法在哪个类中被调用无关。</p>
<p><strong>29.x:static 和binding的区别：</strong></p>
<p><code>x:Static</code>适合固定不变的静态数据（如枚举、常量列表），<code>Binding</code>适合运行时可能变化的业务数据。</p>
<p><strong><code>x:Static</code></strong>：本质是<strong>静态值引用</strong>，它直接获取程序中一个<strong>静态字段 &#x2F; 属性 &#x2F; 常量</strong>的值，是一种<strong>一次性的、静态的取值方式</strong>，在 XAML 解析阶段就确定了最终值，运行时不会自动更新。</p>
<p><strong><code>Binding</code></strong>：本质是<strong>动态数据绑定</strong>，它建立的是 “数据源” 和 “UI 控件” 之间的<strong>双向 &#x2F; 单向动态关联</strong>，当数据源的属性值发生变化时，UI 会自动更新；反之（双向绑定）UI 变化也会同步到数据源。<code>Binding</code>也可以绑定静态属性，但需要用<code>{Binding Source={x:Static lvm:XXX}, Path=静态属性名}</code>的形式。</p>
<p><strong>30.xmlns与binding的区别：</strong></p>
<p><code>xmlns</code> (XML Namespace)命名空间声明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">以  </span><br><span class="line">（1）xmlns:lvm=&quot;using:PoetryPro.Library.ViewModels&quot; </span><br><span class="line">（2）DataContext=&quot;&#123;Binding QueryViewModel, Source=&#123;StaticResource ServiceLocator&#125;&#125;&quot;为例</span><br><span class="line">解释：</span><br><span class="line">（1）中前缀lvm对应的是PoetryPro.Library.ViewModels这个代码命名空间，XAML 中通过lvm:就能找到该命名空间下的所有类，解决 “XAML 认识哪个类” 的问题。</span><br><span class="line">使用场景：仅引用静态成员，不需要数据进行动态更新</span><br><span class="line">（2）DataContext中解决 “UI 控件的 Binding 该从哪个对象拿数据” 的问题。</span><br><span class="line">使用场景：需要数据进行动态更新</span><br></pre></td></tr></table></figure>

<p>31.前端向后端传递数据</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260125120112776.png" alt="image-20260125120112776"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">（1）向后端传递一个参数</span><br><span class="line">前端</span><br><span class="line">&lt;TextBox x:Name=&quot;SearchTextBox&quot; PlaceholderText=&quot;请输入关键词&quot;/&gt;</span><br><span class="line">&lt;Button Content=&quot;搜索&quot; </span><br><span class="line">        Command=&quot;&#123;Binding SearchCommand&#125;&quot; &lt;!-- 自动生成的命令属性 --&gt;</span><br><span class="line">        CommandParameter=&quot;&#123;Binding Text, ElementName=SearchTextBox&#125;&quot;/&gt; </span><br><span class="line"> </span><br><span class="line"> 后端：</span><br><span class="line"> [RelayCommand]</span><br><span class="line">private void Search(string keyword)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine($&quot;搜索关键词：&#123;keyword&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">（2）向后端传递两个参数</span><br><span class="line">步骤 1：定义参数实体类</span><br><span class="line">// 封装需要传递的多个参数</span><br><span class="line">public class LoginParams</span><br><span class="line">&#123;</span><br><span class="line">    public string Username &#123; get; set; &#125;  // 第一个参数：用户名</span><br><span class="line">    public string Password &#123; get; set; &#125;  // 第二个参数：密码</span><br><span class="line">&#125;</span><br><span class="line">步骤 2：ViewModel 中定义带参数的命令</span><br><span class="line">public partial class LoginViewModel : ObservableObject</span><br><span class="line">&#123;</span><br><span class="line">    // 用于展示结果</span><br><span class="line">    [ObservableProperty]</span><br><span class="line">    private string loginResult = &quot;未登录&quot;;</span><br><span class="line"></span><br><span class="line">    // 定义接收封装对象的命令</span><br><span class="line">    [RelayCommand]</span><br><span class="line">    private void Login(LoginParams loginParams)</span><br><span class="line">    &#123;</span><br><span class="line">        // 解构获取两个参数</span><br><span class="line">        string username = loginParams.Username;</span><br><span class="line">        string password = loginParams.Password;</span><br><span class="line"> </span><br><span class="line"> 步骤3：xaml中实现传递对象</span><br><span class="line"> &lt;TextBox x:Name=&quot;TxtUsername&quot; Width=&quot;200&quot; PlaceholderText=&quot;请输入用户名&quot;/&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 第二个参数：密码输入框 --&gt;</span><br><span class="line">        &lt;PasswordBox x:Name=&quot;PwdPassword&quot; Width=&quot;200&quot; PlaceholderText=&quot;请输入密码&quot;/&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 登录按钮：传递封装后的对象参数 --&gt;</span><br><span class="line">        &lt;Button Content=&quot;登录&quot; </span><br><span class="line">                Command=&quot;&#123;Binding LoginCommand&#125;&quot;&gt;</span><br><span class="line">            &lt;Button.CommandParameter&gt;</span><br><span class="line">                &lt;!-- 封装两个参数为LoginParams对象 --&gt;</span><br><span class="line">                &lt;local:LoginParams </span><br><span class="line">                    Username=&quot;&#123;Binding Text, ElementName=TxtUsername&#125;&quot;</span><br><span class="line">                    Password=&quot;&#123;Binding Password, ElementName=PwdPassword&#125;&quot;/&gt;</span><br><span class="line">            &lt;/Button.CommandParameter&gt;</span><br><span class="line">        &lt;/Button&gt;</span><br></pre></td></tr></table></figure>

<p>32：导航过程中，尽量不要使用传递对象进行导航，而是使用传递字符串进行导航，最终再将字符串转换为View类型</p>
<p>33.程序如果使用多项目构建的方式，例如View和Library项目，应将View项目中的ViewModelBase删掉，在Library中新建一个ViewModelBase类</p>
<p>同时，需要修改ViewLocator中的name值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var name = param.GetType().FullName!.Replace(&quot;ViewModel&quot;, &quot;View&quot;, StringComparison.Ordinal).Replace(&quot;PoetryPro.Library&quot;, &quot;PoetryPro&quot;);</span><br></pre></td></tr></table></figure>

<p>34.Service层获取ViewModel层的对象：（下层调用上层）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ServiceLocator.Current.MainViewModel</span><br><span class="line"></span><br><span class="line">View层的axaml获取ViewModel对象</span><br><span class="line"> DataContext=&quot;&#123;Binding MainViewModel, Source=&#123;StaticResource ServiceLocator&#125;&#125;&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> 为什么会出现Service层调用ViewModel层的情况：</span><br><span class="line"> 因为需要该ViewModel层的一些参数或者属性，例如PoetryPro项目中的MainViewModel中的SetMenuAndContent()方法就被MenuNavigationService调用。</span><br></pre></td></tr></table></figure>

<p>35.静态绑定：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlns:lvm = &quot;using:PoetryPro.Library.ViewModels&quot;</span><br><span class="line"></span><br><span class="line">&lt;ListBox Grid.Row=&quot;1&quot;</span><br><span class="line">					 ItemsSource=&quot;&#123;Binding Source=&#123;x:Static lvm:MenuItem.MenuItems&#125;&#125;&quot;</span><br><span class="line">					 SelectedItem=&quot;&#123;Binding SelectedMenuItem, Mode=TwoWay&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>







<h2 id="报错解决方案"><a href="#报错解决方案" class="headerlink" title="报错解决方案"></a>报错解决方案</h2><p>1.Cannot parse a compiled binding without an explicit x:DataType directive to give a starting data type for bindings</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解决办法：项目属性里面 AvaloniaUseCompiledBindingsByDefault 修改为 fasle, &lt;AvaloniaUseCompiledBindingsByDefault&gt;false&lt;/AvaloniaUseCompiledBindingsByDefault&gt;</span><br></pre></td></tr></table></figure>

<p>2.针对使用ObservableProperty时出现错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">针对使用ObservableProperty时出现错误</span><br><span class="line">[ObservableProperty] </span><br><span class="line">public string Message; </span><br><span class="line">The field AvaloniaZhangYinProject.ViewModels.MainWindowViewModel.Message cannot be used to generate an observable property, as its name would collide with the field name (instance fields should use the &quot;lowerCamel&quot;, &quot;_lowerCamel&quot; or &quot;m_lowerCamel&quot; pattern)</span><br><span class="line">解决办法，将Message的首字母小写message，或者使用_message,但是在xaml文件中使用的仍然是Message，因为ObservableProperty底层自动会将message解析为Message</span><br><span class="line">注意2：使用[ObservableProperty]注释的属性必须是私有字段，不是public</span><br><span class="line">注意3：其他函数在使用ObservableProperty标注的属性时，必须使用的首字母大写的Message，不能使用小写的message</span><br><span class="line">即正确的写法如下：</span><br><span class="line">[ObservableProperty]</span><br><span class="line">private string _message = &quot;before update&quot;;</span><br><span class="line"></span><br><span class="line">[RelayCommand]</span><br><span class="line">public async Task void SayHelloAsync()</span><br><span class="line">&#123;</span><br><span class="line">    // 2. 赋值给自动生成的公共属性Message，而非原始字段_message</span><br><span class="line">    Message = &quot;Say Hello Avalonia&quot;;</span><br><span class="line">&#125;</span><br><span class="line">注意4：使用异步函数绑定时，前端绑定应写为SayHelloCommand进行绑定，而不是SayHelloAsyncCommand</span><br></pre></td></tr></table></figure>

<p>3.前端显示值不发生变化。</p>
<p>参考2中的注意3</p>
<p>参考2中的主要4</p>
<p>函数命名时，不能以On或者以In开头，容易与MVVM.toolkit重名，导致前端与后端的函数绑定不上</p>
<p>avalonia创建UserControl页面时，建立的默认的命名空间是错误的，需要手动修改（属于bug）</p>
<ol start="4">
<li></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.InvalidOperationException:“Unable to resolve service for type &#x27;PoetryPro.Library.Services.IPoetryStorage&#x27; while attempting to activate &#x27;PoetryPro.Library.ViewModels.ResultViewModel&#x27;.”</span><br><span class="line">属于依赖注入错误</span><br><span class="line">解决方法：</span><br><span class="line"> ServiceLocator 中只通过 serviceCollection.AddSingleton&lt;ResultViewModel&gt;() 注册了 ResultViewModel，但ResultViewModel 的构造函数中明确依赖了 IPoetryStorage 接口（类似如下代码），却没有将 IPoetryStorage 及其对应的具体实现类注册到依赖注入容器中，容器无法知晓该如何创建 IPoetryStorage 实例，因此抛出解析失败异常。因此需将接口及其实现类进行依赖注入。</span><br><span class="line"> serviceCollection.AddSingleton&lt;IPoetryStorage, PoetryStorage&gt;();</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>按钮默认不可用的情况</p>
<p>说明前端这块绑定错误</p>
<p>ServiceLocator未创建实例，导致前端的datacontext与后端的对应的viewmodel绑定不上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例如：public ResultViewModel ResultViewModel =&gt;</span><br><span class="line">   _serviceProvider.GetRequiredService&lt;ResultViewModel&gt;();</span><br></pre></td></tr></table></figure>


</li>
<li><p>Unable to resolve type FilterType from namespace using:PoetryPro.Library.ViewModels 第 41 行，位置 35。</p>
<p>解决：是因为在后台的类文件中少了一个大括号，导致类不能被识别出来</p>
</li>
</ol>
<h2 id="项目1（PoetryPro）"><a href="#项目1（PoetryPro）" class="headerlink" title="项目1（PoetryPro）"></a>项目1（PoetryPro）</h2><p>导航共包含三级。（1）MainWindowView   (2)MainView   （3）ContentView</p>
<p>（1）整个项目的View之间关系<img src="/2026/01/29/Avalonia/assets/%E5%B9%BB%E7%81%AF%E7%89%871.PNG" alt="幻灯片1"></p>
<p>（2）ContentView</p>
<p><img src="/2026/01/29/Avalonia/assets/%E5%B9%BB%E7%81%AF%E7%89%872.PNG" alt="幻灯片2"></p>
<p>（3）ViewModel中的方法及其对应的导航实现关系</p>
<p><img src="/2026/01/29/Avalonia/assets/%E5%B9%BB%E7%81%AF%E7%89%873.PNG" alt="幻灯片3"></p>
<p><img src="/2026/01/29/Avalonia/assets/%E5%B9%BB%E7%81%AF%E7%89%874.PNG" alt="幻灯片4"></p>
<p>项目结构：PoetryPro是View项目，PoetryPro.Library是第二个项目，View项目和Library中都包含Services层，View项目的Service层主要因为需要引入ServiceLocator中的对象，所以将其写在View项目中，其他的service及其所有接口都是写在Library的项目中</p>
<p><img src="/2026/01/29/Avalonia/assets/image-20260127193918656.png" alt="image-20260127193918656"><img src="/2026/01/29/Avalonia/assets/image-20260127200148294.png" alt="image-20260127200148294"><img src="/2026/01/29/Avalonia/assets/image-20260127195750969.png" alt="image-20260127195750969"> </p>
<p>项目思路：</p>
<p>（1）构建两个项目：包括View项目和Library项目，建立数据库字段和实体类之间的关系(Models层)。</p>
<p>（2）建立Service层，实现包括数据库，导航，警告的业务逻辑。使用服务定位器模式进行DI注入。</p>
<p>删掉view项目中的ViewModels，以及需要修改ViewLocator中的name</p>
<p>（3）构建ViewModel层：实现ViewModel之间的导航</p>
<p>（4）建立View层，显示界面。</p>
<p>注意事项：</p>
<p>（1）ViewLocator中根据反射获取ViewModel的名字，然后处理字符串获取对应的View，所以，其Match方法在xaml中的ContentCtrol的Content属性或者DataContext发生变化是会被自动调用，接下来调用Build方法。</p>
<p>（2）写view层只关注viewmodel层，写viewmodel层只关注service层</p>
<p>（3）viewModel之间导航并进行传参：</p>
<p>例如想要实现todayviewmodel(发送者)向todaydetailviewmodel（接收者）导航的同时完成传递参数应该怎么办？</p>
<p>todayviewmodel获得todaydetailviewmodel对象后，要想传参，可以在todaydetailviewmodel中添加一个传参方法，然后在todayviewmodel中调用该传参方法<br>&#x2F;&#x2F;如果任意viewmodel之间传参，就都需要每一个发送的viewmodel都写一个传参方法，在每个接收的viewmodel中调用。为了简化干脆直接写一个通用传参方法（位于接口或者抽象类中），<br>&#x2F;&#x2F;让所有的viewmodel都继承者该接口或者抽象类，这个类就是ViewModelIBase，在里面添加<br>&#x2F;&#x2F;方法，这样每一个继承ViewModelIBase的发送端的viewmodel默认就有个一个传参方法，<br>&#x2F;&#x2F;而发送方法直接写在ContentNavigationService中即可完成在导航的同时完成传参，接收参数那一端直接重写SetParameter方法即可。</p>
<p>（4）下层调用上层（service层调用ViewModel）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ServiceLocator.Current.MainViewModel</span><br><span class="line"></span><br><span class="line">View层的axaml获取ViewModel对象</span><br><span class="line"> DataContext=&quot;&#123;Binding MainViewModel, Source=&#123;StaticResource ServiceLocator&#125;&#125;&quot;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> 为什么会出现Service层调用ViewModel层的情况：</span><br><span class="line"> 因为需要该ViewModel层的一些参数或者属性，例如PoetryPro项目中的MainViewModel中的SetMenuAndContent()方法就被MenuNavigationService调用。</span><br><span class="line"> </span><br><span class="line"> ViewModel层调用ViewModel层方法</span><br><span class="line"> 直接构造参数注入即可。</span><br></pre></td></tr></table></figure>







<h2 id="优质博客（博客园：simonoct）"><a href="#优质博客（博客园：simonoct）" class="headerlink" title="优质博客（博客园：simonoct）"></a>优质博客（博客园：simonoct）</h2><h2 id="（1）Avalonia-学习笔记01-Images-Buttons（图片与按钮）"><a href="#（1）Avalonia-学习笔记01-Images-Buttons（图片与按钮）" class="headerlink" title="（1）Avalonia 学习笔记01. Images &amp; Buttons（图片与按钮）"></a>（1）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18973395">Avalonia 学习笔记01. Images &amp; Buttons（图片与按钮）</a></h2><p>我对软件的图形化界面很感兴趣，查看了很多框架我最后选定C#的Avalonia作为我第一个学习的框架，不过我发现这个UI框架教程貌似很缺乏。<br>后面到YouTube上搜，看到一个作者制作了一系列教程，虽然是英文，但是我通过语音转文字+AI翻译学习，感觉还是挺不错的。<br>视频地址：<a target="_blank" rel="noopener" href="https://youtu.be/ort9IqKAnL4?si=uTEjZ88osw1BLcyk">https://youtu.be/ort9IqKAnL4?si=uTEjZ88osw1BLcyk</a><br>资源下载地址：<a target="_blank" rel="noopener" href="https://github.com/angelsix/youtube/tree/develop/Avalonia">https://github.com/angelsix/youtube/tree/develop/Avalonia</a> BatchProcess</p>
<h3 id="1-1-App-axaml"><a href="#1-1-App-axaml" class="headerlink" title="1.1 App.axaml"></a>1.1 App.axaml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;Application xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.App&quot;</span><br><span class="line">             RequestedThemeVariant=&quot;Default&quot;&gt;</span><br><span class="line">             &lt;!-- &quot;Default&quot; ThemeVariant follows system theme variant. &quot;Dark&quot; or &quot;Light&quot; are other available options. --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Application.Styles&gt;</span><br><span class="line">        &lt;FluentTheme /&gt;</span><br><span class="line">        &lt;StyleInclude Source=&quot;Styles/AppDefaultStyles.axaml&quot;&gt;&lt;/StyleInclude&gt;</span><br><span class="line">    &lt;/Application.Styles&gt;</span><br><span class="line">    </span><br><span class="line">     &lt;Application.Resources&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryForeground&quot;&gt;#CFCFCF&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryBackground&quot;&gt;#14172D&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;LinearGradientBrush x:Key=&quot;PrimaryBackgroundGradient&quot; StartPoint=&quot;0%, 0%&quot; EndPoint=&quot;100%, 0%&quot;&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;0&quot; Color=&quot;#111214&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;1&quot; Color=&quot;#151E3E&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">         &lt;/LinearGradientBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverBackground&quot;&gt;#333B5A&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverForeground&quot;&gt;White&lt;/SolidColorBrush&gt;</span><br><span class="line">     &lt;/Application.Resources&gt;</span><br><span class="line">&lt;/Application&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>&lt;Application …&gt;: 这是根标签，代表你的整个应用程序。<ul>
<li><code>xmlns=&quot;...&quot;</code>: 这些是“命名空间”，可以理解为代码的“地址簿”。它告诉编译器 <code>&lt;Button&gt;</code>、<code>&lt;Grid&gt;</code>这些标签应该去哪里找它们的定义。初学时不用太关心，知道是必须的就行。</li>
<li><code>RequestedThemeVariant=&quot;Default&quot;</code>: 设置应用的主题。Default 会跟随你的操作系统是亮色模式还是暗色模式。你也可以强制设为 Dark 或 Light。</li>
</ul>
</li>
<li><code>&lt;Application.Styles&gt;</code>: <strong>应用的“样式规则手册”</strong>。这里面定义了整个应用的外观规则。<ul>
<li><code>&lt;FluentTheme /&gt;</code>: 引入 Avalonia 官方提供的 <strong>Fluent UI 主题</strong>。它给了所有控件（按钮、文本框等）一个现代化的、符合 Windows 11 风格的默认外观。</li>
<li><code>&lt;StyleInclude Source=&quot;Styles/AppDefaultStyles.axaml&quot; /&gt;</code>: <strong>包含我们自己的样式文件</strong>。这行代码告诉“大管家”：“除了官方的 Fluent 主题，再把我们自己写的那个 AppDefaultStyles.axaml 文件里的样式规则也加载进来。” Source 就是文件的路径。使用自定义样式文件可以统一覆盖控件的默认样式，例如直接使用<code>&lt;Button&gt;</code>创建的按钮颜色、鼠标悬停颜色等等，如果一个个button指定颜色不仅混乱，如果遇到修改主题也会变得血雨腥风。</li>
</ul>
</li>
<li><code>&lt;Application.Resources&gt;</code>: <strong>应用的“公共资源仓库”</strong>。这里存放着可以在整个应用中反复使用的“材料”，比如颜色、画刷、图标等。这样做的好处是，如果要改一个颜色，只需要改这里一处，所有用到它的地方都会自动更新。例如AppDefaultStyles.axaml里面就引用了默认的背景颜色、前景颜色，想要变更直接修改颜色即可。<ul>
<li><code>&lt;SolidColorBrush x:Key=&quot;PrimaryForeground&quot;&gt;#CFCFCF&lt;/SolidColorBrush&gt;</code>:<ul>
<li><code>SolidColorBrush</code>: 定义一个<strong>纯色画刷</strong>。你可以把它想象成一支只能画一种颜色的油漆刷。</li>
<li><code>x:Key=&quot;PrimaryForeground&quot;</code>: 给这支油漆刷贴上一个<strong>标签（唯一的钥匙）</strong>，名字叫 PrimaryForeground。之后我们就可以通过这个名字来使用它。</li>
<li>#CFCFCF: 这是颜色的十六进制代码。</li>
</ul>
</li>
<li><code>&lt;LinearGradientBrush x:Key=&quot;PrimaryBackgroundGradient&quot; ...&gt;</code>: 定义一个<strong>线性渐变画刷</strong>。<ul>
<li><code>StartPoint=&quot;0%, 0%&quot;</code>: 渐变从<strong>左上角</strong>开始。</li>
<li><code>EndPoint=&quot;100%, 0%&quot;</code>: 渐变到<strong>右上角</strong>结束。所以这是一个<strong>从左到右的水平渐变</strong>。</li>
<li><code>&lt;GradientStop Offset=&quot;0&quot; Color=&quot;...&quot; /&gt;</code>: 在渐变轴的<strong>起点 (0%)</strong> 放置这个颜色。</li>
<li><code>&lt;GradientStop Offset=&quot;1&quot; Color=&quot;...&quot; /&gt;</code>: 在渐变轴的<strong>终点 (100%)</strong> 放置这个颜色。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">假设StartPoint=<span class="string">&quot;0%, 0%&quot;</span>，EndPoint=<span class="string">&quot;100%, 100%&quot;</span>，那么渐变轴就是右下角方向了。</span><br><span class="line">  </span><br><span class="line">  (0%, 0%)  &lt;-- 起点 (StartPoint)</span><br><span class="line">  +-------------------------+ (100%, 0%)</span><br><span class="line">  | \                       |</span><br><span class="line">  |   \  &lt;-- 渐变轴 (Gradient Axis)</span><br><span class="line">  |     \                   |</span><br><span class="line">  |       \                 |</span><br><span class="line">  +-------------------------+</span><br><span class="line">  (0%, 100%)           (100%, 100%) &lt;-- 终点 (EndPoint)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-2-Styles-AppDefaultStyles-axaml"><a href="#1-2-Styles-AppDefaultStyles-axaml" class="headerlink" title="1.2 Styles&#x2F;AppDefaultStyles.axaml"></a>1.2 Styles&#x2F;AppDefaultStyles.axaml</h3><p>新建一个名为Styles的文件夹，然后模板文件可以用Rider新建的时候选择Avalonia Styles，命名为<strong>AppDefaultStyles.axaml</strong>即可。</p>
<p>这个文件专门用来写我们自定义的样式规则，让应用看起来更个性化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;Styles xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;&gt;</span><br><span class="line">    &lt;Design.PreviewWith&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot; Width=&quot;200&quot;&gt;</span><br><span class="line">            &lt;!-- Add Controls for Previewer Here --&gt;</span><br><span class="line">            &lt;Button Foreground=&quot;White&quot; Content=&quot;Hello World&quot;&gt;&lt;/Button&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Design.PreviewWith&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Add Styles Here --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;20&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryHoverForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryHoverBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/Styles&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>&lt;Styles ...&gt;</code>: 这是一个专门存放样式规则的容器。</p>
</li>
<li><p><code>&lt;Design.PreviewWith&gt;</code>: <strong>“设计师预览区”</strong>。这部分代码<strong>非常特别</strong>，它只在 IDE 的预览窗口里显示，<strong>不会被编译到最终的应用里</strong>。它的作用是给你提供一个“画板”，让你在设计样式的时候能立刻看到效果，不然就只能靠重新编译或者脑子想象。</p>
</li>
<li><p><code>&lt;Style Selector=&quot;Button&quot;&gt;</code>: <strong>定义一条样式规则</strong>。</p>
<ul>
<li><p><code>Selector=&quot;Button&quot;</code>: 这个是“选择器”，意思是“<strong>这条规则将应用到我项目里所有的<code>&lt;Button&gt;</code>控件上</strong>”。</p>
</li>
<li><pre><code>&lt;Setter Property=&quot;FontSize&quot; Value=&quot;20&quot; /&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    :</span><br><span class="line"></span><br><span class="line">    - `Setter`: “设置器”，表示要在这里设置一个属性。</span><br><span class="line">    - `Property=&quot;FontSize&quot;`: 要设置的**属性**是“字体大小”。</span><br><span class="line">    - `Value=&quot;20&quot;`: 把字体大小的**值**设为 20。</span><br><span class="line"></span><br><span class="line">  - `&lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot; /&gt;`: 把文字颜色（Foreground）设置为我们之前在 App.axaml 里定义的、名叫 PrimaryForeground 的那个颜色资源。&#123;DynamicResource ...&#125; 的意思就是“去公共仓库按名字找资源”。</span><br><span class="line"></span><br><span class="line">- `&lt;Style Selector=&quot;Button:pointerover /template/ ContentPresenter&quot;&gt;`: **定义一条更特殊的规则**。</span><br><span class="line"></span><br><span class="line">  - `Selector=&quot;Button:pointerover&quot;`: 这个选择器更具体，它说：“这条规则**只在鼠标指针悬停在按钮上时**才生效”。:pointerover 就是“鼠标悬停”这个特殊状态。</span><br><span class="line">  - `/template/ ContentPresenter`: 这是个固定写法。它的意思是，为了可靠地改变按钮在悬停时的背景和前景，我们需要更深入地指定到按钮内部一个叫 ContentPresenter 的部件。</span><br><span class="line">  - 里面的两个`&lt;Setter&gt;`就定义了当鼠标悬停时，按钮的文字颜色和背景色应该变成我们定义的“Hover”颜色。</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line">### 1.3 MainWindow.axaml</span><br><span class="line"></span><br><span class="line">这是用户能看到的、实际的主窗口。它负责把各种控件（按钮、图片等）组合、摆放起来，形成最终的界面。</span><br><span class="line"></span><br><span class="line">```xaml</span><br><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1024&quot; d:DesignHeight=&quot;600&quot;</span><br><span class="line">        Width=&quot;1024&quot; Height=&quot;600&quot;</span><br><span class="line">        x:Class=&quot;AvaloniaApplication2.MainWindow&quot;</span><br><span class="line">        Title=&quot;AvaloniaApplication2&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Grid Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot; ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot;&gt;</span><br><span class="line">            &lt;Grid RowDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;200&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Button Content=&quot;Home&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    &lt;Button Content=&quot;Process&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    &lt;Button Content=&quot;Actions&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    &lt;Button Content=&quot;Macros&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    &lt;Button Content=&quot;Reporter&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    &lt;Button Content=&quot;History&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;Button Grid.Row=&quot;1&quot; Content=&quot;Setting&quot;&gt;&lt;/Button&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window ...&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>窗口</p>
<p>。这是所有内容的根容器。</p>
<ul>
<li><code>d:DesignWidth/Height</code>: <strong>仅在设计预览时</strong>的窗口宽高，方便你设计。</li>
<li><code>Width/Height</code>: <strong>程序真正运行时</strong>的窗口宽高。</li>
<li><code>Title</code>: 显示在窗口左上角的标题。</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid ...&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>网格</p>
<p>。这是布局控件，就像一个看不见的 Excel 表格。</p>
<ul>
<li><p><code>Background=&quot;{...}&quot;</code>: 把窗口的背景设置为我们定义的 PrimaryBackground 颜色。</p>
</li>
<li><pre><code>ColumnDefinitions=&quot;Auto, *&quot;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    :</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">    定义网格的列</span><br><span class="line"></span><br><span class="line">    。这行代码把网格分成了两列：</span><br><span class="line"></span><br><span class="line">    - `Auto`: 第一列的宽度由**其内部最宽的内容自动决定**。</span><br><span class="line">    - `*`: 第二列将**占据所有剩余的可用空间**。这是创建“侧边栏 + 主内容区”布局的经典手法。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  &lt;Border ...&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>:</p>
<p>边框容器</p>
<p>。它像一个可以设置背景、边框和内边距的盒子。这里它被放在了 Grid 的第一列（Auto 列），用来创建侧边栏。</p>
<ul>
<li><code>Padding=&quot;20&quot;</code>: 在这个盒子的<strong>四边都留出 20 个单位的内部空白</strong>，让内容不会紧贴着边缘。</li>
<li><code>Background=&quot;{...}&quot;</code>: 把这个侧边栏的背景设置为我们定义的那个<strong>渐变色画刷</strong>。</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid RowDefinitions=&quot;*, Auto&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>在侧边栏内部又放了一个网格</p>
<p>。这个网格用来做垂直布局。</p>
<ul>
<li><pre><code>RowDefinitions=&quot;*, Auto&quot;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    : 把这个内部网格分成了两行：</span><br><span class="line"></span><br><span class="line">    - `*`: 第一行占据**所有剩余的垂直空间**。</span><br><span class="line">    - `Auto`: 第二行的高度由其内容（设置按钮）**自动决定**。</span><br><span class="line">    - **效果**：这会把“设置”按钮“钉”在侧边栏的底部，而上面的部分则会填满剩余空间。</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>:</p>
<p>堆叠面板</p>
<p>。它是一个简单的布局控件，会把里面的东西一个接一个地堆起来（默认是垂直方向）。</p>
<ul>
<li><code>Spacing=&quot;12&quot;</code>: 在每个被堆起来的控件之间，<strong>增加 12 个单位的间距</strong>。类似于word的行间距。</li>
<li>这个 StackPanel 被放在了内部 Grid 的第一行 (* 行)。</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image ...&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>图片</p>
<p>。</p>
<ul>
<li><code>Source=&quot;{SvgImage /Assets/Images/logo.svg}&quot;</code>: 设置图片的来源。<code>{SvgImage ...}</code> 是用来加载 SVG 格式矢量图的特殊语法，路径是相对于项目根目录的。<strong>注意在Rider里面编辑图片属性，将Bulid Action修改为：AvaloniaResource，不然在构建程序的时候这些资源是不会构建的。</strong></li>
<li><code>Width=&quot;200&quot;</code>: 设置图片显示的宽度为 200。</li>
<li>注意需要安装一个名为<strong>Svg.Controls.Skia.Avalonia</strong>的包，教程展示用的是过时版本。</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button ...&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>按钮</p>
<p>。</p>
<ul>
<li><code>Content=&quot;Home&quot;</code>: 按钮上显示的文字。</li>
<li><code>HorizontalAlignment=&quot;Stretch&quot;</code>: <strong>水平对齐方式</strong>。Stretch 意味着让按钮的宽度<strong>拉伸</strong>，以填满其父容器（StackPanel）分配给它的所有水平空间。</li>
</ul>
</li>
<li><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Grid.Row=&quot;1&quot; Content=&quot;Setting&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>:</p>
<p>放在底部的设置按钮</p>
<p>。</p>
<ul>
<li><code>Grid.Row=&quot;1&quot;</code>: 这是一个<strong>附加属性</strong>。它是在告诉<strong>父级的<code>&lt;Grid RowDefinitions=&quot;\*, Auto&quot;&gt;</code></strong>：“请把我这个按钮放在你的第二行（索引从0开始，所以1是第二行）！”，这是实现Setting图标“钉”在底部的关键。</li>
<li><strong>父级的<code>&lt;Grid RowDefinitions=&quot;\*, Auto&quot;&gt;</code></strong>：第一行 (Row&#x3D;”0”)** 的高度是 <code>*</code>。意思是：“<strong>请占据所有可用的、剩余的垂直空间</strong>”，<strong>第二行 (Row&#x3D;”1”)</strong> 的高度是 <code>Auto</code>。意思是：“我的高度刚刚好能包住我的内容就行”。<code>Row=&quot;1&quot;</code>就是Auto部分，实现setting在侧边栏的底部。</li>
<li>setting会在左侧的原因貌似有些复杂，根据<a target="_blank" rel="noopener" href="https://docs.avaloniaui.net/zh-Hans/docs/basics/user-interface/building-layouts/alignment-margins-and-padding#horizontalalignment-property">文档</a>所说：HorizontalAlignment和VerticalAlignment默认值都是Stretch，也就是拉伸。但是这里表现却是和显式指定<code>Left</code>一致。一个可能的解释是：因为父 Grid 列是 Auto。Auto 列的宽度由子控件的“理想尺寸”决定。虽然按钮的 HorizontalAlignment 默认是 Stretch，但它必须先报告一个尺寸给 Auto 列。这个尺寸就是它包裹其内容（HorizontalContentAlignment 为 Left）所需的最小尺寸。因此，Grid 列和按钮本身都收缩了，Stretch 没有机会发挥作用。</li>
<li>显式指定 <code>HorizontalAlignment=&quot;Stretch&quot;</code>时，默认保守策略会被覆盖，找一个最大且具体（非无限宽）的宽度，然后拉伸。这里因为<code>&lt;Image ... Width=200&gt;</code>，所以最大宽度就是200。如果想让图标也居中，则需要额外指定<code>HorizontalContentAlignment=&quot;Center&quot;</code></li>
</ul>
</li>
</ul>
<hr>
<h3 id="1-4"><a href="#1-4" class="headerlink" title="1.4 &lt;Grid"></a>1.4 &lt;Grid</h3><p>Grid 的核心在于<strong>先定义网格，再放置内容</strong>。</p>
<h3 id="1-4-1-定义行和列"><a href="#1-4-1-定义行和列" class="headerlink" title="1.4.1 定义行和列"></a>1.4.1 定义行和列</h3><p>用 <code>&lt;Grid.ColumnDefinitions&gt;</code>和<code>&lt;Grid.RowDefinitions&gt;</code>来定义网格的结构。每一列或每一行的大小有三种定义方式：</p>
<ol>
<li><strong>Auto (按需分配)</strong>：列宽或行高由其<strong>内部最宽&#x2F;最高的内容</strong>决定。它会“收缩&#x2F;撑开”以正好包裹住内容。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">    &lt;Button Grid.Column=&quot;0&quot;&gt;短内容&lt;/Button&gt;</span><br><span class="line">    &lt;Button Grid.Column=&quot;1&quot;&gt;这里是很长很长的内容&lt;/Button&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br><span class="line">|-- 由“短内容”决定 --|---------- 占据所有剩余空间 -----------|</span><br><span class="line">|  [ 短内容 ]       |  [ 这里是很长很长的内容 ]              |</span><br><span class="line">|      (Auto)      |                  (*)               |</span><br></pre></td></tr></table></figure>

<ol>
<li>*** (星号&#x2F;比例分配)<strong>：这是最强大的方式。它会贪婪地</strong>抢占所有“剩余”的空间**。如果多个列&#x2F;行都是 *，它们会按比例瓜分。</li>
</ol>
<ul>
<li><code>*, *</code>：两个都分 1 份，所以是 1:1，即对半分。</li>
<li><code>*, 2*</code>：一个分 1 份，一个分 2 份，总共 3 份，所以是 1:2 的比例。</li>
</ul>
<p>假设宽度是900px</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|----------- 300px (1份) -----------|----------------- 600px (2份) -----------------|</span><br><span class="line">|                                   |                                              |</span><br><span class="line">|                (*)                |                     (2*)                     |</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>固定值 (Fixed Value)</strong>：直接指定一个固定的数字，单位是设备无关像素。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid ColumnDefinitions=&quot;100, *&quot;&gt;</span><br><span class="line">    &lt;Button Grid.Column=&quot;0&quot;&gt;固定100宽&lt;/Button&gt;</span><br><span class="line">    &lt;Button Grid.Column=&quot;1&quot;&gt;剩余所有&lt;/Button&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br><span class="line">|---- 100px ----|------------------ 占据所有剩余空间 ------------------|</span><br><span class="line">| [ 固定100宽 ]  |  [ 剩余所有 ]                                       |</span><br><span class="line">|   (Fixed)     |                         (*)                        |</span><br></pre></td></tr></table></figure>

<h3 id="1-4-2-放置控件"><a href="#1-4-2-放置控件" class="headerlink" title="1.4.2 放置控件"></a>1.4.2 放置控件</h3><p>使用 Grid.Row 和 Grid.Column 附加属性，告诉每个控件应该去哪个“房间”（单元格）。索引从 0 开始。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 一个 2x2 的网格 --&gt;</span><br><span class="line">&lt;Grid ColumnDefinitions=&quot;*,*&quot; RowDefinitions=&quot;*,*&quot;&gt;</span><br><span class="line">    &lt;!-- 左上角 (0,0) --&gt;</span><br><span class="line">    &lt;Button Grid.Row=&quot;0&quot; Grid.Column=&quot;0&quot; Content=&quot;A&quot;/&gt;</span><br><span class="line">    &lt;!-- 右上角 (0,1) --&gt;</span><br><span class="line">    &lt;Button Grid.Row=&quot;0&quot; Grid.Column=&quot;1&quot; Content=&quot;B&quot;/&gt;</span><br><span class="line">    &lt;!-- 左下角 (1,0) --&gt;</span><br><span class="line">    &lt;Button Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot; Content=&quot;C&quot;/&gt;</span><br><span class="line">    &lt;!-- 右下角 (1,1) --&gt;</span><br><span class="line">    &lt;Button Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot; Content=&quot;D&quot;/&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br><span class="line">      Column 0 (*)      Column 1 (*)</span><br><span class="line">    +-----------------+-----------------+</span><br><span class="line">    |                 |                 |  Row 0 (*)</span><br><span class="line">    |    [   A   ]    |    [   B   ]    |</span><br><span class="line">    |     (0,0)       |     (0,1)       |</span><br><span class="line">    |                 |                 |</span><br><span class="line">    +-----------------+-----------------+</span><br><span class="line">    |                 |                 |  Row 1 (*)</span><br><span class="line">    |    [   C   ]    |    [   D   ]    |</span><br><span class="line">    |     (1,0)       |     (1,1)       |</span><br><span class="line">    |                 |                 |</span><br><span class="line">    +-----------------+-----------------+</span><br></pre></td></tr></table></figure>

<h3 id="1-4-3-Grid-可以包含StackPanel吗？"><a href="#1-4-3-Grid-可以包含StackPanel吗？" class="headerlink" title="1.4.3 Grid 可以包含StackPanel吗？"></a>1.4.3 Grid 可以包含StackPanel吗？</h3><p>正如上方教程展示的代码，Grid可以包含StackPanel，后续视频教程可能会深入这里我就简单找一例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Grid的第0列: 放置一个StackPanel来管理一堆按钮 --&gt;</span><br><span class="line">    &lt;StackPanel Grid.Column=&quot;0&quot; Margin=&quot;10&quot; Spacing=&quot;8&quot;&gt;</span><br><span class="line">        &lt;Button&gt;首页&lt;/Button&gt;</span><br><span class="line">        &lt;Button&gt;产品&lt;/Button&gt;</span><br><span class="line">        &lt;Button&gt;设置&lt;/Button&gt;</span><br><span class="line">        &lt;Button&gt;关于&lt;/Button&gt;</span><br><span class="line">    &lt;/StackPanel&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Grid的第1列: 放置主内容 --&gt;</span><br><span class="line">    &lt;Border Grid.Column=&quot;1&quot; Background=&quot;LightGray&quot;&gt;</span><br><span class="line">        &lt;TextBlock VerticalAlignment=&quot;Center&quot; HorizontalAlignment=&quot;Center&quot;&gt;</span><br><span class="line">            主内容区域</span><br><span class="line">        &lt;/TextBlock&gt;</span><br><span class="line">    &lt;/Border&gt;</span><br><span class="line"></span><br><span class="line">&lt;/Grid&gt;</span><br><span class="line">&lt;---------------------------------- Grid (整体框架) -----------------------------------&gt;</span><br><span class="line">+---------------------------------+---------------------------------------------------+</span><br><span class="line">| &lt;-- StackPanel (在第0列) ------&gt; |                                                   |</span><br><span class="line">|                                 |                                                   |</span><br><span class="line">|   +-------------------------+   |                                                   |</span><br><span class="line">|   |       [ 首页 ]           |   |                                                   |</span><br><span class="line">|   +-------------------------+   |                                                   |</span><br><span class="line">|   |       [ 产品 ]           |   |                                                   |</span><br><span class="line">|   +-------------------------+   |                   主内容区域                        |</span><br><span class="line">|   |       [ 设置 ]           |   |                     (第1列)                       |</span><br><span class="line">|   +-------------------------+   |                                                   |</span><br><span class="line">|   |       [ 关于 ]           |   |                                                  |</span><br><span class="line">|   +-------------------------+   |                                                   |</span><br><span class="line">|                                 |                                                   |</span><br><span class="line">+---------------------------------+---------------------------------------------------+</span><br><span class="line">| &lt;------- Col 0 (Auto) --------&gt; | &lt;-------------------- Col 1 (*) -----------------&gt; |</span><br></pre></td></tr></table></figure>

<h3 id="1-5"><a href="#1-5" class="headerlink" title="1.5 &lt;StackPanel"></a>1.5 &lt;StackPanel</h3><p>StackPanel 的核心是<strong>按顺序线性排列</strong>。它只有两个关键属性你需要关心。</p>
<h3 id="1-5-1-Orientation-方向"><a href="#1-5-1-Orientation-方向" class="headerlink" title="1.5.1 Orientation (方向)"></a>1.5.1 Orientation (方向)</h3><ul>
<li>Vertical (默认值): 从上到下堆叠。</li>
<li>Horizontal: 从左到右排列。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 垂直方向 (默认) --&gt;</span><br><span class="line">&lt;StackPanel&gt;</span><br><span class="line">    &lt;Button&gt;A&lt;/Button&gt;</span><br><span class="line">    &lt;Button&gt;B&lt;/Button&gt;</span><br><span class="line">    &lt;Button&gt;C&lt;/Button&gt;</span><br><span class="line">&lt;/StackPanel&gt;</span><br><span class="line">+-----------+</span><br><span class="line">| [   A   ] |</span><br><span class="line">+-----------+</span><br><span class="line">| [   B   ] |</span><br><span class="line">+-----------+</span><br><span class="line">| [   C   ] |</span><br><span class="line">+-----------+</span><br><span class="line">&lt;!-- 水平方向 --&gt;</span><br><span class="line">&lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">    &lt;Button&gt;A&lt;/Button&gt;</span><br><span class="line">    &lt;Button&gt;B&lt;/Button&gt;</span><br><span class="line">    &lt;Button&gt;C&lt;/Button&gt;</span><br><span class="line">&lt;/StackPanel&gt;</span><br><span class="line">+---------+---------+---------+</span><br><span class="line">| [  A  ] | [  B  ] | [  C  ] |</span><br><span class="line">+---------+---------+---------+</span><br></pre></td></tr></table></figure>

<h3 id="1-5-2-Spacing-间距"><a href="#1-5-2-Spacing-间距" class="headerlink" title="1.5.2 Spacing (间距)"></a>1.5.2 Spacing (间距)</h3><p>在每个子控件之间添加固定的空白。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Spacing=&quot;10&quot;&gt;</span><br><span class="line">    &lt;Button&gt;A&lt;/Button&gt;</span><br><span class="line">    &lt;Button&gt;B&lt;/Button&gt;</span><br><span class="line">&lt;/StackPanel&gt;</span><br><span class="line">+-----------+</span><br><span class="line">| [   A   ] |</span><br><span class="line">+-----------+</span><br><span class="line">|-- 10px空隙--|  &lt;-- Spacing</span><br><span class="line">+-----------+</span><br><span class="line">| [   B   ] |</span><br><span class="line">+-----------+</span><br></pre></td></tr></table></figure>

<h3 id="1-5-3-StackPanel-可以包含-Grid-吗？"><a href="#1-5-3-StackPanel-可以包含-Grid-吗？" class="headerlink" title="1.5.3 StackPanel 可以包含 Grid 吗？"></a>1.5.3 StackPanel 可以包含 Grid 吗？</h3><p><strong>可以</strong></p>
<p>可能的场景：当你需要构建一个<strong>列表</strong>，而列表中的<strong>每一项本身又是一个复杂的布局</strong>时。例如，一个显示用户信息的垂直列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;StackPanel Spacing=&quot;10&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 第一张用户卡片 (一个 Grid) --&gt;</span><br><span class="line">    &lt;Grid ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;Image Grid.Column=&quot;0&quot; Source=&quot;avatar1.png&quot; Width=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;1&quot; Margin=&quot;10,0,0,0&quot;&gt;</span><br><span class="line">            &lt;TextBlock&gt;张三&lt;/TextBlock&gt;</span><br><span class="line">            &lt;TextBlock&gt;软件工程师&lt;/TextBlock&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 第二张用户卡片 (另一个 Grid) --&gt;</span><br><span class="line">    &lt;Grid ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;Image Grid.Column=&quot;0&quot; Source=&quot;avatar2.png&quot; Width=&quot;50&quot;/&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;1&quot; Margin=&quot;10,0,0,0&quot;&gt;</span><br><span class="line">            &lt;TextBlock&gt;李四&lt;/TextBlock&gt;</span><br><span class="line">            &lt;TextBlock&gt;UI 设计师&lt;/TextBlock&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">&lt;/StackPanel&gt;</span><br><span class="line">+---------------------------------------------+  &lt;-- StackPanel 开始</span><br><span class="line">|                                             |</span><br><span class="line">| +-----------------------------------------+ |  &lt;-- 第一个 Grid 开始</span><br><span class="line">| |          |                              | |</span><br><span class="line">| | [头像1]   |  张三                         | |</span><br><span class="line">| |  (Auto)  |  软件工程师                    | |</span><br><span class="line">| |          |         (*)                  | |</span><br><span class="line">| +-----------------------------------------+ |  &lt;-- 第一个 Grid 结束</span><br><span class="line">|                                             |</span><br><span class="line">|----------------- 10px 间距 -----------------|</span><br><span class="line">|                                             |</span><br><span class="line">| +-----------------------------------------+ |  &lt;-- 第二个 Grid 开始</span><br><span class="line">| |          |                              | |</span><br><span class="line">| | [头像2]  |  李四                         | |</span><br><span class="line">| |  (Auto)  |  UI 设计师                    | |</span><br><span class="line">| |          |         (*)                  | |</span><br><span class="line">| +-----------------------------------------+ |  &lt;-- 第二个 Grid 结束</span><br><span class="line">|                                             |</span><br><span class="line">+---------------------------------------------+  &lt;-- StackPanel 结束</span><br></pre></td></tr></table></figure>

<h2 id="（2）Avalonia-学习笔记02-Fonts-and-Animations（字体和动画）"><a href="#（2）Avalonia-学习笔记02-Fonts-and-Animations（字体和动画）" class="headerlink" title="（2）Avalonia 学习笔记02. Fonts and Animations（字体和动画）"></a>（2）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18976469">Avalonia 学习笔记02. Fonts and Animations（字体和动画）</a></h2><p>视频地址：<a target="_blank" rel="noopener" href="https://youtu.be/hAyeGWozi90?si=wio3G6GXImgymaUz">https://youtu.be/hAyeGWozi90?si=wio3G6GXImgymaUz</a></p>
<h3 id="2-1-App-axaml"><a href="#2-1-App-axaml" class="headerlink" title="2.1 App.axaml"></a>2.1 App.axaml</h3><p>引入自定义字体，这些字体如Phosphor还包含emoji，直接通过unicode调用而避免多个svg下载调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;Application xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.App&quot;</span><br><span class="line">             RequestedThemeVariant=&quot;Default&quot;&gt;</span><br><span class="line">             &lt;!-- &quot;Default&quot; ThemeVariant follows system theme variant. &quot;Dark&quot; or &quot;Light&quot; are other available options. --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Application.Styles&gt;</span><br><span class="line">        &lt;FluentTheme /&gt;</span><br><span class="line">        &lt;StyleInclude Source=&quot;Styles/AppDefaultStyles.axaml&quot;&gt;&lt;/StyleInclude&gt;</span><br><span class="line">    &lt;/Application.Styles&gt;</span><br><span class="line">     &lt;Application.Resources&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryForeground&quot;&gt;#CFCFCF&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryBackground&quot;&gt;#14172D&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;LinearGradientBrush x:Key=&quot;PrimaryBackgroundGradient&quot; StartPoint=&quot;0%, 0%&quot; EndPoint=&quot;100%, 0%&quot;&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;0&quot; Color=&quot;#111214&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;1&quot; Color=&quot;#151E3E&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">         &lt;/LinearGradientBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverBackground&quot;&gt;#333B5A&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverForeground&quot;&gt;White&lt;/SolidColorBrush&gt;</span><br><span class="line">         </span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoPro&quot;&gt;/Assets/Fonts/AkkoPro-Regular.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoProBold&quot;&gt;/Assets/Fonts/AkkoPro-Bold.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor&quot;&gt;/Assets/Fonts/Phosphor.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor-Fill&quot;&gt;/Assets/Fonts/Phosphor-Fill.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     &lt;/Application.Resources&gt;</span><br><span class="line">&lt;/Application&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>新增<code>&lt;FontFamily ...&gt;</code>(字体家族)</p>
<p>: 让程序展示时可以选择某个特定的字体风格，但需要先下载、存放，然后将Bulid Action修改为：AvaloniaResource。</p>
<ul>
<li><p><code>x:Key=&quot;AkkoPro&quot;</code>: 我们给这个字体起了个<strong>昵称（Key）</strong>，叫做 AkkoPro。之后在应用的其他地方，我们就可以通过这个昵称来使用它。</p>
</li>
<li><p>路径语法 (最关键的部分！)</p>
<p>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Assets/Fonts/AkkoPro-Regular.ttf#Akko Pro</span><br></pre></td></tr></table></figure>

<ul>
<li>这串字符分为两部分，由一个 # 分隔，<strong>两部分都非常重要</strong>。</li>
<li><strong># 前面的部分</strong>: <code>/Assets/Fonts/AkkoPro-Regular.ttf</code>是字体文件在项目中的<strong>物理路径</strong>。它告诉 Avalonia 去哪里找这个 .ttf 文件。</li>
<li><strong># 后面的部分</strong>: <code>Akko Pro</code> 是这个字体文件内部定义的<strong>真正的“字体家族名称”</strong>。你可以在 Windows 或 macOS 中双击字体文件，在预览窗口看到的那个名字。</li>
<li><strong>为什么要这样写？</strong> 因为一个字体家族（比如 “微软雅黑”）可能包含多个文件（常规体、粗体、细体）。通过指定相同的 #字体家族名称，Avalonia 才能把这些不同的文件识别为“一家人”，从而正确地应用粗体、斜体等样式。<strong>必须严格匹配。</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-2-Styles-AppDefaultStyles-axaml"><a href="#2-2-Styles-AppDefaultStyles-axaml" class="headerlink" title="2.2 Styles&#x2F;AppDefaultStyles.axaml"></a>2.2 Styles&#x2F;AppDefaultStyles.axaml</h3><p>定义按钮的样式，还要为图标、带图标的按钮、动画效果等制定规则。</p>
<p>这里的代码顺序和视频的不完全一样，方便记录笔记，能正常用。教程展示时用了不少margin修复字体不在button中心线上的BUG，但是新版本Avalonia(11.3.2)已经修复，所以相关的修复样式不包含在下方。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;Styles xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;&gt;</span><br><span class="line">    &lt;Design.PreviewWith&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot; Width=&quot;200&quot;&gt;</span><br><span class="line">            &lt;!-- Add Controls for Previewer Here --&gt;</span><br><span class="line">            &lt;!-- 这是一个预览区，包含了我们所有类型的按钮，让我们在编写样式时能立刻看到所有变化 --&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;200&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2C2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE346;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE7F2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE3EE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEB7A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE03A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Design.PreviewWith&gt;</span><br><span class="line">&lt;!-- ======== 核心样式规则 ======== --&gt;</span><br><span class="line">    &lt;!-- Add Styles Here --&gt;</span><br><span class="line">    &lt;!-- 1. 全局字体设定 (可选) --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Window&quot;&gt;</span><br><span class="line">        &lt;!-- &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt; --&gt;</span><br><span class="line">        &lt;!-- 这行被注释掉了，但它的作用是让整个应用的所有文字默认都使用 AkkoPro 字体。</span><br><span class="line">             这是一种高效的全局样式设置方法，利用了“属性继承”的特性。 --&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 2. 图标的基础样式 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon, Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor-Fill&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0 2 5 0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;19&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 3. “仅图标”样式的覆盖规则 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">     &lt;!-- 4. 文本部分的字体样式 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button, Label.akko&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 5. 所有按钮的基础外观 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;20&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;10&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 6. 动画的核心：为所有按钮定义“过渡”效果 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">            &lt;Transitions&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Foreground&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Background&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;TransformOperationsTransition Property=&quot;RenderTransform&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/TransformOperationsTransition&gt;</span><br><span class="line">            &lt;/Transitions&gt;</span><br><span class="line">        &lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 7. 标准按钮的“鼠标悬停”效果 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryHoverForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryHoverBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- ======== 特殊按钮：“透明按钮”的系列规则 ======== --&gt;</span><br><span class="line">    &lt;!-- 8. 透明按钮的基础样式 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 9. 透明按钮的图标样式（从“填充”变为“轮廓”） --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 10. 透明按钮的悬停效果：图标放大 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent:pointerover Label&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1.2)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;!-- 11. 透明按钮的悬停效果：保持背景透明 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/Styles&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>全局字体设定 (<code>Style Selector=&quot;Window&quot;</code>)</p>
<ul>
<li>这行被注释掉了，但它的作用是让整个应用的所有文字默认都使用 AkkoPro 字体。这是一种高效的全局样式设置方法，利用了“属性继承”的特性。</li>
</ul>
</li>
<li><p>图标的基础样式 (<code>Label.icon, Label.icon-only</code>)</p>
<ul>
<li><p><strong>目标</strong>: 定义所有图标的通用外观。</p>
</li>
<li><p><strong>选择器</strong>: Label.icon, Label.icon-only 同时选中了带 icon 类的和带 icon-only 类的 Label。</p>
</li>
<li><p>作用</p>
<p>:</p>
<ul>
<li><code>FontFamily</code>: 将字体设置为 Phosphor-Fill（填充样式的图标字体）。</li>
<li><code>Margin=&quot;0 2 5 0&quot;</code>: 这是一个微调。上边距为2可以修正垂直对齐，右边距为5是为了在图标和文字之间创造一个舒适的间距。</li>
<li><code>FontSize</code>: 设置图标的大小。</li>
</ul>
</li>
</ul>
</li>
<li><p>“仅图标”样式的覆盖规则 (<code>Label.icon-only</code>)</p>
<ul>
<li><strong>目标</strong>: 修正只有一个图标时的边距。</li>
<li><strong>选择器</strong>: <code>Label.icon-only</code> 比上面的选择器更具体且在下方（一样具体的规则，下方规则会覆盖上方规则）。</li>
<li><strong>核心概念：样式覆盖 (Override)</strong>。当一个控件同时匹配多个样式规则时，<strong>更具体</strong>的规则会<strong>覆盖</strong>掉宽泛的规则。</li>
<li><strong>作用</strong>: <code>Margin=&quot;0&quot;</code>。因为这个 Label 是单独存在的，旁边没有文字，所以我们不再需要右边的 5 个间距。这条规则会覆盖掉上一条规则中的 Margin 设置，将所有外边距重置为0，让这个单独的图标能在按钮里完美居中。</li>
</ul>
</li>
<li><p>文本部分的字体样式 (<code>Button, Label.akko</code>)</p>
<ul>
<li>为所有按钮和带 akko 类的 Label 设置了文字字体。</li>
</ul>
</li>
<li><p>所有按钮的基础外观 (<code>Button</code>)</p>
<ul>
<li>为所有按钮设置了统一的字体大小、圆角和默认的前景色&#x2F;背景色。</li>
</ul>
</li>
<li><p>动画的核心：过渡效果 (<code>Button /template/ ContentPresenter</code>)</p>
<ul>
<li><strong>目标</strong>: 让所有按钮的颜色和大小变化都变得平滑。</li>
<li><code>RenderTransform=&quot;scale(1)&quot;</code>: 设置一个“动画前”的初始状态，即原始大小。</li>
<li><code>Transitions</code>: <strong>这是实现动画的核心。<strong>Avalonia接收这个参数后：“对于任何按钮，当它的背景、前景或大小（Transform）要改变时，花 0.1 秒来平滑过渡。” 这是一个</strong>一次性声明</strong>，之后的所有相关变化都会自动应用此动画。</li>
</ul>
</li>
<li><p>标准按钮的“鼠标悬停”效果 (<code>Button:pointerover ...</code>)</p>
<ul>
<li><strong>目标</strong>: 定义鼠标放在<strong>普通按钮</strong>上时，它应该变成什么样子。</li>
<li><strong>作用</strong>: 改变 <code>Foreground</code> 和 <code>Background</code> 的值为我们预设的悬停颜色。</li>
<li><strong>它如何与动画配合？</strong> 当鼠标移上去时，这条规则被激活，Avalonia 准备将背景色从 <code>PrimaryBackground</code> 改为 <code>PrimaryHoverBackground</code>。这时，第6条规则里的 <code>Transitions</code> 就会介入：“不立刻改，花0.1秒慢慢变过去”。 于是，实现了平滑的渐变效果。</li>
</ul>
</li>
<li><p>透明按钮的基础样式 (<code>Button.transparent</code>)</p>
<ul>
<li><strong>目标</strong>: 创建一种新的按钮变体——透明按钮。</li>
<li><strong>选择器</strong>: <code>Button.transparent</code> 只会选中那些在 XAML 中被我们写上 <code>Classes=&quot;transparent&quot;</code> 的按钮。</li>
<li><strong>作用</strong>: 简单地将背景设置为透明。</li>
</ul>
</li>
<li><p>透明按钮的图标样式 (<code>Button.transparent Label.icon-only</code>)</p>
<ul>
<li><strong>目标</strong>: 让透明按钮里的图标看起来不一样（例如，更精致）。</li>
<li><strong>选择器</strong>: 这个选择器非常具体：“找到一个带 <code>transparent</code> 类的按钮，然后再找到它<strong>里面</strong>的那个带 <code>icon-only</code> 类的 <code>Label</code>”。</li>
<li><strong>作用</strong>: <code>FontFamily=&quot;{DynamicResource Phosphor}&quot;</code>。它将这个特定图标的字体从默认的 <code>Phosphor-Fill (填充)</code> <strong>覆盖</strong>为了 Phosphor (轮廓)。</li>
</ul>
</li>
<li><p>透明按钮的悬停效果：图标放大 (<code>Button.transparent:pointerover Label</code>)</p>
<ul>
<li><strong>目标</strong>: 给透明按钮一个独特的悬停反馈。</li>
<li><strong>选择器</strong>: “当鼠标悬停在一个 <code>transparent</code> 按钮上时，找到它里面的任何 <code>Label</code>”。</li>
<li><strong>作用</strong>: <code>RenderTransform=&quot;scale(1.2)&quot;</code>。让图标放大到1.2倍。同样，这个变化也会被第6条规则里的 <code>Transitions</code> 捕捉到，从而产生平滑的放大动画。</li>
</ul>
</li>
<li><p>透明按钮的悬停效果：保持背景透明 (<code>Button.transparent:pointerover ...</code>)</p>
<ul>
<li><strong>目标</strong>: 阻止透明按钮在悬停时出现标准按钮的背景色。</li>
<li><strong>核心概念：再次覆盖！</strong> 如果没有这条规则，当鼠标悬停在透明按钮上时，它会同时匹配第7条规则（<code>Button:pointerover</code>）和第8条规则（<code>Button.transparent</code>）。通常颜色会覆盖透明，导致出现不想要的背景。</li>
<li><strong>作用</strong>: <code>Background=&quot;Transparent&quot;</code>。这条规则更具体，它强行规定：“即使是在悬停状态，透明按钮的背景也<strong>必须是透明的</strong>”，从而覆盖了第7条规则中设置悬停背景色的行为。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-3-MainWindow-axaml"><a href="#2-3-MainWindow-axaml" class="headerlink" title="2.3 MainWindow.axaml"></a>2.3 MainWindow.axaml</h3><p>以前的按钮里只有一个简单的文本，现在我们要把“图标”和“文字”两个东西都放进去，图标使用unicode指定Phosphor内的emoji。<code>&amp;#x</code>是unicode开头，以<code>;</code>结尾，中间的就是Unicode值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1024&quot; d:DesignHeight=&quot;600&quot;</span><br><span class="line">        Width=&quot;1024&quot; Height=&quot;600&quot;</span><br><span class="line">        x:Class=&quot;AvaloniaApplication2.MainWindow&quot;</span><br><span class="line">        Title=&quot;AvaloniaApplication2&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Grid Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot; ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot;&gt;</span><br><span class="line">            &lt;Grid RowDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;200&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2C2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE346;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE7F2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE3EE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEB7A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE03A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot;&gt;</span><br><span class="line">                    &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;/Button&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>按钮内部的 <code>StackPanel</code></p>
<p>:</p>
<ul>
<li>一个 <code>&lt;Button&gt;</code>的 <code>Content</code> (内容) 属性很灵活，它不只能放文字，可以放<strong>任何单个控件</strong>。</li>
<li>为了在按钮里并排显示图标和文字，我们先放一个<code>&lt;StackPanel&gt;</code>作为唯一的“容器”。</li>
<li><code>Orientation=&quot;Horizontal&quot;</code>: 让这个 <code>StackPanel</code>里的东西<strong>从左到右</strong>排列。</li>
<li>然后，我们在这个水平的 <code>StackPanel</code> 里放入一个用于显示图标的 <code>Label</code> 和一个用于显示文字的 <code>Label</code>。</li>
</ul>
</li>
<li><p><code>Classes=&quot;icon&quot;</code> (贴上标签&#x2F;类)</p>
<p>:</p>
<ul>
<li>这就是我们之前在样式文件中定义的“类选择器”的应用之处。</li>
<li><code>&lt;Label Classes=&quot;icon&quot; ...&gt;</code>: 我们给这个 <code>Label</code> 贴上了 <code>icon</code> 的标签。于是，AppDefaultStyles.axaml 中那条 <code>Selector=&quot;Label.icon&quot;</code> 的规则就会自动找到它，并把它变成 <code>Phosphor</code> 图标字体、调整它的边距。</li>
<li><code>&lt;Label Classes=&quot;akko&quot; ...&gt;</code>: 同理，这个 <code>Label</code> 被应用了 <code>akko</code> 字体样式。</li>
<li><strong>这就是分离的威力</strong>：MainWindow.axaml 只负责<strong>结构和内容</strong>（一个图标挨着一个文字），而 AppDefaultStyles.axaml 负责<strong>外观</strong>（它应该长什么样）。</li>
</ul>
</li>
<li><p><code>Content=&quot;\&amp;\#xE03A;&quot;</code>(Unicode 图标，因为没有字体库通常是无法正常显示)</p>
<p>:</p>
<ul>
<li><strong>图标字体</strong>的原理是，它把一些特殊的 <strong>Unicode 编码</strong>“画”成了图标。</li>
<li><code>&amp;#x...;</code>是在 XAML 中输入一个十六进制 Unicode 码的标准写法。</li>
<li>E2C2 就是我们在 Phosphor Icons 网站上查到的“房子”图标对应的编码。</li>
<li><strong>你不需要记这些编码</strong>，只需要从网站上复制，然后粘贴到 Content 属性里，并用 &amp;#x 和 ; 包起来即可。</li>
</ul>
</li>
<li><p><code>Button Classes=&quot;transparent&quot;</code></p>
<p>:</p>
<ul>
<li>对于底部的设置按钮，我们给它贴上了<code>transparent</code>的标签。</li>
<li>这样，我们为<code>.transparent</code>类定义的所有样式（背景透明、悬停时图标放大等）就都会自动应用到这个按钮上。</li>
</ul>
</li>
</ul>
<h3 id="2-4-样式优先级"><a href="#2-4-样式优先级" class="headerlink" title="2.4 样式优先级"></a>2.4 样式优先级</h3><p>AppDefaultStyles.axaml内的样式代码是有顺序的，如果随意调整效果可能不尽如人意，因为样式是由优先级之分！</p>
<p>后面有一集教程专门讲样式优先级，这里就简单复制一些网上内容。</p>
<p>最简单来说：<strong>样式选择器越具体，其优先级越高！</strong></p>
<h3 id="2-4-1-定义-Definition"><a href="#2-4-1-定义-Definition" class="headerlink" title="2.4.1 定义 (Definition)"></a>2.4.1 定义 (Definition)</h3><p><strong>样式优先级</strong>是 Avalonia 用来解决样式冲突的一套确定性规则。当一个控件的同一个属性（如 Background）被多个不同的样式规则同时设置时，Avalonia 会根据这套优先级规则，决定最终应用哪一个样式的值。</p>
<p>理解这套规则对于调试样式问题和编写可维护的、可预测的 UI至关重要。</p>
<h3 id="2-4-2-优先级判定规则-The-Rules-of-Priority-Determination"><a href="#2-4-2-优先级判定规则-The-Rules-of-Priority-Determination" class="headerlink" title="2.4.2 优先级判定规则 (The Rules of Priority Determination)"></a>2.4.2 优先级判定规则 (The Rules of Priority Determination)</h3><p>Avalonia 判定优先级遵循一个严格的顺序。以下规则按<strong>从高到低</strong>的优先级排列：</p>
<p>直接在控件的 XAML 标签上设置的属性值。这是最高优先级，它会覆盖任何来自样式文件的规则。</p>
<ul>
<li>用法：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Background=&quot;Red&quot; Content=&quot;This will be red&quot;/&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>注意事项</p>
<p>:</p>
<ul>
<li>优先级最高，难以被外部样式覆盖。</li>
<li>不利于样式复用和统一维护，应尽量避免在大型项目中使用，主要用于快速原型或特定的一次性覆盖。</li>
</ul>
</li>
</ul>
<p>这是最核心的规则。Avalonia 会评估一个选择器的“具体程度”。选择器的构成越复杂、限制条件越精确，其优先级就越高。</p>
<ul>
<li><strong>定义</strong>: 一个选择器的具体性由其构成的组件（如类型、类、伪类）决定。</li>
<li><strong>用法</strong>: 通过组合不同的选择器来精确地定位目标控件。例如，Button.transparent:pointerover 比 Button:pointerover 更具体。</li>
<li><strong>详细说明</strong>: 见第3节。</li>
</ul>
<p>当两个或多个样式规则的<strong>具体性完全相同时</strong>，在 .axaml 文件中<strong>定义在后面的规则会覆盖定义在前面的规则</strong>。</p>
<ul>
<li><strong>用法</strong>:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 规则 A --&gt;</span><br><span class="line">&lt;Style Selector=&quot;Button&quot;&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Background&quot; Value=&quot;Blue&quot;/&gt;</span><br><span class="line">&lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 规则 B，具体性与A相同，但定义在后 --&gt;</span><br><span class="line">&lt;Style Selector=&quot;Button&quot;&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Background&quot; Value=&quot;Green&quot;/&gt;</span><br><span class="line">&lt;/Style&gt;</span><br><span class="line">&lt;!-- 结果: 按钮背景为绿色 --&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意事项</strong>:<ul>
<li>这是组织样式文件结构的重要依据。通常将通用的、基础的样式放在文件前面，将特殊的、覆盖性的样式放在后面。</li>
</ul>
</li>
</ul>
<p>这是优先级最低的样式，由引入的主题（如 ）提供。我们编写的任何自定义样式，只要能匹配到控件，其优先级都高于主题默认样式。</p>
<h3 id="2-4-3-选择器具体性-Selector-Specificity-详解"><a href="#2-4-3-选择器具体性-Selector-Specificity-详解" class="headerlink" title="2.4.3 选择器具体性 (Selector Specificity) 详解"></a>2.4.3 选择器具体性 (Selector Specificity) 详解</h3><p>一个选择器的具体性由构成它的所有组件共同决定，可以理解为一个加权计分系统。分数越高的选择器，优先级越高。</p>
<p>以下是各组件的大致权重参考，注意这里计分系统是<strong>教学模型</strong>，帮助理解，官方文档没有这种具体数值：</p>
<table>
<thead>
<tr>
<th>组件类型</th>
<th>示例</th>
<th>权重 (参考值)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>名称选择器 (Name)</strong></td>
<td>#MyUniqueButton</td>
<td><strong>100</strong></td>
</tr>
<tr>
<td><strong>类选择器 (Class)</strong></td>
<td>.transparent</td>
<td><strong>10</strong></td>
</tr>
<tr>
<td><strong>伪类 (PseudoClass)</strong></td>
<td>:pointerover, :disabled</td>
<td><strong>10</strong></td>
</tr>
<tr>
<td><strong>类型选择器 (Type)</strong></td>
<td>Button, Label</td>
<td><strong>1</strong></td>
</tr>
</tbody></table>
<p>让我们用这个权重系统来分析您笔记中的代码：</p>
<p><strong>场景A: Label.icon-only 的 Margin 覆盖问题</strong></p>
<ul>
<li><p>规则 1</p>
<p>: Style Selector&#x3D;”Label.icon, Label.icon-only”</p>
<ul>
<li>对于 Label.icon-only 部分，其具体性 &#x3D; 1 (Label) + 10 (.icon-only) &#x3D; <strong>11</strong>。</li>
</ul>
</li>
<li><p>规则 2</p>
<p>: Style Selector&#x3D;”Label.icon-only”</p>
<ul>
<li>具体性 &#x3D; 1 (Label) + 10 (.icon-only) &#x3D; <strong>11</strong>。</li>
</ul>
</li>
</ul>
<p>两个规则的具体性分数完全相同。根据 <strong>规则 2.3 (定义顺序)</strong>，写在后面的规则 2 会覆盖规则 1。因此，Margin&#x3D;”0” 生效。</p>
<p><strong>场景B: Button.transparent:pointerover 的 Background 覆盖问题</strong></p>
<ul>
<li><p>规则 1 (标准悬停)</p>
<p>: Style Selector&#x3D;”Button:pointerover …”</p>
<ul>
<li>具体性 &#x3D; 1 (Button) + 10 (:pointerover) &#x3D; <strong>11</strong>。</li>
</ul>
</li>
<li><p>规则 2 (透明悬停)</p>
<p>: Style Selector&#x3D;”Button.transparent:pointerover …”</p>
<ul>
<li>具体性 &#x3D; 1 (Button) + 10 (.transparent) + 10 (:pointerover) &#x3D; <strong>21</strong>。</li>
</ul>
</li>
</ul>
<p>规则 2 的具体性分数 (21) 高于规则 1 (11)。因此，无论它们的定义顺序如何，Avalonia 都会应用规则 2 的值，Background 被设置为 Transparent。</p>
<h3 id="2-4-4-特殊修饰符：-important"><a href="#2-4-4-特殊修饰符：-important" class="headerlink" title="2.4.4 特殊修饰符：!important"></a>2.4.4 特殊修饰符：<code>!important</code></h3><p>这是一个可以打破正常优先级规则的特殊工具。</p>
<p>在 <code>Setter</code> 的<code>Value</code> 字符串末尾添加<code>!important</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Setter Property=&quot;Background&quot; Value=&quot;Red !important&quot; /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>极高优先级</strong>: !important 会使该条设置的优先级高于几乎所有其他样式，包括内联样式。</li>
<li><strong>破坏可维护性</strong>: 滥用 !important 会使样式层级变得混乱，后续调试和覆盖会变得极其困难。</li>
<li><strong>使用时机</strong>: 仅在万不得已的情况下使用，例如需要覆盖一个第三方控件库中你不便修改的、且优先级很高的样式时。<strong>在自己的项目中应极力避免。</strong></li>
</ul>
<h3 id="2-4-5-最佳实践与使用建议-Best-Practices"><a href="#2-4-5-最佳实践与使用建议-Best-Practices" class="headerlink" title="2.4.5 最佳实践与使用建议 (Best Practices)"></a>2.4.5 最佳实践与使用建议 (Best Practices)</h3><ol>
<li><strong>优先使用类选择器</strong>: 通过为控件添加 Classes 来定义不同的变体，这是管理和覆盖样式的首选方式，清晰且可控。</li>
<li><strong>合理组织文件</strong>: 将通用样式放在样式文件的顶部，将更具体的或派生的样式放在下面，利用定义顺序规则。</li>
<li><strong>避免内联样式</strong>: 将样式集中在 .axaml 样式文件中，以实现关注点分离和便于维护。</li>
<li><strong>谨慎使用 !important</strong>: 将其视为解决棘手问题的最后手段，而不是常规工具。</li>
</ol>
<h2 id="（3）Avalonia-学习笔记03-View-Model-Basics（视图模型基础）"><a href="#（3）Avalonia-学习笔记03-View-Model-Basics（视图模型基础）" class="headerlink" title="（3）Avalonia 学习笔记03. View Model Basics（视图模型基础）"></a>（3）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18976499">Avalonia 学习笔记03. View Model Basics（视图模型基础）</a></h2><p>视频链接：<a target="_blank" rel="noopener" href="https://youtu.be/kOLGAUPvRwY?si=idUPT34tn9L9C58j">https://youtu.be/kOLGAUPvRwY?si=idUPT34tn9L9C58j</a></p>
<p><strong>前置准备</strong>：在开始前，请确保已经通过 NuGet 包管理器为你的项目添加了 CommunityToolkit.Mvvm 包。</p>
<p>这一节的核心目标是引入 <strong>MVVM</strong> 设计模式中的 <strong>ViewModel</strong>（视图模型）层，实现UI（视图）与数据和逻辑（视图模型）的分离，并通过**数据绑定（Data Binding）**将它们连接起来。</p>
<p><strong>核心概念：什么是 MVVM？</strong></p>
<p>MVVM 是一种软件架构模式，旨在将用户界面（View）的开发与业务逻辑和数据（Model）的开发分离开来。</p>
<ul>
<li><strong>View (视图)</strong>：用户所看到的界面。在 Avalonia 中，这通常是 .axaml 文件。它只负责“显示”数据和将用户的操作（如点击）传递出去，自身不包含任何业务逻辑。</li>
<li><strong>Model (模型)</strong>：应用程序的核心数据和业务逻辑。</li>
<li><strong>ViewModel (视图模型)</strong>：作为 View 和 Model 之间的桥梁。它从 Model 中获取数据，并将其转换为 View 可以直接显示的格式。同时，它包含 View 所需的命令（Commands），用于响应用户的操作。<strong>View “绑定” 到 ViewModel 的属性和命令上</strong>。</li>
</ul>
<p>这种模式最大的好处是<strong>数据驱动UI</strong>。我们只需要在 ViewModel 中改变数据，UI 就会自动更新，反之亦然。这使得代码更易于维护、测试和扩展。</p>
<h3 id="3-1-创建基础-ViewModel"><a href="#3-1-创建基础-ViewModel" class="headerlink" title="3.1 创建基础 ViewModel"></a>3.1 创建基础 ViewModel</h3><p>为了代码的整洁和复用，我们首先创建一个所有 ViewModel 的基类。</p>
<ol>
<li>在项目中创建一个名为 ViewModels 的新文件夹。</li>
<li>在该文件夹下，创建一个名为 ViewModelBase.cs 的类。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ViewModels/ViewModelBase.cs</span><br><span class="line">using CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"></span><br><span class="line">namespace AvaloniaApplication2.ViewModels;</span><br><span class="line"></span><br><span class="line">// 这个类将作为项目中所有 ViewModel 的基类</span><br><span class="line">public class ViewModelBase : ObservableObject</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ObservableObject 是 CommunityToolkit.Mvvm 包提供的一个核心类。</li>
<li>任何继承自 ObservableObject 的类，都自动获得了“通知”能力。当它的某个属性发生变化时，它能够主动发出通知。UI界面上绑定了该属性的元素在收到通知后，就会自动更新其显示内容。</li>
<li>这背后实现的是一个叫做 INotifyPropertyChanged 的接口，但 ObservableObject 已经为我们处理了所有复杂的细节。</li>
</ul>
<hr>
<h3 id="3-2-创建主窗口的-ViewModel"><a href="#3-2-创建主窗口的-ViewModel" class="headerlink" title="3.2 创建主窗口的 ViewModel"></a>3.2 创建主窗口的 ViewModel</h3><p>接下来，我们为 MainView 创建一个专属的 ViewModel。</p>
<ol>
<li>在 ViewModels 文件夹下，创建一个名为 MainViewModel.cs 的类。<br><em>(注意：您的笔记框架中文件名为 ViewModelModel.cs，根据类名 MainViewModel，这里应该是 MainViewModel.cs)</em></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ViewModels/MainViewModel.cs</span><br><span class="line">using CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line">using CommunityToolkit.Mvvm.Input;</span><br><span class="line"></span><br><span class="line">namespace AvaloniaApplication2.ViewModels;</span><br><span class="line"></span><br><span class="line">// &#x27;partial&#x27; 关键字是必须的，它允许源代码生成器在编译时为这个类添加代码</span><br><span class="line">public partial class MainViewModel : ViewModelBase</span><br><span class="line">&#123;</span><br><span class="line">    // [ObservableProperty] 是一个“特性”，它会自动为一个私有字段生成一个公共属性</span><br><span class="line">    // 在这里，它会为 _sideMenuExpanded 字段生成一个名为 SideMenuExpanded 的公共属性</span><br><span class="line">    // 当 SideMenuExpanded 属性的值被改变时，它会自动发出通知</span><br><span class="line">    [ObservableProperty]</span><br><span class="line">    private bool _sideMenuExpanded = true;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    // [RelayCommand] 特性将一个方法包装成一个可以被UI绑定的命令</span><br><span class="line">    // 在这里，它会创建一个名为 SideMenuResizeCommand 的命令</span><br><span class="line">    [RelayCommand]</span><br><span class="line">    private void SideMenuResize()</span><br><span class="line">    &#123;</span><br><span class="line">        // 这行代码会切换布尔值的状态（true -&gt; false, false -&gt; true）</span><br><span class="line">        SideMenuExpanded = !SideMenuExpanded;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>partial class</strong>: 这个关键字允许一个类的定义被分割到多个文件中。在这里，它允许 CommunityToolkit 的**源代码生成器（Source Generator）**在编译过程中“注入”代码到 MainViewModel 类中，比如自动生成 SideMenuExpanded 属性和 SideMenuResizeCommand 命令的完整实现。</li>
<li><strong>[ObservableProperty]</strong>: 这是一个极其方便的特性。你只需在私有字段（如 _sideMenuExpanded）上标记它，它就会自动生成一个公共属性（首字母大写，即 SideMenuExpanded），并包含所有必要的通知逻辑。我们不再需要手动编写 get 和 set 以及调用通知事件。</li>
<li><strong>[RelayCommand]</strong>: 这个特性将一个普通方法（如 SideMenuResize）转换成一个实现了 ICommand 接口的命令对象（SideMenuResizeCommand）。在 MVVM 中，我们倾向于使用命令而不是事件来处理用户交互，因为这能让 ViewModel 与 View 完全解耦（ViewModel 不知道也不关心是哪个按钮触发了这个命令）。</li>
</ul>
<hr>
<h3 id="3-3-将-View-与-ViewModel-连接起来"><a href="#3-3-将-View-与-ViewModel-连接起来" class="headerlink" title="3.3 将 View 与 ViewModel 连接起来"></a>3.3 将 View 与 ViewModel 连接起来</h3><p>现在我们有了 View 和 ViewModel，需要将它们“绑定”在一起。</p>
<h3 id="3-3-1-在应用启动时设置-DataContext"><a href="#3-3-1-在应用启动时设置-DataContext" class="headerlink" title="3.3.1 在应用启动时设置 DataContext"></a>3.3.1 在应用启动时设置 DataContext</h3><p>我们在应用启动时，将 MainViewModel 的一个实例指定为 MainView 的“数据上下文”（DataContext）。DataContext 就像是为这个 View 指定了一个专属的“数据管家”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">App.axaml.cs</span><br><span class="line">using Avalonia;</span><br><span class="line">using Avalonia.Controls.ApplicationLifetimes;</span><br><span class="line">using Avalonia.Markup.Xaml;</span><br><span class="line">// 引入 ViewModels 命名空间</span><br><span class="line">using AvaloniaApplication2.ViewModels;</span><br><span class="line"></span><br><span class="line">namespace AvaloniaApplication2;</span><br><span class="line"></span><br><span class="line">public partial class App : Application</span><br><span class="line">&#123;</span><br><span class="line">    public override void Initialize()</span><br><span class="line">    &#123;</span><br><span class="line">        AvaloniaXamlLoader.Load(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void OnFrameworkInitializationCompleted()</span><br><span class="line">    &#123;</span><br><span class="line">        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)</span><br><span class="line">        &#123;</span><br><span class="line">            desktop.MainWindow = new MainView</span><br><span class="line">            &#123;</span><br><span class="line">                // 为主窗口(MainView)设置数据上下文(DataContext)</span><br><span class="line">                // 这样 MainView 及其所有子控件都能访问到 MainViewModel 里的数据</span><br><span class="line">                DataContext = new MainViewModel()</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        base.OnFrameworkInitializationCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-在-XAML-中进行数据绑定"><a href="#3-3-2-在-XAML-中进行数据绑定" class="headerlink" title="3.3.2 在 XAML 中进行数据绑定"></a>3.3.2 在 XAML 中进行数据绑定</h3><p>设置好 DataContext后，我们就可以在 MainView.axaml 中使用 {Binding} 语法来访问 MainViewModel 中的属性和命令了。</p>
<p><code>MainView.axaml</code>,由<code>MainWindow.axaml</code>改名而来。</p>
<p>按照惯例，你通常可以把视图模型命名为 MainWindowViewModel，或者你也可以把 MainWindow 重命名为 MainView（通常不带 “Window” 后缀）。这个教程作者习惯叫<code>MainViewModel</code>，所以把MainWindow.axaml改名为<code>MainView.axaml</code>实现命名上统一。</p>
<p>首先，我们需要在 Window 标签中声明 ViewModel 的命名空间和数据类型，这能为我们提供更好的智能提示和编译时类型检查。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window ...</span><br><span class="line">        xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainViewModel&quot;</span><br><span class="line">        ...&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 这个 DataContext 只在设计器（预览窗口）中生效，让我们可以在不运行程序的情况下看到绑定效果 --&gt;</span><br><span class="line">    &lt;Design.DataContext&gt;</span><br><span class="line">        &lt;vm:MainViewModel&gt;&lt;/vm:MainViewModel&gt;</span><br><span class="line">    &lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- ... 省略部分代码 ... --&gt;</span><br><span class="line">&lt;!-- ... --&gt;</span><br><span class="line">&lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">    &lt;!-- 将 PointerPressed 事件连接到代码隐藏文件中的处理方法 --&gt;</span><br><span class="line">    &lt;!-- IsVisible 属性绑定到 SideMenuExpanded。当其为 true 时，图片可见 --&gt;</span><br><span class="line">    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage Assets/Images/logo.svg&#125;&quot; Width=&quot;220&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- IsVisible 属性绑定到 SideMenuExpanded 的反值(!)。当其为 false 时，图片可见 --&gt;</span><br><span class="line">    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage Assets/Images/icon.svg&#125;&quot; Width=&quot;22&quot; IsVisible=&quot;&#123;Binding !SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- ... --&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">            &lt;Label Classes=&quot;icon&quot; Content=&quot;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;!-- 这个 Label 的可见性同样由 SideMenuExpanded 控制 --&gt;</span><br><span class="line">            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Button&gt;</span><br><span class="line">    &lt;!-- ... 其他按钮的 Label 也做同样绑定 ... --&gt;</span><br><span class="line">&lt;/StackPanel&gt;</span><br><span class="line">&lt;!-- ... --&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>xmlns:vm&#x3D;”…”: 定义一个XML命名空间别名 vm，指向我们的 ViewModels 文件夹。</li>
<li>x:DataType&#x3D;”vm:MainViewModel”: 明确告诉编译器和设计器，这个 View 的 DataContext 是 MainViewModel 类型的。</li>
<li>d:DataContext: d: 代表 design-time（设计时）。这个设置仅用于 IDE 的预览窗口，它让预览器也创建一个 MainViewModel 实例，这样我们就能实时看到绑定后的UI效果。</li>
<li>{Binding SideMenuExpanded}: 这是核心的数据绑定语法。它将 IsVisible 属性与 MainViewModel 中的 SideMenuExpanded 公共属性连接起来。</li>
<li>{Binding !SideMenuExpanded}: Avalonia 的绑定引擎支持简单的逻辑运算，! 表示取反。所以这个图片会在 SideMenuExpanded 为 false 时显示。</li>
</ul>
<h3 id="3-3-3-连接用户操作与-ViewModel-命令"><a href="#3-3-3-连接用户操作与-ViewModel-命令" class="headerlink" title="3.3.3 连接用户操作与 ViewModel 命令"></a>3.3.3 连接用户操作与 ViewModel 命令</h3><p>最后，我们需要将用户的双击操作，连接到 MainViewModel 中的 SideMenuResizeCommand 命令。这是在 MainView.axaml.cs（代码隐藏文件）中完成的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">MainView.axaml.cs</span><br><span class="line">using Avalonia.Controls;</span><br><span class="line">using Avalonia.Input;</span><br><span class="line">using AvaloniaApplication2.ViewModels;</span><br><span class="line"></span><br><span class="line">namespace AvaloniaApplication2;</span><br><span class="line"></span><br><span class="line">public partial class MainView : Window</span><br><span class="line">&#123;</span><br><span class="line">    public MainView()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 这个方法在 XAML 中通过 PointerPressed=&quot;InputElement_OnPointerPressed&quot; 绑定</span><br><span class="line">    private void InputElement_OnPointerPressed(object? sender, PointerPressedEventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        // e.ClickCount 可以获取鼠标点击次数，我们只关心双击</span><br><span class="line">        if (e.ClickCount != 2)</span><br><span class="line">            return;</span><br><span class="line">        </span><br><span class="line">        // (DataContext as MainViewModel) 尝试将 DataContext 转换成 MainViewModel 类型</span><br><span class="line">        // ?. 是空条件运算符，如果转换失败（DataContext不是MainViewModel），则不执行后面的代码，避免程序崩溃</span><br><span class="line">        // .Execute(null) 执行 ViewModel 中的命令</span><br><span class="line">        (DataContext as MainViewModel)?.SideMenuResizeCommand.Execute(null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然我们尽量避免在代码隐藏文件中写逻辑，但这种将 View 的特定事件（如 PointerPressed）“翻译”成调用 ViewModel 命令的代码是完全可以接受的。它充当了一个干净的“粘合剂”，并且没有将任何业务逻辑耦合到 View 中。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上步骤，我们完成了一个完整的 <strong>View -&gt; ViewModel -&gt; View</strong> 的数据流动闭环：</p>
<ol>
<li><strong>用户操作</strong>: 用户双击图片 (View)。</li>
<li><strong>事件触发</strong>: PointerPressed 事件在 MainView.axaml.cs 中被捕获。</li>
<li><strong>命令执行</strong>: 代码调用 DataContext (即 MainViewModel) 的 SideMenuResizeCommand。</li>
<li><strong>数据更新</strong>: MainViewModel 中的 SideMenuResize 方法被执行，SideMenuExpanded 属性的值发生改变。</li>
<li><strong>变更通知</strong>: 因为 SideMenuExpanded 是一个 ObservableProperty，它会自动发出“我变了”的通知。</li>
<li><strong>UI 自动更新</strong>: MainView.axaml 中所有绑定到 SideMenuExpanded 的UI元素（图片和文字）收到通知，并自动更新它们的 IsVisible 状态，从而实现了菜单的折叠&#x2F;展开效果。</li>
</ol>
<h2 id="（4）Avalonia-学习笔记04-Page-Navigation（页面导航）"><a href="#（4）Avalonia-学习笔记04-Page-Navigation（页面导航）" class="headerlink" title="（4）Avalonia 学习笔记04. Page Navigation（页面导航）"></a>（4）<a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18976504">Avalonia 学习笔记04. Page Navigation（页面导航）</a></h2><p>视频链接：<a target="_blank" rel="noopener" href="https://youtu.be/RW4fvs8qnjE?si=PXlszBf4pdB-x3mU">https://youtu.be/RW4fvs8qnjE?si=PXlszBf4pdB-x3mU</a></p>
<p>本节课的目标是实现应用内的页面切换功能。我们将创建一个核心的 ViewLocator 类，它能根据当前需要显示的 ViewModel 自动查找并加载对应的 View。同时，我们会为侧边栏的按钮添加命令绑定，实现点击按钮切换页面的功能，并为当前选中的页面按钮添加高亮样式，以提供清晰的视觉反馈。</p>
<h3 id="4-1-ViewLocator-cs"><a href="#4-1-ViewLocator-cs" class="headerlink" title="4.1 ViewLocator.cs"></a>4.1 ViewLocator.cs</h3><p>在项目根目录下新建一个 ViewLocator.cs 文件。这个类是本节课实现页面导航的核心。</p>
<p>它的作用是充当一个“视图定位器”。当你告诉应用“显示这个 ViewModel”时，ViewLocator 会自动找到并实例化与之对应的 View，并将两者关联起来。</p>
<p>这遵循了 MVVM 模式中一个重要的思想：“<strong>约定优于配置</strong>”(Convention over Configuration)。我们只需要遵循 HomePageViewModel &#x2F; HomePageView 这样的命名约定，ViewLocator 就能自动完成工作，而无需我们手动编写大量的 if-else 或 switch 语句来指定哪个 ViewModel 对应哪个 View。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Controls;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Controls.Templates;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.ViewModels; <span class="comment">// 确保 using 了 ViewModels 命名空间</span></span><br><span class="line"><span class="comment">// using AvaloniaApplication2.Views; // 这个 using 在当前代码中不是必需的，但保留也无妨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IDataTemplate 是一个接口，它定义了一种根据数据（Data）创建 UI 元素（控件）的规范。</span></span><br><span class="line"><span class="comment">// 我们的 ViewLocator 实现了这个接口，意味着它能将一个数据对象（在这里是 ViewModel）转换成一个视图控件（View）。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ViewLocator</span> : <span class="title">IDataTemplate</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Build 方法是 IDataTemplate 接口的核心。</span></span><br><span class="line">    <span class="comment">// 当 Match 方法返回 true 时，Avalonia 框架会调用 Build 方法，</span></span><br><span class="line">    <span class="comment">// 并将数据对象（data）传递进来，期望返回一个可以显示的控件（Control）。</span></span><br><span class="line">    <span class="keyword">public</span> Control? Build(<span class="built_in">object</span>? data)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果传入的数据是 null，直接返回 null，不做任何处理。</span></span><br><span class="line">        <span class="keyword">if</span> (data <span class="keyword">is</span> <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这是 ViewLocator 的核心魔法：</span></span><br><span class="line">        <span class="comment">// 1. data.GetType().FullName! 获取 ViewModel 的完整类名，例如 &quot;AvaloniaApplication2.ViewModels.HomePageViewModel&quot;。</span></span><br><span class="line">        <span class="comment">// 2. .Replace(&quot;ViewModel&quot;, &quot;View&quot;, ...) 将类名中的 &quot;ViewModel&quot; 替换为 &quot;View&quot;。</span></span><br><span class="line">        <span class="comment">//    结果就变成了 &quot;AvaloniaApplication2.Views.HomePageView&quot;。</span></span><br><span class="line">        <span class="comment">//    这就是我们的“约定”：View 和 ViewModel 的命名必须遵循这个模式。</span></span><br><span class="line">        <span class="keyword">var</span> viewName = data.GetType().FullName!.Replace(<span class="string">&quot;ViewModel&quot;</span>, <span class="string">&quot;View&quot;</span>, StringComparison.InvariantCulture);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用 C# 的反射（Reflection）功能，根据上面生成的字符串类名，查找对应的实际类型（Type）。</span></span><br><span class="line">        <span class="keyword">var</span> type = Type.GetType(viewName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果没有找到对应的 View 类型（可能你忘了创建 View 文件或者命名不匹配），就返回 null。</span></span><br><span class="line">        <span class="comment">// 在视频中，作者返回了一个 TextBlock 来显示错误，返回 null 也是一种处理方式。</span></span><br><span class="line">        <span class="keyword">if</span> (type <span class="keyword">is</span> <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果找到了类型，就使用 Activator.CreateInstance(type) 创建该 View 的一个新实例。</span></span><br><span class="line">        <span class="comment">// 这行代码的效果等同于 new HomePageView()，但是它是动态执行的。</span></span><br><span class="line">        <span class="keyword">var</span> control = (Control)Activator.CreateInstance(type);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这是非常关键的一步：将新创建的 View 的 DataContext（数据上下文）设置为传入的 ViewModel (data)。</span></span><br><span class="line">        <span class="comment">// 这样，View 和 ViewModel 就被绑定在了一起，View 内部的 &#123;Binding ...&#125; 才能正确地找到 ViewModel 中的属性。</span></span><br><span class="line">        control.DataContext = data;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 返回创建并设置好数据上下文的 View 控件。</span></span><br><span class="line">        <span class="keyword">return</span> control;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Match 方法用于判断此 DataTemplate 是否适用于给定的数据（data）。</span></span><br><span class="line">    <span class="comment">// 在这里，我们判断传入的数据是否是一个 ViewModelBase 或其派生类的实例。</span></span><br><span class="line">    <span class="comment">// 如果是，就返回 true，告诉 Avalonia：“这个数据我能处理，请调用我的 Build 方法吧！”</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Match</span>(<span class="params"><span class="built_in">object</span>? data</span>)</span> =&gt; data <span class="keyword">is</span> ViewModelBase;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-ViewModels-MainViewModel-cs"><a href="#4-2-ViewModels-MainViewModel-cs" class="headerlink" title="4.2 ViewModels\MainViewModel.cs"></a>4.2 ViewModels\MainViewModel.cs</h3><p>修改 MainViewModel.cs，为它添加页面状态管理和导航的逻辑。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Avalonia.Svg.Skia;</span><br><span class="line"><span class="comment">// using AvaloniaApplication2.Views; // 这个 using 在 ViewModel 中通常是不需要的，因为 ViewModel 不应该直接了解 View。</span></span><br><span class="line"><span class="comment">// 这是 MVVM 模式的一个核心原则：ViewModel 负责提供数据和逻辑，它不应该“知道”任何关于 View（视图/UI）的具体实现细节。</span></span><br><span class="line"><span class="comment">// View 和 ViewModel 之间的解耦是由 ViewLocator 和数据绑定机制来完成的。</span></span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.Input;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 这个常量在视频中被定义，但后来切换到了另一种实现方式，所以它没有被使用。</span></span><br><span class="line">    <span class="comment">// 但后来采用了 Avalonia 更优雅的 `Classes.active=&quot;&#123;Binding ...&#125;&quot;` 绑定布尔值的方式，</span></span><br><span class="line">    <span class="comment">// 我们可以安全地忽略或删除它。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> buttonActiveClass = <span class="string">&quot;active&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _sideMenuExpanded = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个属性来持有当前正在显示的页面的 ViewModel。</span></span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="comment">// 这是 MVVM Toolkit 的一个强大功能。它告诉编译器：</span></span><br><span class="line">    <span class="comment">// 当 _currentPage 属性发生变化时，也需要发出 HomePageIsActive 和 ProcessPageIsActive 属性已更改的通知。</span></span><br><span class="line">    <span class="comment">// 这样，UI 就会自动更新绑定到这几个属性的任何元素。</span></span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HomePageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ProcessPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ActionsPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(MacrosPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ReporterPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HistoryPageIsActive))</span>]</span><br><span class="line">    <span class="keyword">private</span> ViewModelBase _currentPage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这几个是只读的计算属性，用于判断当前页面是否是主页或流程页。</span></span><br><span class="line">    <span class="comment">// UI 上的按钮会绑定到这些属性，以决定是否应用 &quot;active&quot; 样式。</span></span><br><span class="line">    <span class="comment">// =&gt; 是 &quot;lambda&quot; 表达式的简写，表示这个属性的值是通过后面的表达式计算得出的。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HomePageIsActive =&gt; CurrentPage == _homePage;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ProcessPageIsActive =&gt; CurrentPage == _processPage;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ActionsPageIsActive =&gt; CurrentPage == _actionsPage;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> MacrosPageIsActive =&gt; CurrentPage == _macrosPage;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ReporterPageIsActive =&gt; CurrentPage == _reporterPage;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HistoryPageIsActive =&gt; CurrentPage == _historyPage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为每个页面创建一个私有的、只读的 ViewModel 实例。</span></span><br><span class="line">    <span class="comment">// 在应用的生命周期内，我们只使用这几个实例，而不是每次切换页面都创建新的。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HomePageViewModel _homePage = <span class="keyword">new</span> HomePageViewModel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ProcessPageViewModel _processPage = <span class="keyword">new</span> ProcessPageViewModel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ActionsPageViewModel _actionsPage = <span class="keyword">new</span> ActionsPageViewModel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> MacrosPageViewModel _macrosPage = <span class="keyword">new</span> MacrosPageViewModel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> ReporterPageViewModel _reporterPage = <span class="keyword">new</span> ReporterPageViewModel();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> HistoryPageViewModel _historyPage = <span class="keyword">new</span> HistoryPageViewModel();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MainViewModel 的构造函数。</span></span><br><span class="line">    <span class="comment">// 当 MainViewModel 被创建时（通常是应用启动时），这个方法会被调用。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在这里设置应用的默认显示页面。视频中设置的是 ProcessPage。</span></span><br><span class="line">        CurrentPage = _homePage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SideMenuResize</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        SideMenuExpanded = !SideMenuExpanded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个命令，用于导航到主页。</span></span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHome</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 当命令被执行时（例如，点击了主页按钮），将当前页面设置为 _homePage 实例。</span></span><br><span class="line">        <span class="comment">// 因为 CurrentPage 属性的 set 访问器会触发属性变更通知，UI 会自动更新。</span></span><br><span class="line">        CurrentPage = _homePage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 定义一个命令，用于导航到流程页。</span></span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToProcess</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _processPage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToMacros</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _macrosPage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToActions</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _actionsPage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToReporter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _reporterPage;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHistory</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _historyPage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-ObservableProperty-、-RelayCommand-和-NotifyPropertyChangedFor"><a href="#4-3-ObservableProperty-、-RelayCommand-和-NotifyPropertyChangedFor" class="headerlink" title="4.3 [ObservableProperty]、[RelayCommand]和[NotifyPropertyChangedFor]"></a>4.3 [ObservableProperty]、[RelayCommand]和[NotifyPropertyChangedFor]</h3><p>突然发现第三章的MVVM又记得不太清晰，还是在这里重复加强记忆。</p>
<p><strong>CommunityToolkit.Mvvm</strong> (也常被称为 MVVM Toolkit) 库，这个库的核心功能之一就是利用 C# 的 <strong>Source Generator (源代码生成器)</strong> 技术，来自动写那些繁琐又重复的代码。</p>
<p><strong>写一个简单的“指令”，编译器就会在后台帮你生成完整的、符合 MVVM 规范的代码。</strong></p>
<h3 id="4-3-1-ObservableProperty"><a href="#4-3-1-ObservableProperty" class="headerlink" title="4.3.1 [ObservableProperty]"></a>4.3.1 [ObservableProperty]</h3><p>属性的“自动生成器”，这个是最基础，也是最常用的。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ObservableProperty</span>] </span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span> _sideMenuExpanded;</span><br></pre></td></tr></table></figure>

<p>你只写了一行私有字段<code>_sideMenuExpanded</code>。当你给它贴上<code>[ObservableProperty]</code> 这个标签后，MVVM Toolkit 在编译时会自动在后台为你生成一个完整的、公开的、带有通知功能的属性 <code>SideMenuExpanded</code>。</p>
<p><strong>它在后台帮你生成的代码，大致是这个样子：</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">bool</span> SideMenuExpanded</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span> =&gt; _sideMenuExpanded;</span><br><span class="line">    <span class="keyword">set</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// SetProperty 是一个核心方法，它会做两件事：</span></span><br><span class="line">        <span class="comment">// 1. 检查新传入的 value 和旧的值 _sideMenuExpanded 是否真的不同。</span></span><br><span class="line">        <span class="comment">// 2. 如果真的不同，它会更新 _sideMenuExpanded 的值，然后发出一个“通知”，告诉UI：“嘿，SideMenuExpanded这个属性的值变了，所有绑定了它的地方都快来更新一下！”</span></span><br><span class="line">        SetProperty(<span class="keyword">ref</span> _sideMenuExpanded, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>[ObservableProperty] 帮你把一个简单的私有字段，<strong>包装</strong>成一个能和UI顺畅沟通的公开属性，让你不用每次都手动去写 get、set 和那一长串的通知逻辑。</p>
<ul>
<li>必须用 <code>[ObservableProperty]</code> 标记<strong>字段</strong>（带<code>_</code>的变量）</li>
<li>自动生成的<strong>属性</strong>名 &#x3D; 去掉下划线 + 首字母大写（<code>_sideMenu</code> → <code>SideMenu</code>）</li>
<li>自动实现 <code>INotifyPropertyChanged</code>，修改属性值会触发UI更新</li>
</ul>
<h3 id="4-3-2-RelayCommand"><a href="#4-3-2-RelayCommand" class="headerlink" title="4.3.2 [RelayCommand]"></a>4.3.2 [RelayCommand]</h3><p>方法的“命令转换器”，在MVVM模式里，界面上的按钮点击不能直接调用ViewModel里的一个方法，而是需要通过一个叫“命令（Command）”的东西来做中间人。<code>[RelayCommand]</code>就是帮你创建这个中间人的工具。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">RelayCommand</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToProcess</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    CurrentPage = _processPage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码只写了一个普通、私有的方法 GoToProcess。当你给它贴上<code>[RelayCommand]</code>这个标签后，MVVM Toolkit 会自动在后台为你创建一个公开的、符合WPF&#x2F;Avalonia绑定规范的命令属性。这个新属性的名字默认是在你的方法名后面加上 Command。</p>
<p><strong>它在后台帮你生成的代码，大致是这个样子：</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 它创建了一个公开的、只读的命令属性</span></span><br><span class="line"><span class="keyword">public</span> IRelayCommand GoToProcessCommand &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同时，它在构造函数里初始化了这个命令，</span></span><br><span class="line"><span class="comment">// 告诉这个命令：“当UI执行你的时候，你就去调用那个私有的 GoToProcess 方法。”</span></span><br><span class="line"><span class="comment">// new RelayCommand(GoToProcess);</span></span><br></pre></td></tr></table></figure>

<p>[RelayCommand] 帮你把一个普通的业务逻辑方法，<strong>包装</strong>成一个可以被XAML里按钮的 Command&#x3D;”{Binding …}” 语法所识别和绑定的“命令对象”。</p>
<ul>
<li><p>方法必须标记 <code>[RelayCommand]</code></p>
</li>
<li><p>生成的命令名 &#x3D; 方法名 + <code>Command</code></p>
</li>
<li><p>在XAML中绑定时要使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button Command=&quot;&#123;Binding GoToProcessCommand&#125;&quot;/&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-3-3-NotifyPropertyChangedFor"><a href="#4-3-3-NotifyPropertyChangedFor" class="headerlink" title="4.3.3 [NotifyPropertyChangedFor]"></a>4.3.3 [NotifyPropertyChangedFor]</h3><p>属性之间的“关联通知器”，在上面的代码里，有好几个用于判断按钮是否高亮的属性，比如：<br><code>public bool HomePageIsActive =&gt; CurrentPage == _homePage;</code></p>
<p>这个 <code>HomePageIsActive</code> 属性的值，完全<strong>依赖于</strong> <code>CurrentPage</code> 属性。当 <code>CurrentPage</code> 改变时，<code>HomePageIsActive</code> 的值也应该随之改变。</p>
<p><strong>但是，计算机没那么智能。</strong> 当你执行<code>CurrentPage = _homePage;</code> 这句代码时，系统只知道<code>CurrentPage</code>变了，它会去通知UI更新绑定了<code>CurrentPage</code>的地方（比如那个 <code>ContentControl</code>）。但它<strong>不知道</strong> <code>HomePageIsActive</code>、<code>ProcessPageIsActive</code> 这些依赖它的属性也需要更新。所以，按钮的高亮状态不会自动变化。</p>
<p><strong>[NotifyPropertyChangedFor] 的作用：</strong><br>它就像一个“信使”或者“传话筒”。你把它贴在“源头”属性上，告诉它：“当你自己变化的时候，请顺便帮我通知一下其他几个相关的属性也变化了。”</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ObservableProperty</span>]</span><br><span class="line"><span class="comment">// 当 CurrentPage 变化时，请顺便通知 HomePageIsActive 也变了</span></span><br><span class="line">[<span class="meta">NotifyPropertyChangedFor(nameof(HomePageIsActive))</span>] </span><br><span class="line"><span class="comment">// 当 CurrentPage 变化时，也请通知 ProcessPageIsActive 也变了</span></span><br><span class="line">[<span class="meta">NotifyPropertyChangedFor(nameof(ProcessPageIsActive))</span>] </span><br><span class="line"><span class="comment">// ... 其他按钮的IsActive属性也一样</span></span><br><span class="line"><span class="keyword">private</span> ViewModelBase _currentPage;</span><br></pre></td></tr></table></figure>

<p><strong>它的工作流程：</strong></p>
<ol>
<li>你点击了“Process”按钮，触发 <code>GoToProcessCommand</code> 命令。</li>
<li>命令执行 <code>GoToProcess()</code>方法，这句代码<code>CurrentPage = _processPage;</code>被调用。</li>
<li><code>[ObservableProperty]</code>的底层机制检测到<code>_currentPage</code> 的值变了，于是它准备发出<code>CurrentPage</code>属性已更改的通知。</li>
<li>在发出通知前，它看到了你贴的<code>[NotifyPropertyChangedFor]</code> 标签。</li>
<li>于是，它不仅发出了<code>CurrentPage</code>的通知，还<strong>一并发出</strong>了<code>HomePageIsActive</code>、<code>ProcessPageIsActive</code>等所有你在标签里指定的属性的“已更改”通知。</li>
<li>UI收到了这些通知，于是它去重新获取<code>HomePageIsActive</code>的值（此时是false），也去获取 <code>ProcessPageIsActive</code>的值（此时是true），然后正确地更新了所有按钮的高亮样式。</li>
</ol>
<p><code>[NotifyPropertyChangedFor]</code>解决了<strong>一个属性的变化</strong>如何触发<strong>其他依赖它的属性</strong>进行UI更新的问题，它在多个属性之间建立了一条“通知链”。</p>
<h3 id="4-3-4-三者的关系图示："><a href="#4-3-4-三者的关系图示：" class="headerlink" title="4.3.4 三者的关系图示："></a>4.3.4 三者的关系图示：</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ObservableProperty</span>]</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">bool</span> _sideMenuExpanded;</span><br><span class="line">│</span><br><span class="line">└─► 自动生成公共属性 SideMenuExpanded</span><br><span class="line">    │</span><br><span class="line">    └─► 当值变化时自动通知UI</span><br><span class="line"></span><br><span class="line">[<span class="meta">RelayCommand</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToProcess</span>()</span> &#123; ... &#125;</span><br><span class="line">│</span><br><span class="line">└─► 自动生成 GoToProcessCommand</span><br><span class="line"></span><br><span class="line">[<span class="meta">NotifyPropertyChangedFor</span>]</span><br><span class="line">│</span><br><span class="line">└─► 当前属性变化时，强制刷新其他依赖属性</span><br></pre></td></tr></table></figure>

<h3 id="4-4-ViewModels-ProcessPageViewModel-cs和ViewModels-HomePageViewModel-cs"><a href="#4-4-ViewModels-ProcessPageViewModel-cs和ViewModels-HomePageViewModel-cs" class="headerlink" title="4.4 ViewModels\ProcessPageViewModel.cs和ViewModels\HomePageViewModel.cs"></a>4.4 ViewModels\ProcessPageViewModel.cs和ViewModels\HomePageViewModel.cs</h3><p>新建ProcessPageViewModel.cs、HomePageViewModel.cs。<br>其他的ActionsPageViewModel.cs、HistoryPageViewModel.cs、MacrosPageViewModel.cs、ReporterPageViewModel.cs、SettingsPageViewModel.cs则仿造下面两个自行创建，由于内容雷同就不重复展示了。</p>
<p>ProcessPageViewModel.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">ProcessPageViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义一个简单的字符串属性，用于在页面上显示，以验证数据绑定是否成功。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Test &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;Process&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HomePageViewModel.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">HomePageViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Test &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="string">&quot;Home&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-Views-MainView-axaml"><a href="#4-5-Views-MainView-axaml" class="headerlink" title="4.5 Views\MainView.axaml"></a>4.5 Views\MainView.axaml</h3><p>在项目下新建一个 Views 文件夹，然后把 MainView.axaml 移动到 Views 内。修改其 XAML 代码以支持页面导航。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1024&quot; d:DesignHeight=&quot;600&quot;</span><br><span class="line">        Width=&quot;1024&quot; Height=&quot;600&quot;</span><br><span class="line">        x:Class=&quot;AvaloniaApplication2.MainView&quot;</span><br><span class="line">        xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">        xmlns:view=&quot;clr-namespace:AvaloniaApplication2.Views&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainViewModel&quot;</span><br><span class="line">        Title=&quot;AvaloniaApplication2&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:MainViewModel&gt;&lt;/vm:MainViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &lt;Grid Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot; ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;!-- 这是显示页面的关键控件。 --&gt;</span><br><span class="line">        &lt;!-- ContentControl 是一个占位符，可以显示任何内容。 --&gt;</span><br><span class="line">        &lt;!-- 我们将其 Content 属性绑定到 ViewModel 中的 CurrentPage 属性。 --&gt;</span><br><span class="line">        &lt;!-- 当 CurrentPage 的值是一个 ViewModel 实例时，我们注册的 ViewLocator 就会介入， --&gt;</span><br><span class="line">        &lt;!-- 找到对应的 View，并将其显示在这里。 --&gt;</span><br><span class="line">        &lt;ContentControl Grid.Column=&quot;1&quot; Content=&quot;&#123;Binding CurrentPage&#125;&quot; /&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot;&gt;</span><br><span class="line">            &lt;Grid RowDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;220&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage /Assets/Images/icon.svg&#125;&quot; Width=&quot;22&quot; IsVisible=&quot;&#123;Binding !SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;!-- 主页按钮 --&gt;</span><br><span class="line">                    &lt;!-- Command=&quot;&#123;Binding GoToHomeCommand&#125;&quot; 将按钮的点击操作绑定到 ViewModel 中的 GoToHomeCommand。 --&gt;</span><br><span class="line">                    &lt;!-- MVVM Toolkit 会自动将 GoToHome 方法生成为 GoToHomeCommand。 --&gt;</span><br><span class="line">                    &lt;!-- Classes.active=&quot;&#123;Binding HomePageIsActive&#125;&quot; 是 Avalonia 的一个特性。 --&gt;</span><br><span class="line">                    &lt;!-- 当 HomePageIsActive 属性为 true 时，此按钮会获得一个名为 &quot;active&quot; 的样式类。 --&gt;</span><br><span class="line">                    &lt;!-- Classes.active=&quot;&#123;Binding HomePageIsActive&#125;&quot; 是 Avalonia 的一个强大特性，非常类似于网页开发中的 CSS 类绑定。 --&gt;</span><br><span class="line">                    &lt;!-- 当 ViewModel 中的 HomePageIsActive 属性为 true 时，此按钮会自动获得一个名为 &quot;active&quot; 的样式类。 --&gt;</span><br><span class="line">                    &lt;!-- 当它变为 false 时，这个类会被自动移除。我们可以在样式文件中定义 .active 类的外观。 --&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding HomePageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToHomeCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2C2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ProcessPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToProcessCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE346;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ActionsPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToActionsCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE7F2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding MacrosPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToMacrosCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE3EE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ReporterPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToReporterCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEB7A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding HistoryPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToHistoryCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE03A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot;&gt;</span><br><span class="line">                    &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;/Button&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-Views-HomePageView-axaml和Views-ProcessPageView-axaml"><a href="#4-6-Views-HomePageView-axaml和Views-ProcessPageView-axaml" class="headerlink" title="4.6 Views\HomePageView.axaml和Views\ProcessPageView.axaml"></a>4.6 Views\HomePageView.axaml和Views\ProcessPageView.axaml</h3><p>在Rider里，add里面选择<strong>Avalonia User Control</strong>功能新建HomePageView.axaml、ProcessPageView.axaml。这些是构成页面的用户控件。<br>其他的ActionsPageView.axaml、HistoryPageView.axaml、MacrosPageView.axaml、ReporterPageView.axaml、SettingsPageView.axaml则仿造下面两个自行创建，由于内容雷同就不重复展示了。</p>
<p>HomePageView.axaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.Views.HomePageView&quot;&gt;</span><br><span class="line">    &lt;!-- 为了在设计器中获得更好的预览体验和编译时类型检查， --&gt;</span><br><span class="line">    &lt;!-- 建议像 ProcessPageView 一样，也为 HomePageView 添加 x:DataType 和 Design.DataContext。 --&gt;</span><br><span class="line">    &lt;!-- 不过这里为了和视频教程的代码保持一致，方便接下来的学习，就不修改了。 --&gt;</span><br><span class="line">    &lt;!-- 为了演示，这里只放了一段纯文本。 --&gt;</span><br><span class="line">    &lt;!-- 之后可以像 ProcessPageView 一样添加绑定和更复杂的布局。 --&gt;</span><br><span class="line">    Welcome to HomePage!</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<p>ProcessPageView.axaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">             Foreground=&quot;White&quot;</span><br><span class="line">             xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">             x:DataType=&quot;vm:ProcessPageViewModel&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.Views.ProcessPageView&quot;&gt;</span><br><span class="line">    &lt;!-- Design.DataContext 用于在设计器（预览窗口）中提供一个数据样本， --&gt;</span><br><span class="line">    &lt;!-- 这样预览器就能正确显示绑定的数据。它在程序运行时不起作用。 --&gt;</span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:ProcessPageViewModel&gt;&lt;/vm:ProcessPageViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    &lt;!-- 将 Label 的内容绑定到 ViewModel 的 Test 属性。 --&gt;</span><br><span class="line">    &lt;!-- 因为 ViewLocator 已经将此 View 的 DataContext 设置为了 ProcessPageViewModel 的实例， --&gt;</span><br><span class="line">    &lt;!-- 所以这里的绑定能够成功。 --&gt;</span><br><span class="line">    &lt;Label Content=&quot;&#123;Binding Test&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-7-App-axaml"><a href="#4-7-App-axaml" class="headerlink" title="4.7 App.axaml"></a>4.7 App.axaml</h3><p>修改App.axaml，在整个应用程序层面注册我们的 ViewLocator 并添加高亮样式所需的颜色资源。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;Application xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.App&quot;</span><br><span class="line">             xmlns:local=&quot;clr-namespace:AvaloniaApplication2&quot;</span><br><span class="line">             RequestedThemeVariant=&quot;Default&quot;&gt;</span><br><span class="line">             &lt;!-- &quot;Default&quot; ThemeVariant follows system theme variant. &quot;Dark&quot; or &quot;Light&quot; are other available options. --&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!-- Application.DataTemplates 是一个全局的数据模板集合。 --&gt;</span><br><span class="line">     &lt;Application.DataTemplates&gt;</span><br><span class="line">         &lt;!-- 在这里实例化并注册我们的 ViewLocator。 --&gt;</span><br><span class="line">         &lt;!-- 这使得它对整个应用程序都生效。任何地方只要把一个 ViewModel 赋给 Content 属性， --&gt;</span><br><span class="line">         &lt;!-- ViewLocator 就会尝试去匹配和构建对应的 View。 --&gt;</span><br><span class="line">         &lt;local:ViewLocator&gt;&lt;/local:ViewLocator&gt;</span><br><span class="line">     &lt;/Application.DataTemplates&gt;</span><br><span class="line">             </span><br><span class="line">    &lt;Application.Styles&gt;</span><br><span class="line">        &lt;FluentTheme /&gt;</span><br><span class="line">        &lt;StyleInclude Source=&quot;Styles/AppDefaultStyles.axaml&quot;&gt;&lt;/StyleInclude&gt;</span><br><span class="line">    &lt;/Application.Styles&gt;</span><br><span class="line">     &lt;Application.Resources&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryForeground&quot;&gt;#CFCFCF&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryBackground&quot;&gt;#14172D&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;LinearGradientBrush x:Key=&quot;PrimaryBackgroundGradient&quot; StartPoint=&quot;0%, 0%&quot; EndPoint=&quot;100%, 0%&quot;&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;0&quot; Color=&quot;#111214&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;1&quot; Color=&quot;#151E3E&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">         &lt;/LinearGradientBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverBackground&quot;&gt;#333B5A&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;!-- 新增的颜色资源，用于激活状态按钮的背景色。 --&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryActiveBackground&quot;&gt;#6633dd&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverForeground&quot;&gt;White&lt;/SolidColorBrush&gt;</span><br><span class="line">         </span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoPro&quot;&gt;/Assets/Fonts/AkkoPro-Regular.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoProBold&quot;&gt;/Assets/Fonts/AkkoPro-Bold.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor&quot;&gt;/Assets/Fonts/Phosphor.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor-Fill&quot;&gt;/Assets/Fonts/Phosphor-Fill.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     &lt;/Application.Resources&gt;</span><br><span class="line">&lt;/Application&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-Styles-AppDefaultStyles-axaml"><a href="#4-8-Styles-AppDefaultStyles-axaml" class="headerlink" title="4.8 Styles\AppDefaultStyles.axaml"></a>4.8 Styles\AppDefaultStyles.axaml</h3><p>修改AppDefaultStyles.axaml，添加当按钮拥有 active 类时的样式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&lt;Styles xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;&gt;</span><br><span class="line">    &lt;Design.PreviewWith&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot; Width=&quot;200&quot;&gt;</span><br><span class="line">            &lt;!-- Add Controls for Previewer Here --&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;200&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2C2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE346;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE7F2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE3EE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEB7A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE03A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Design.PreviewWith&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Add Styles Here --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Window&quot;&gt;</span><br><span class="line">        &lt;!-- &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt; --&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Border&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">            &lt;Transitions&gt;</span><br><span class="line">                &lt;DoubleTransition Property=&quot;Width&quot; Duration=&quot;0:0:1&quot;&gt;&lt;/DoubleTransition&gt;</span><br><span class="line">            &lt;/Transitions&gt;</span><br><span class="line">        &lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon, Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor-Fill&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0 2 5 0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;19&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button, Label.akko&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;20&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;10&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">            &lt;Transitions&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Foreground&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Background&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;TransformOperationsTransition Property=&quot;RenderTransform&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/TransformOperationsTransition&gt;</span><br><span class="line">            &lt;/Transitions&gt;</span><br><span class="line">        &lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent:pointerover Label&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1.2)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryHoverForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryHoverBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 这是为激活按钮新增的样式。 --&gt;</span><br><span class="line">    &lt;!-- 选择器 &quot;Button.active&quot; 意味着它会应用在同时是 Button 并且拥有 &quot;active&quot; 类的控件上。 --&gt;</span><br><span class="line">    &lt;!-- `/template/ ContentPresenter` 这个语法是 Avalonia 样式系统的一部分，它的意思是“深入到按钮的控件模板（template）内部，找到名为 ContentPresenter 的部分并对它应用样式”。 --&gt;</span><br><span class="line">    &lt;!-- 这允许我们修改控件的内部视觉元素，而不仅仅是控件本身。 --&gt;</span><br><span class="line">    &lt;!-- 视频中提到，为了让 active 状态的样式优先级高于 pointerover (鼠标悬浮) 状态，--&gt;</span><br><span class="line">    &lt;!-- 需要将 active 样式的定义放在 pointerover 样式的后面。 --&gt;</span><br><span class="line">    &lt;!-- 所以当一个按钮是 active 状态时， --&gt;</span><br><span class="line">    &lt;!-- 鼠标再悬浮上去，背景色不会再变为悬浮的颜色，这符合预期。 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.active /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryActiveBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;Button.transparent:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/Styles&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-9-当前目录结构"><a href="#4-9-当前目录结构" class="headerlink" title="4.9 当前目录结构"></a>4.9 当前目录结构</h3><p>去除&#x2F;bin、&#x2F;obj，让显示简洁。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">│  App.axaml</span><br><span class="line">│  App.axaml.cs</span><br><span class="line">│  app.manifest</span><br><span class="line">│  AvaloniaApplication2.csproj</span><br><span class="line">│  Program.cs</span><br><span class="line">│  ViewLocator.cs</span><br><span class="line">│</span><br><span class="line">├─Assets</span><br><span class="line">│  ├─Fonts</span><br><span class="line">│  │      AkkoPro<span class="literal">-Bold</span>.ttf</span><br><span class="line">│  │      AkkoPro<span class="literal">-Regular</span>.ttf</span><br><span class="line">│  │      Phosphor<span class="literal">-Fill</span>.ttf</span><br><span class="line">│  │      Phosphor.ttf</span><br><span class="line">│  │</span><br><span class="line">│  └─Images</span><br><span class="line">│          icon.svg</span><br><span class="line">│          logo.svg</span><br><span class="line">│</span><br><span class="line">├─Styles</span><br><span class="line">│      AppDefaultStyles.axaml</span><br><span class="line">│</span><br><span class="line">├─ViewModels</span><br><span class="line">│      ActionsPageViewModel.cs</span><br><span class="line">│      HistoryPageViewModel.cs</span><br><span class="line">│      HomePageViewModel.cs</span><br><span class="line">│      MacrosPageViewModel.cs</span><br><span class="line">│      MainViewModel.cs</span><br><span class="line">│      ProcessPageViewModel.cs</span><br><span class="line">│      ReporterPageViewModel.cs</span><br><span class="line">│      ViewModelBase.cs</span><br><span class="line">│</span><br><span class="line">└─Views</span><br><span class="line">        ActionsPageView.axaml</span><br><span class="line">        ActionsPageView.axaml.cs</span><br><span class="line">        HistoryPageView.axaml</span><br><span class="line">        HistoryPageView.axaml.cs</span><br><span class="line">        HomePageView.axaml</span><br><span class="line">        HomePageView.axaml.cs</span><br><span class="line">        MacrosPageView.axaml</span><br><span class="line">        MacrosPageView.axaml.cs</span><br><span class="line">        MainView.axaml</span><br><span class="line">        MainView.axaml.cs</span><br><span class="line">        ProcessPageView.axaml</span><br><span class="line">        ProcessPageView.axaml.cs</span><br><span class="line">        ReporterPageView.axaml</span><br><span class="line">        ReporterPageView.axaml.cs</span><br><span class="line">        SettingsPageView.axaml</span><br><span class="line">        SettingsPageView.axaml.cs</span><br></pre></td></tr></table></figure>

<h2 id="Avalonia-学习笔记05-Dependency-Injection-Factory-Pattern（依赖注入与工厂模式）"><a href="#Avalonia-学习笔记05-Dependency-Injection-Factory-Pattern（依赖注入与工厂模式）" class="headerlink" title="Avalonia 学习笔记05. Dependency Injection Factory Pattern（依赖注入与工厂模式）"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/18980757">Avalonia 学习笔记05. Dependency Injection Factory Pattern（依赖注入与工厂模式）</a></h2><p>视频链接：<a target="_blank" rel="noopener" href="https://youtu.be/22Rj_sMyv88?si=czG5YX_6tDsWMMp8">https://youtu.be/22Rj_sMyv88?si=czG5YX_6tDsWMMp8</a></p>
<p><strong>本节课核心目标：</strong></p>
<ol>
<li>引入<strong>依赖注入 (Dependency Injection, DI)</strong> 来管理项目中各个类（特别是ViewModel）的创建和生命周期，避免在代码中到处使用 <code>new</code> 关键字，实现<strong>解耦</strong>。</li>
<li>解决一个常见问题：我们不希望在程序一启动时就创建所有页面的ViewModel并一直保存在内存中，而是希望在用户<strong>导航到某个页面时才创建它</strong>。</li>
<li>为了解决上述问题，引入<strong>工厂模式 (Factory Pattern)</strong>，创建一个专门负责“按需生产”页面ViewModel的工厂。</li>
</ol>
<p>视频作者说了，依赖注入和工厂模式会让人很困惑，但是为了接下来的课程还是要引入，并且会慢慢得到回报。<br>我现在也不太懂，不过还是要慢慢学习这些额外的知识。</p>
<h3 id="5-0-核心概念深入讲解"><a href="#5-0-核心概念深入讲解" class="headerlink" title="5.0 核心概念深入讲解"></a>5.0 核心概念深入讲解</h3><p>在分析具体代码修改之前，需要先理解本节课所应用的几个核心编程概念。这些概念是构建大型、可维护软件的工程基础。</p>
<h3 id="5-0-1-依赖注入-Dependency-Injection-DI"><a href="#5-0-1-依赖注入-Dependency-Injection-DI" class="headerlink" title="5.0.1 依赖注入 (Dependency Injection, DI)"></a>5.0.1 依赖注入 (Dependency Injection, DI)</h3><ul>
<li><strong>比喻：</strong> 厨师需要番茄来做菜。如果厨师需要自己去种番茄，那么他的工作就和“种番茄”这个具体行为绑定了。DI 相当于建立了一个完善的采购和物流系统，厨师只需要在菜谱上写明“需要5个番茄”，采购员（DI容器）就会自动把番茄送到他手上。</li>
<li><strong>描述：</strong><br>依赖注入是一种软件设计模式，其核心思想是<strong>控制反转（Inversion of Control, IoC）</strong>。一个对象（客户端）不应负责创建它所依赖的对象（服务），而是通过外部来提供（注入）这些依赖。DI 是实现 IoC 的一种具体技术。</li>
<li>图示</li>
<li>没有DI**(紧密耦合):**</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+      创建        +-------------------+</span><br><span class="line">| MainViewModel     | *-------------&gt; | HomePageViewModel |</span><br><span class="line">|-------------------|                 +-------------------+</span><br><span class="line">| <span class="keyword">new</span> HomePageVM()  |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure>

<p> *MainViewModel 直接依赖并创建 HomePageViewModel，关系固定。</p>
<ul>
<li><strong>使用 DI (松散耦合):</strong></li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+      请求依赖       +-------------------+</span><br><span class="line">| MainViewModel     | &lt;----------------- | DI容器            |</span><br><span class="line">|-------------------|      注入依赖       | (ServiceProvider) |</span><br><span class="line">| Ctor(HomePageVM)  | -----------------&gt; |-------------------|</span><br><span class="line">+-------------------+                    | 知道如何创建        |</span><br><span class="line">                                         | HomePageViewModel |</span><br><span class="line">                                         +-------------------+</span><br></pre></td></tr></table></figure>

<p> *MainViewModel 只声明需要什么，DI容器 负责创建并提供。</p>
<ul>
<li><strong>基本用法（三步曲）：</strong></li>
</ul>
<ol>
<li><p><strong>注册服务 (Register):</strong> 在应用程序的启动入口（如<code>App.axaml.cs</code>），使用 <code>ServiceCollection</code> 来“注册”服务和它们的<strong>生命周期</strong>。</p>
<ul>
<li><strong><code>AddSingleton&lt;T&gt;()</code></strong>: 单例模式。服务在第一次被请求时创建，之后所有请求都返回<strong>同一个实例</strong>。适用于全局配置、主视图模型等。</li>
<li><strong><code>AddTransient&lt;T&gt;()</code></strong>: 瞬态模式。<strong>每次</strong>请求服务时，都会创建一个<strong>全新的实例</strong>。适用于轻量级、无状态的服务，如本课中的页面ViewModel。</li>
<li><strong><code>AddScoped&lt;T&gt;()</code></strong>: 作用域模式。在同一个作用域（如一次Web请求）内，所有请求返回同一个实例。在桌面应用中不常用。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：</span></span><br><span class="line"><span class="keyword">var</span> services = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">services.AddSingleton&lt;IMainWindowViewModel, MainWindowViewModel&gt;(); <span class="comment">// 注册单例</span></span><br><span class="line">services.AddTransient&lt;IPageViewModel, HomePageViewModel&gt;();     <span class="comment">// 注册瞬态</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>声明依赖 (Declare):</strong> 在需要使用服务的类中，通过构造函数参数来声明依赖。这是最推荐的方式，称为“构造函数注入”。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainWindowViewModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IPageViewModel _initialPage;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过构造函数声明，我需要一个 IPageViewModel</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainWindowViewModel</span>(<span class="params">IPageViewModel initialPage</span>)</span> </span><br><span class="line">    &#123;</span><br><span class="line">        _initialPage = initialPage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>解析服务 (Resolve):</strong> DI容器会自动处理服务的创建和注入。我们通常只在程序的“根”部（Composition Root，如<code>App.axaml.cs</code>）手动解析一次服务来启动整个应用。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> provider = services.BuildServiceProvider();</span><br><span class="line"><span class="keyword">var</span> mainViewModel = provider.GetRequiredService&lt;IMainWindowViewModel&gt;();</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>本章节用法详解：<ul>
<li>在 <code>App.axaml.cs</code> 中，我们注册了 <code>MainViewModel</code> 为 <code>Singleton</code>，因为它代表了整个主窗口的状态，全局唯一。</li>
<li>所有页面ViewModel（如<code>HomePageViewModel</code>）被注册为 <code>Transient</code>，因为我们希望每次导航到一个页面时，都得到一个全新的、干净的实例，并且在离开页面后，旧的实例可以被垃圾回收，从而节省内存。</li>
<li>由于页面 ViewModel 被注册为 Transient（瞬态），并且 MainViewModel 中只持有对 <code>_currentPage</code> 的引用，当用户导航到新页面时，_currentPage 会被赋予一个新的 ViewModel 实例。旧的那个实例如果没有其他地方引用它，就会在下一次垃圾回收（GC）时被自动清理，从而实现了内存的有效管理。</li>
</ul>
</li>
</ul>
<h3 id="5-0-2-工厂模式-Factory-Pattern"><a href="#5-0-2-工厂模式-Factory-Pattern" class="headerlink" title="5.0.2 工厂模式 (Factory Pattern)"></a>5.0.2 工厂模式 (Factory Pattern)</h3><ul>
<li><strong>比喻：</strong> 去快餐店点餐。顾客（客户端）不需要知道汉堡（产品）的具体制作流程，只需要到柜台（工厂）说出自己想要的汉堡名称即可。</li>
<li><strong>描述：</strong><br>工厂模式是一种创造型设计模式，它提供了一种封装对象创建过程的方法。客户端与具体的产品创建过程解耦，只与工厂接口交互。</li>
<li>图示：</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+       请求页面   +---------------+       请求创建       +-------------------+</span><br><span class="line">| MainViewModel | *-------------&gt; |  PageFactory  | *-----------------&gt; |     DI容器        |</span><br><span class="line">+---------------+                 +---------------+                     +-------------------+</span><br><span class="line">                                          |                                       | 创建</span><br><span class="line">                                          | 使用注入的 <span class="string">&quot;Func&quot;</span> 委托                  |</span><br><span class="line">                                          |                                       v</span><br><span class="line">                                          +---------------------------------&gt; +-------------------+</span><br><span class="line">                                                                              | HomePageViewModel |</span><br><span class="line">                                                                              +-------------------+</span><br></pre></td></tr></table></figure>

<p> *MainViewModel 向 PageFactory “点餐”。</p>
<p> *PageFactory 不自己“做菜”，而是使用DI容器给它的一个特殊工具(Func委托)，让DI容器这个“中央厨房”来制作。</p>
<ul>
<li><p><strong>基本用法：</strong><br>通常会创建一个工厂类，其中包含一个或多个根据输入参数创建不同类型产品的方法。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简化的工厂示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SimplePageFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPageViewModel <span class="title">CreatePage</span>(<span class="params"><span class="built_in">string</span> pageName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (pageName)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Home&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> HomePageViewModel();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Settings&quot;</span>: <span class="keyword">return</span> <span class="keyword">new</span> SettingsPageViewModel();</span><br><span class="line">            <span class="literal">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="string">&quot;Invalid page name&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```    这个简单工厂的问题在于，它内部使用了 `<span class="keyword">new</span>`，与我们DI的目标相悖。</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>本章节用法详解：</strong><br>我们创建了 <code>PageFactory</code> 类，但它自身并不使用 <code>new</code> 来创建ViewModel。相反，它依赖于DI容器注入的一个“生产方法”（即 <code>Func&lt;&gt;</code> 委托）。这使得 <code>PageFactory</code> 成为了一个<strong>连接客户端（<code>MainViewModel</code>）和DI容器（<code>ServiceProvider</code>）的桥梁</strong>。<code>MainViewModel</code> 通过工厂实现了“按需创建”，而工厂通过注入的委托，利用了DI容器的能力来完成实际的创建工作，保证了所有ViewModel的创建依然在DI的掌控之中。</p>
</li>
</ul>
<h3 id="5-0-3-委托-Delegate-、Func-和-Action"><a href="#5-0-3-委托-Delegate-、Func-和-Action" class="headerlink" title="5.0.3 委托 (Delegate)、Func&lt;&gt; 和 Action&lt;&gt;"></a>5.0.3 委托 (Delegate)、Func&lt;&gt; 和 Action&lt;&gt;</h3><ul>
<li><strong>比喻：</strong> 一个指向“紧急联系人电话号码”的便签。便签本身不是人，但它记录了如何联系到那个人。这个便签的格式是固定的（只能写电话号码）。</li>
<li><strong>描述：</strong><br>委托是C#中的一种引用类型，它封装了对具有特定方法签名（即返回值类型和参数列表）的方法的引用。它允许将方法作为参数传递，是实现回调机制和事件处理的基础。</li>
<li>图示：</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+------------------+      指向          +----------------------+</span><br><span class="line">|  委托对象         | *----------------&gt; |       方法()         |</span><br><span class="line">| (例如 <span class="string">&quot;op&quot;</span>)      |                    |----------------------|</span><br><span class="line">+------------------+                   |  ...一些逻辑...        |</span><br><span class="line">      |                                +----------------------+</span><br><span class="line">      |</span><br><span class="line">      | 可作为参数传递</span><br><span class="line">      v</span><br><span class="line">+-------------------------+</span><br><span class="line">| 另一个方法(Delegate d)  |</span><br><span class="line">+-------------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Func&lt;&gt; 和 Action&lt;&gt;:</strong></p>
<p>Func&lt;&gt; 和 Action&lt;&gt; 是.NET提供的内置泛型委托，让我们无需为每种签名都手动声明委托类型。</p>
<ul>
<li><strong>Action&lt;&gt;</strong>: 封装了<strong>没有返回值 (void)</strong> 的方法。</li>
<li><strong>Func&lt;&gt;</strong>: 封装了<strong>有返回值</strong>的方法，<strong>最后一个泛型参数始终代表返回值类型</strong>。</li>
</ul>
</li>
<li><p><strong>基本用法：</strong></p>
<ol>
<li><p>声明委托类型：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">MathOperation</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建委托实例并指向方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Add</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> y</span>)</span> =&gt; x + y;</span><br><span class="line">MathOperation op = Add;</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用委托：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> result = op(<span class="number">3</span>, <span class="number">5</span>); <span class="comment">// result is 8</span></span><br><span class="line"><span class="comment">// 或使用Invoke()</span></span><br><span class="line"><span class="built_in">int</span> result2 = op.Invoke(<span class="number">3</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><strong><code>Func&lt;&gt;</code> 和 <code>Action&lt;&gt;</code>:</strong><br><code>Func&lt;&gt;</code> 和 <code>Action&lt;&gt;</code> 是.NET提供的内置泛型委托，让我们无需为每种签名都手动声明委托类型。</p>
<ul>
<li><strong><code>Action&lt;&gt;</code></strong>: 封装了<strong>没有返回值 (<code>void</code>)</strong> 的方法。</li>
<li><strong><code>Func&lt;&gt;</code></strong>: 封装了<strong>有返回值</strong>的方法，<strong>最后一个泛型参数始终代表返回值类型</strong>。</li>
</ul>
</li>
<li><p><strong>本章节用法详解：</strong><br>我们使用了 <code>Func&lt;ApplicationPageNames, PageViewModel&gt;</code>。这个委托精确地描述了我们工厂需要的能力：一个接收 <code>ApplicationPageNames</code> 枚举作为输入，并能返回一个 <code>PageViewModel</code> 对象作为输出的方法。通过在DI容器中注册这个 <code>Func</code>，我们实际上是注册了一个“符合该描述的生产方法”，并让 <code>PageFactory</code> 来使用它。</p>
</li>
</ul>
<h3 id="5-0-4-Lambda表达式和闭包-Closure"><a href="#5-0-4-Lambda表达式和闭包-Closure" class="headerlink" title="5.0.4 Lambda表达式和闭包 (Closure)"></a>5.0.4 Lambda表达式和闭包 (Closure)</h3><ul>
<li><p><strong>Lambda表达式 (<code>=&gt;</code>):</strong></p>
<ul>
<li><p><strong>描述：</strong> Lambda表达式是一种用于创建匿名函数的简洁语法。它使得我们可以直接在需要委托实例的地方以内联的方式编写函数体。</p>
</li>
<li><p>基本用法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (input-parameters) =&gt; &#123;statement-or-expression-body&#125;</span></span><br><span class="line">Func&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; square = x =&gt; x * x;         <span class="comment">// 表达式体</span></span><br><span class="line">Action&lt;<span class="built_in">string</span>&gt; print = message =&gt;          <span class="comment">// 语句体</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>闭包 (Closure):</strong></p>
<ul>
<li><p><strong>比喻：</strong> 一个带着“魔法背包”的旅行者。旅行者是一个函数，背包是他的创建环境。背包里装着他家乡的物品（<strong>外部变量</strong>）。即使他离家远行，依然能使用背包里的东西。</p>
</li>
<li><p><strong>描述：</strong> 闭包是一个函数以及其创建时所在的**词法作用域（Lexical Scope）**的组合。该函数可以“捕获”（Capture）并访问其外部作用域中的变量，即使外部作用域的生命周期已经结束。</p>
</li>
<li><p>基本用法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Func&lt;<span class="built_in">int</span>&gt; <span class="title">CreateCounter</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> count = <span class="number">0</span>; <span class="comment">// 这个变量将被闭包捕获</span></span><br><span class="line">    <span class="keyword">return</span> () =&gt; </span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter1 = CreateCounter();</span><br><span class="line">Console.WriteLine(counter1()); <span class="comment">// 输出 1</span></span><br><span class="line">Console.WriteLine(counter1()); <span class="comment">// 输出 2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">counter1</span><br></pre></td></tr></table></figure>

<p>这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Func</span><br></pre></td></tr></table></figure>

<p>实例”记住”了它自己私有的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count</span><br></pre></td></tr></table></figure>

<p>变量。</p>
</li>
</ul>
</li>
<li><p><strong>本章节用法详解 (<code>x =&gt; name =&gt; name switch</code>)：</strong><br>这是闭包在本章节中的核心应用，也是最复杂的部分。这种方式被称为“委托工厂”（Delegate Factory）。它的一个巨大优势是，PageFactory 类本身对 IServiceProvider (DI 容器) <strong>完全无知</strong>。它只依赖于一个 Func 接口，这使得 PageFactory 的可测试性变得极高，因为它不与任何具体的 DI 容器实现耦合。</p>
</li>
<li><p>我们把它分解来看：</p>
<ol>
<li><p><strong><code>collection.AddSingleton&lt;...&gt;( x =&gt; ... )</code></strong>: 注册一个单例服务。DI容器在创建这个服务时，会执行括号内的Lambda，并把<strong>容器自身 (<code>IServiceProvider</code>)</strong> 作为参数 <code>x</code> 传进去。</p>
</li>
<li><p><code>x =&gt; name =&gt; ...</code></p>
<p>: 这是一个返回</p>
<p>另一个函数</p>
<p>的函数。</p>
<ul>
<li><strong>外层函数 <code>x =&gt; ...</code></strong>: 它的任务是接收 <code>IServiceProvider</code> (即 <code>x</code>)，并创建一个内层函数。</li>
<li><strong>内层函数 <code>name =&gt; ...</code></strong>: 这个函数就是我们最终要注入到工厂里的那个 <code>Func</code> 的实体。</li>
</ul>
</li>
<li><p><strong>闭包的形成</strong>: 内层函数 <code>name =&gt; ...</code> 在被创建时，它所在的“家乡”环境中有变量 <code>x</code>。于是它通过闭包机制，把 <code>x</code> “打包”带走了。</p>
</li>
<li><p><strong>最终效果</strong>: 我们成功地创建并注册了一个 <code>Func&lt;ApplicationPageNames, PageViewModel&gt;</code> 委托实例。这个实例在未来的任何时候被调用时，都能访问到被它捕获的 <code>IServiceProvider</code> (<code>x</code>)，从而可以调用 <code>x.GetRequiredService&lt;T&gt;()</code> 来从DI容器中动态地、按需地创建任何已注册的服务。这完美地解决了工厂需要与DI容器交互的问题，同时又没有让工厂直接依赖于 <code>IServiceProvider</code>。</p>
</li>
</ol>
</li>
<li><p><strong>图示 (x &#x3D;&gt; name &#x3D;&gt; … 详解):</strong></p>
</li>
</ul>
<p><strong>第一步：定义环境 (在 App.axaml.cs 中)</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------+</span><br><span class="line">| 外部作用域 (AddSingleton 调用)                    |</span><br><span class="line">|                                                 |</span><br><span class="line">|  变量 <span class="string">&#x27;x&#x27;</span> 在此存在 (= IServiceProvider)           |</span><br><span class="line">|                                                 |</span><br><span class="line">|  +-------------------------------------------+  |</span><br><span class="line">|  | 内部函数 (name =&gt; ...) 在此创建              |  |</span><br><span class="line">|  |                                           |  |</span><br><span class="line">|  |  * 它看到并“捕获”了 <span class="string">&#x27;x&#x27;</span>                     |  |</span><br><span class="line">|  |  +---------------------+                  |  |</span><br><span class="line">|  |  | 闭包的“魔法背包”      |                  |  |</span><br><span class="line">|  |  |---------------------|                  |  |</span><br><span class="line">|  |  |  - 对 <span class="string">&#x27;x&#x27;</span> 的引用     |                  |  |</span><br><span class="line">|  |  +---------------------+                  |  |</span><br><span class="line">|  +-------------------------------------------+  |</span><br><span class="line">+-------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>第二步：函数被传递和调用 (在 PageFactory 中)</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------+</span><br><span class="line">| PageFactory (一个完全不同的作用域)                 |</span><br><span class="line">|                                                 |</span><br><span class="line">|  注入的 Func&lt;&gt; (我们的内部函数) 在此                |</span><br><span class="line">|                                                 |</span><br><span class="line">|  当被调用时:                                      |</span><br><span class="line">|  <span class="number">1.</span> 它打开它的“魔法背包”(闭包)                      |</span><br><span class="line">|  <span class="number">2.</span> 它找到并使用对 <span class="string">&#x27;x&#x27;</span> 的引用                      |</span><br><span class="line">|  <span class="number">3.</span> 它调用 x.GetRequiredService&lt;T&gt;()             |</span><br><span class="line">|                                                 |</span><br><span class="line">+-------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h3 id="5-1-App-axaml-cs"><a href="#5-1-App-axaml-cs" class="headerlink" title="5.1 App.axaml.cs"></a>5.1 App.axaml.cs</h3><p>修改。</p>
<p>这是本节课最核心的修改。App.axaml.cs 是整个应用程序的入口点，因此我们将在这里配置我们的“依赖注入容器”。可以把它想象成一个中央“服务台”，我们在这里注册所有程序需要的“服务”（在这里主要是各种ViewModel），并定义如何创建它们。当程序其他地方需要某个服务时，就向这个服务台申请，而不是自己动手创建。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Avalonia;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Controls.ApplicationLifetimes;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Markup.Xaml;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Factories;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.ViewModels;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        AvaloniaXamlLoader.Load(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnFrameworkInitializationCompleted</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1. 初始化服务集合 (ServiceCollection)</span></span><br><span class="line">        <span class="comment">// ServiceCollection 是一个DI容器的配置清单，用于注册服务及其生命周期。</span></span><br><span class="line">        <span class="keyword">var</span> collection = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">        <span class="comment">// 2. 注册服务</span></span><br><span class="line">        <span class="comment">// AddSingleton: 注册为单例生命周期。该服务在第一次被请求时创建，后续所有请求都返回同一个实例。</span></span><br><span class="line">        collection.AddSingleton&lt;MainViewModel&gt;();</span><br><span class="line">        <span class="comment">// AddTransient: 注册为瞬态生命周期。每次请求该服务时，都会创建一个全新的实例。</span></span><br><span class="line">        collection.AddTransient&lt;ActionsPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;HomePageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;MacrosPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;ProcessPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;ReporterPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;HistoryPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;SettingsPageViewModel&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 注册工厂函数</span></span><br><span class="line">        <span class="comment">// 这里注册了一个Func委托，用于按需创建PageViewModel。这是一个典型的闭包应用。</span></span><br><span class="line">        <span class="comment">// - 外层 x =&gt; ...: 参数&#x27;x&#x27;是DI容器在构建此委托时自动注入的IServiceProvider实例。</span></span><br><span class="line">        <span class="comment">// - 内层 name =&gt; ...: 这是返回的实际函数，它捕获了变量&#x27;x&#x27;。</span></span><br><span class="line">        <span class="comment">// - name switch: C# 8.0的switch表达式，根据传入的&#x27;name&#x27;，使用捕获的&#x27;x&#x27;来解析并返回对应的ViewModel服务。</span></span><br><span class="line">        collection.AddSingleton&lt;Func&lt;ApplicationPageNames, PageViewModel&gt;&gt;(x =&gt; name =&gt; name <span class="keyword">switch</span></span><br><span class="line">        &#123;</span><br><span class="line">            ApplicationPageNames.Home =&gt; x.GetRequiredService&lt;HomePageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Process =&gt; x.GetRequiredService&lt;ProcessPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Macros =&gt; x.GetRequiredService&lt;MacrosPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Actions =&gt; x.GetRequiredService&lt;ActionsPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Reporter =&gt; x.GetRequiredService&lt;ReporterPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.History =&gt; x.GetRequiredService&lt;HistoryPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Settings =&gt; x.GetRequiredService&lt;SettingsPageViewModel&gt;(),</span><br><span class="line">            _ =&gt; <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException()</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 注册PageFactory</span></span><br><span class="line">        <span class="comment">// PageFactory本身也被注册为单例。DI容器在创建它时，会自动解析并注入其构造函数所需的Func&lt;&gt;委托。</span></span><br><span class="line">        collection.AddSingleton&lt;PageFactory&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 构建服务提供程序 (ServiceProvider)</span></span><br><span class="line">        <span class="comment">// 调用BuildServiceProvider()方法，根据ServiceCollection中的配置，创建一个ServiceProvider实例。</span></span><br><span class="line">        <span class="comment">// ServiceProvider是实际用于解析和提供服务的对象。</span></span><br><span class="line">        <span class="keyword">var</span> services = collection.BuildServiceProvider();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. 启动主窗口并注入DataContext</span></span><br><span class="line">        <span class="keyword">if</span> (ApplicationLifetime <span class="keyword">is</span> IClassicDesktopStyleApplicationLifetime desktop)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">              通常在 Avalonia 项目中，MainView.axaml.cs 的构造函数里会有一行 InitializeComponent()。当 MainView 被创建时，它的 DataContext 还没有被设置。</span></span><br><span class="line"><span class="comment">              如果 MainView.axaml 中有任何控件试图在 InitializeComponent() 期间绑定到DataContext 的属性，可能会产生绑定错误（虽然通常程序不会崩溃）。</span></span><br><span class="line"><span class="comment">              更稳妥的做法是先创建 MainView，再设置 DataContext，也就是下面正在做的事情。</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            desktop.MainWindow = <span class="keyword">new</span> MainView</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 从DI容器中获取MainViewModel实例，并设置为MainWindow的数据上下文。</span></span><br><span class="line">                <span class="comment">// 此处不再使用`new MainViewModel()`，实现了控制反转。</span></span><br><span class="line">                DataContext = services.GetService&lt;MainViewModel&gt;()</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">base</span>.OnFrameworkInitializationCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-ViewModels-HomePageViewModel-cs和ViewModels-ProcessPageViewModel-cs等"><a href="#5-2-ViewModels-HomePageViewModel-cs和ViewModels-ProcessPageViewModel-cs等" class="headerlink" title="5.2 ViewModels\HomePageViewModel.cs和ViewModels\ProcessPageViewModel.cs等"></a>5.2 ViewModels\HomePageViewModel.cs和ViewModels\ProcessPageViewModel.cs等</h3><p>修改，其他的MacrosPageViewMode.cs、HistoryPageViewModel.cs、ActionsPageViewModel.cs、ReporterPageViewModel.cs、SettingsPageViewModel.cs参照下面的修改即可，这里就不重复了。</p>
<p>之前，我们无法从一个ViewModel实例得知它对应的是哪个页面。为了解决这个问题，我们创建了一个新的基类<code>PageViewModel</code>（见5.7节），它有一个<code>PageName</code>属性。 现在，我们让所有的页面ViewModel都继承自<code>PageViewModel</code>，并在各自的构造函数中，明确地设置自己的<code>PageName</code>。这就像给每个ViewModel发了一个“身份证”，让我们可以随时识别它。</p>
<p>HomePageViewModel.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承自 PageViewModel，而不是 ViewModelBase</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">HomePageViewModel</span> : <span class="title">PageViewModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HomePageViewModel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 在构造函数中，设置自己的身份标识</span></span><br><span class="line">        PageName = ApplicationPageNames.Home;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ProcessPageViewModel.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">ProcessPageViewModel</span> : <span class="title">PageViewModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProcessPageViewModel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageName = ApplicationPageNames.Process;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-Views-ProcessPageView-axaml"><a href="#5-3-Views-ProcessPageView-axaml" class="headerlink" title="5.3 Views\ProcessPageView.axaml"></a>5.3 Views\ProcessPageView.axaml</h3><p>修改，这是一个连锁反应。因为我们在ProcessPageViewModel.cs中删除了之前用于测试的Test属性，所以绑定到这个属性的UI元素（比如一个Label）必须被修改或删除，否则程序在编译时会因为找不到绑定的属性而报错。这提醒我们，ViewModel和View是紧密关联的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;800&quot; d:DesignHeight=&quot;450&quot;</span><br><span class="line">             Foreground=&quot;White&quot;</span><br><span class="line">             xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">             x:DataType=&quot;vm:ProcessPageViewModel&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.Views.ProcessPageView&quot;&gt;</span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:ProcessPageViewModel&gt;&lt;/vm:ProcessPageViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    Welcome to Process!</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-ViewModels-MainViewModel-cs"><a href="#5-4-ViewModels-MainViewModel-cs" class="headerlink" title="5.4 ViewModels\MainViewModel.cs"></a>5.4 ViewModels\MainViewModel.cs</h3><p>修改。</p>
<p>MainViewModel是这次重构的最大受益者。它变得更加“干净”和“职责单一”。</p>
<ol>
<li>它不再负责创建任何页面的ViewModel。</li>
<li>它不再持有每个页面的ViewModel实例。</li>
<li>它只需要知道一个东西：PageFactory。当需要页面时，它就向工厂“下单”。</li>
<li>通过检查CurrentPage.PageName，它就能知道当前是哪个页面，从而更新侧边栏按钮的选中状态。</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Avalonia.Svg.Skia;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Factories;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Views;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.Input;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 之前这里有一大堆各个页面的ViewModel属性，现在全部删除了。</span></span><br><span class="line">    <span class="comment">// 只保留一个对PageFactory的引用。</span></span><br><span class="line">    <span class="keyword">private</span> PageFactory _pageFactory;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _sideMenuExpanded = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前页面的类型从 ViewModelBase 变成了 PageViewModel，</span></span><br><span class="line">    <span class="comment">// 这样我们就可以访问到它的 PageName 属性。</span></span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HomePageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ProcessPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ActionsPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(MacrosPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ReporterPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HistoryPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(SettingsPageIsActive))</span>]</span><br><span class="line">    <span class="keyword">private</span> PageViewModel _currentPage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断按钮是否选中的逻辑，从比较ViewModel实例，</span></span><br><span class="line">    <span class="comment">// 变成了比较当前页面的PageName枚举值。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HomePageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Home;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ProcessPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Process;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ActionsPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Actions;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> MacrosPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Macros;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ReporterPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Reporter;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HistoryPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.History;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> SettingsPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Settings;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数注入：</span></span><br><span class="line">    <span class="comment">// MainViewModel不再自己new任何东西，它在构造函数中声明“我需要一个PageFactory”。</span></span><br><span class="line">    <span class="comment">// DI容器在创建MainViewModel时，会自动把之前注册好的PageFactory实例传给它。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>(<span class="params">PageFactory pageFactory</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _pageFactory = pageFactory;</span><br><span class="line">        GoToHome();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SideMenuResize</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        SideMenuExpanded = !SideMenuExpanded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 导航方法：</span></span><br><span class="line">    <span class="comment">// 不再是 CurrentPage = _homePageViewModel;</span></span><br><span class="line">    <span class="comment">// 而是向工厂请求一个新的页面ViewModel实例。</span></span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHome</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Home);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToProcess</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Process);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToMacros</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Macros);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToActions</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Actions);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToReporter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Reporter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHistory</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.History);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToSettings</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Settings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-5-Data-ApplicationPageNames-cs"><a href="#5-5-Data-ApplicationPageNames-cs" class="headerlink" title="5.5 Data\ApplicationPageNames.cs"></a>5.5 Data\ApplicationPageNames.cs</h3><p>新建Data文件夹和ApplicationPageNames.cs文件。</p>
<p>这是一个新建的**枚举（enum）**类型。它的作用是为我们应用程序中所有的页面定义一组固定的、有意义的名称。</p>
<p><strong>为什么要用枚举而不是字符串？</strong></p>
<ul>
<li><strong>类型安全：</strong> 防止在代码中出现拼写错误。如果你写”Hmoe”，编译器不会报错，但程序会出错。如果你写ApplicationPageNames.Hmoe，编译器会立刻提示你没有这个成员。</li>
<li><strong>代码清晰：</strong> GoToPage(ApplicationPageNames.Home)比GoToPage(“Home”)意图更明确。</li>
<li><strong>智能提示：</strong> 在编写代码时，IDE会提示所有可用的页面名称，非常方便。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.Data</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个枚举来表示所有的页面名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> ApplicationPageNames</span><br><span class="line">&#123;</span><br><span class="line">    Unknown, <span class="comment">// 一个默认值，用于处理未知状态</span></span><br><span class="line">    Home,</span><br><span class="line">    Process,</span><br><span class="line">    Actions,</span><br><span class="line">    Macros,</span><br><span class="line">    Reporter,</span><br><span class="line">    History,</span><br><span class="line">    Settings</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-6-ViewModels-PageViewModel-cs"><a href="#5-6-ViewModels-PageViewModel-cs" class="headerlink" title="5.6 ViewModels\PageViewModel.cs"></a>5.6 ViewModels\PageViewModel.cs</h3><p>新建。</p>
<p>这是一个新建的<strong>基类（Base Class）</strong>。它的目的是为所有“页面级别”的ViewModel提供一个共同的规范。任何继承自PageViewModel的类，都将自动拥有一个PageName属性。</p>
<p>这使得我们可以在MainViewModel中用一个_currentPage字段来持有任何类型的页面，并且都能安全地访问它的PageName属性来判断它到底是哪个页面。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个类继承自ViewModelBase，所以它也具备INotifyPropertyChanged的功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">PageViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义了一个所有页面ViewModel都将拥有的属性：PageName</span></span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="keyword">private</span> ApplicationPageNames _pageName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-7-Factories-PageFactory-cs"><a href="#5-7-Factories-PageFactory-cs" class="headerlink" title="5.7 Factories\PageFactory.cs"></a>5.7 Factories\PageFactory.cs</h3><p>新建Factories文件夹和PageFactory.cs文件</p>
<p>这就是我们的<strong>工厂（Factory）</strong>。它的职责非常单一：<strong>根据给定的页面名称，生产出对应的页面ViewModel</strong>。</p>
<p>它自己并不知道具体如何创建ViewModel，而是通过构造函数注入了一个“生产方法”（也就是我们在App.axaml.cs里注册的那个复杂的Func）。当外部调用GetPageViewModel时，它只是简单地调用（Invoke）这个被注入的方法来完成生产任务。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.ViewModels;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.Factories</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用了C# 新版本的主构造函数(Primary Constructor)语法，非常简洁，这是 C# 12 (.NET 8) 中正式引入的语言特性。</span></span><br><span class="line"><span class="comment">// `(Func&lt;ApplicationPageNames, PageViewModel&gt; factory)` 直接定义了构造函数和私有字段。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PageFactory</span>(<span class="params">Func&lt;ApplicationPageNames, PageViewModel&gt; factory</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 当调用此方法时，它会执行(Invoke)构造函数传入的factory委托。</span></span><br><span class="line">    <span class="comment">// `factory.Invoke(pageNames)` 最终会执行我们在App.axaml.cs中定义的switch表达式。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PageViewModel <span class="title">GetPageViewModel</span>(<span class="params">ApplicationPageNames pageNames</span>)</span> =&gt; factory.Invoke(pageNames);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面的是简洁的写法，和下面等价。</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">public class PageFactory</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    // 这是一个私有只读字段，用来存储“生产方法”</span></span><br><span class="line"><span class="comment">    private readonly Func&lt;ApplicationPageNames, PageViewModel&gt; _pageFactory;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 通过构造函数，DI容器会将那个Func注入进来</span></span><br><span class="line"><span class="comment">    public PageFactory(Func&lt;ApplicationPageNames, PageViewModel&gt; factory)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        _pageFactory = factory;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    // 调用方法，实际上是调用存储的那个Func</span></span><br><span class="line"><span class="comment">    public PageViewModel GetPageViewModel(ApplicationPageNames pageNames)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        return _pageFactory.Invoke(pageNames);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="5-8-当前目录结构"><a href="#5-8-当前目录结构" class="headerlink" title="5.8 当前目录结构"></a>5.8 当前目录结构</h3><p>去除&#x2F;bin、&#x2F;obj，让显示简洁。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">│  App.axaml</span><br><span class="line">│  App.axaml.cs</span><br><span class="line">│  app.manifest</span><br><span class="line">│  AvaloniaApplication2.csproj</span><br><span class="line">│  Program.cs</span><br><span class="line">│  ViewLocator.cs</span><br><span class="line">│</span><br><span class="line">├─Assets</span><br><span class="line">│  ├─Fonts</span><br><span class="line">│  │      AkkoPro<span class="literal">-Bold</span>.ttf</span><br><span class="line">│  │      AkkoPro<span class="literal">-Regular</span>.ttf</span><br><span class="line">│  │      Phosphor<span class="literal">-Fill</span>.ttf</span><br><span class="line">│  │      Phosphor.ttf</span><br><span class="line">│  │</span><br><span class="line">│  └─Images</span><br><span class="line">│          icon.svg</span><br><span class="line">│          logo.svg</span><br><span class="line">│</span><br><span class="line">├─<span class="keyword">Data</span></span><br><span class="line">│      ApplicationPageNames.cs</span><br><span class="line">│</span><br><span class="line">├─Factories</span><br><span class="line">│      PageFactory.cs</span><br><span class="line">│</span><br><span class="line">├─Styles</span><br><span class="line">│      AppDefaultStyles.axaml</span><br><span class="line">│</span><br><span class="line">├─ViewModels</span><br><span class="line">│      ActionsPageViewModel.cs</span><br><span class="line">│      HistoryPageViewModel.cs</span><br><span class="line">│      HomePageViewModel.cs</span><br><span class="line">│      MacrosPageViewModel.cs</span><br><span class="line">│      MainViewModel.cs</span><br><span class="line">│      PageViewModel.cs</span><br><span class="line">│      ProcessPageViewModel.cs</span><br><span class="line">│      ReporterPageViewModel.cs</span><br><span class="line">│      SettingsPageViewModel.cs</span><br><span class="line">│      ViewModelBase.cs</span><br><span class="line">│</span><br><span class="line">└─Views</span><br><span class="line">        ActionsPageView.axaml</span><br><span class="line">        ActionsPageView.axaml.cs</span><br><span class="line">        HistoryPageView.axaml</span><br><span class="line">        HistoryPageView.axaml.cs</span><br><span class="line">        HomePageView.axaml</span><br><span class="line">        HomePageView.axaml.cs</span><br><span class="line">        MacrosPageView.axaml</span><br><span class="line">        MacrosPageView.axaml.cs</span><br><span class="line">        MainView.axaml</span><br><span class="line">        MainView.axaml.cs</span><br><span class="line">        ProcessPageView.axaml</span><br><span class="line">        ProcessPageView.axaml.cs</span><br><span class="line">        ReporterPageView.axaml</span><br><span class="line">        ReporterPageView.axaml.cs</span><br><span class="line">        SettingsPageView.axaml</span><br><span class="line">        SettingsPageView.axaml.cs</span><br></pre></td></tr></table></figure>

<h2 id="Avalonia-学习笔记06-Page-Layout（页面布局）"><a href="#Avalonia-学习笔记06-Page-Layout（页面布局）" class="headerlink" title="Avalonia 学习笔记06. Page Layout（页面布局）"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/19027878">Avalonia 学习笔记06. Page Layout（页面布局）</a></h2><p>视频链接：<a target="_blank" rel="noopener" href="https://youtu.be/af__jpGGG-0?si=ql1S23F1reakjBG7">https://youtu.be/af__jpGGG-0?si=ql1S23F1reakjBG7</a></p>
<p>本节课程的目标是根据一个预先设计好的 UI 模型，使用 Avalonia XAML 来构建“设置”页面的<strong>结构</strong>。我们将重点放在如何使用 <code>Grid</code> 和 <code>StackPanel</code> 等布局控件来正确地放置元素，而将具体的<strong>样式</strong>（如颜色、字体、边框等）留到下一节课。这种将“结构”和“样式”分离的思路，是现代 UI 开发中的一个重要实践。</p>
<h3 id="6-1-ViewModels-MainViewModel-cs"><a href="#6-1-ViewModels-MainViewModel-cs" class="headerlink" title="6.1 ViewModels\MainViewModel.cs"></a>6.1 ViewModels\MainViewModel.cs</h3><p>我们首先对 <code>MainViewModel</code> 做一个小修改，以解决 XAML 设计器中的一个预览问题。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Avalonia.Svg.Skia;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Factories;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Views;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.Input;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainViewModel</span> : <span class="title">ViewModelBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> PageFactory _pageFactory;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> _sideMenuExpanded = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HomePageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ProcessPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ActionsPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(MacrosPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(ReporterPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(HistoryPageIsActive))</span>]</span><br><span class="line">    [<span class="meta">NotifyPropertyChangedFor(nameof(SettingsPageIsActive))</span>]</span><br><span class="line">    <span class="keyword">private</span> PageViewModel _currentPage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HomePageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Home;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ProcessPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Process;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ActionsPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Actions;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> MacrosPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Macros;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> ReporterPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Reporter;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> HistoryPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.History;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> SettingsPageIsActive =&gt; CurrentPage.PageName == ApplicationPageNames.Settings;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 仅用于设计时 (Design-Time only constructor)。</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;remarks&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 这个无参数的构造函数是专门为 XAML 设计器准备的。</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 因为我们引入了依赖注入，原来的构造函数需要一个 `PageFactory` 参数，</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 这是在程序“运行时”才由 DI 容器提供的。</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> XAML 设计器在“设计时”无法提供这个参数，会导致预览失败。</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 通过添加这个无参数构造函数，并为 `CurrentPage` 设置一个默认页面（这里是 SettingsPageViewModel），</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设计器就能够成功实例化 MainViewModel，从而正常显示 MainView 的预览界面。</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/remarks&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = <span class="keyword">new</span> SettingsPageViewModel();</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span>(<span class="params">PageFactory pageFactory</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _pageFactory = pageFactory;</span><br><span class="line">        GoToHome();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SideMenuResize</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        SideMenuExpanded = !SideMenuExpanded;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHome</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Home);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToProcess</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Process);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToMacros</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Macros);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToActions</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Actions);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToReporter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Reporter);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToHistory</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.History);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">RelayCommand</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">GoToSettings</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        CurrentPage = _pageFactory.GetPageViewModel(ApplicationPageNames.Settings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-ViewModels-SettingsPageViewModel-cs"><a href="#6-2-ViewModels-SettingsPageViewModel-cs" class="headerlink" title="6.2 ViewModels\SettingsPageViewModel.cs"></a>6.2 ViewModels\SettingsPageViewModel.cs</h3><p>这是为“设置”页面创建的新的 ViewModel。我们在这里添加一些临时的示例数据，以便在 UI 上看到列表的显示效果。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> CommunityToolkit.Mvvm.ComponentModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.ViewModels</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">SettingsPageViewModel</span> : <span class="title">PageViewModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 使用 [ObservableProperty] 特性，CommunityToolkit.Mvvm 会自动为私有字段 `_locationPaths`</span></span><br><span class="line">    <span class="comment">// 生成一个名为 `LocationPaths` 的公共属性。</span></span><br><span class="line">    <span class="comment">// 这个属性会自动实现 INotifyPropertyChanged 接口，当它的值改变时，会通知 UI 更新。</span></span><br><span class="line">    [<span class="meta">ObservableProperty</span>]</span><br><span class="line">    <span class="keyword">private</span> List&lt;<span class="built_in">string</span>&gt; _locationPaths;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SettingsPageViewModel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PageName = ApplicationPageNames.Settings;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// TEMP: Remove</span></span><br><span class="line">        <span class="comment">// 在构造函数中，我们为 LocationPaths 初始化了一些临时的假数据。</span></span><br><span class="line">        <span class="comment">// 这使得我们在开发 UI 界面时，即使没有后端逻辑，也能看到列表的实际显示效果。</span></span><br><span class="line">        <span class="comment">// 这里使用了 C# 12 的集合表达式 `[...]` 和逐字字符串 `@&quot;&quot;`，使代码更简洁。</span></span><br><span class="line">        LocationPaths =</span><br><span class="line">        [</span><br><span class="line">            <span class="string">@&quot;C:\Users\Luke\Downloads\TestActions&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;C:\Users\Luke\Documents\BatchProcess&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;X:\Shared\BatchProcess\Templates&quot;</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-Views-SettingsPageView-axaml"><a href="#6-3-Views-SettingsPageView-axaml" class="headerlink" title="6.3 Views\SettingsPageView.axaml"></a>6.3 Views\SettingsPageView.axaml</h3><p>这是本节课的核心，即“设置”页面的 XAML 结构代码。我们一步步将设计图分解为 XAML 控件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">             xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1100&quot; d:DesignHeight=&quot;900&quot;</span><br><span class="line">             Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;</span><br><span class="line">             Foreground=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;</span><br><span class="line">             x:DataType=&quot;vm:SettingsPageViewModel&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.Views.SettingsPageView&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- </span><br><span class="line">    为设计器提供数据上下文(DataContext)。</span><br><span class="line">    这行代码告诉 XAML 设计器在预览时使用 `SettingsPageViewModel` 的一个实例作为数据源。</span><br><span class="line">    这使得在设计器中可以看到数据绑定（如 ItemsSource=&quot;&#123;Binding LocationPaths&#125;&quot;）的效果。</span><br><span class="line">    它只在设计时生效，不影响程序实际运行。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:SettingsPageViewModel&gt;&lt;/vm:SettingsPageViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- </span><br><span class="line">    页面根布局：一个2行2列的 Grid。</span><br><span class="line">    - ColumnDefinitions=&quot;*, *&quot;: 定义两个宽度相等的列，它们会平分所有可用宽度。</span><br><span class="line">    - RowDefinitions=&quot;Auto, *&quot;: 定义两行。第一行（头部）的高度由其内容决定（Auto），第二行（内容区）占据所有剩余的高度（*）。</span><br><span class="line">    这是构建经典“头+体”布局的常用方式。</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;Grid ColumnDefinitions=&quot;*, *&quot; RowDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;!-- Header: 头部区域 --&gt;</span><br><span class="line">        &lt;!-- Grid.ColumnSpan=&quot;2&quot; 让这个头部的 Grid 横跨两列 --&gt;</span><br><span class="line">        &lt;Grid Name=&quot;HeaderGrid&quot; Grid.ColumnSpan=&quot;2&quot;&gt;</span><br><span class="line">            &lt;!-- </span><br><span class="line">            Grid 是一个很好的堆叠控件。这里我们将 Image 和 StackPanel 放在同一个单元格中，</span><br><span class="line">            它们会重叠在一起，Image 在下，StackPanel 在上。</span><br><span class="line">            - Image 的 Stretch=&quot;UniformToFill&quot; 属性确保图片在保持自身比例的同时，填满整个容器区域，超出部分会被裁剪。</span><br><span class="line">            --&gt;</span><br><span class="line">            &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/background-settings.svg&#125;&quot; Height=&quot;160&quot; Stretch=&quot;UniformToFill&quot;&gt;&lt;/Image&gt;</span><br><span class="line">            &lt;StackPanel HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Settings&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Version 3.0.0.2 Beta&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Compiled Jul 07 2025&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Left side content: 左侧内容区 --&gt;</span><br><span class="line">        &lt;!-- </span><br><span class="line">        - Grid.Column=&quot;0&quot; Grid.Row=&quot;1&quot; 将这个 StackPanel 放置在主 Grid 的第一列、第二行。</span><br><span class="line">        - Spacing=&quot;10&quot; 为 StackPanel 内的直接子元素（如此处的 General 和 Location 两个区域）之间添加 10 个单位的垂直间距。</span><br><span class="line">        - Margin=&quot;15&quot; 在 StackPanel 的四周添加 15 个单位的外边距，起到内边距的效果，让内容不至于贴边。</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;0&quot; Grid.Row=&quot;1&quot; Spacing=&quot;10&quot; Margin=&quot;15&quot;&gt;</span><br><span class="line">            &lt;!-- General: “常规”设置区域 --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;General&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;!-- </span><br><span class="line">                使用一个嵌套的 Grid 来对齐左侧的描述文本和右侧的控件。</span><br><span class="line">                - ColumnDefinitions=&quot;*, Auto&quot;: 左列占据所有剩余空间，右列宽度由其内容（按钮、复选框）决定。</span><br><span class="line">                --&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, Auto&quot; RowDefinitions=&quot;Auto, Auto, Auto&quot;&gt;</span><br><span class="line">                    &lt;!-- Release license --&gt;</span><br><span class="line">                    &lt;!-- TextBlock 用于显示长文本，因为它支持 TextWrapping=&quot;Wrap&quot; 自动换行。Label 不支持。--&gt;</span><br><span class="line">                    &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;Remove license of BatchProcess from this machine and release the license back to the server ready to be transferred to another machine.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;Button Grid.Row=&quot;0&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;!-- &amp;#xE2FE; 是一个图标字体的 Unicode 编码，用于显示图标 --&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2FE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Release License&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;!-- Skip Files --&gt;</span><br><span class="line">                    &lt;TextBlock Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot; TextWrapping=&quot;Wrap&quot; Text=&quot;Skip files if only Open, Save (Optional) and Close are Valid actions.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;CheckBox Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot;&gt;&lt;/CheckBox&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;!-- Duplicate Entries --&gt;</span><br><span class="line">                    &lt;TextBlock Grid.Row=&quot;2&quot; Grid.Column=&quot;0&quot; TextWrapping=&quot;Wrap&quot; Text=&quot;Allow duplicate entries of the same file in project list&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;CheckBox Grid.Row=&quot;2&quot; Grid.Column=&quot;1&quot;&gt;&lt;/CheckBox&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;!-- Location: “位置”设置区域 --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;Location&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                    &lt;StackPanel&gt;</span><br><span class="line">                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;Add or remove the locations to search for Reporter Templates, Macros, Actions and other custom files or templates.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;All sub-directories will be searched automatically&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;+ Folder&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">                &lt;!--</span><br><span class="line">                使用 ListBox 来显示文件夹路径列表。</span><br><span class="line">                - ItemsSource=&quot;&#123;Binding LocationPaths&#125;&quot; 是核心的数据绑定语法，它将此列表的数据源绑定到 ViewModel 中的 `LocationPaths` 属性。</span><br><span class="line">                - 选择 ListBox 而不是更基础的 ItemsControl，是因为 ListBox 自带了选中、悬停等交互效果和基本样式，方便后续功能开发。</span><br><span class="line">                --&gt;</span><br><span class="line">                &lt;ListBox ItemsSource=&quot;&#123;Binding LocationPaths&#125;&quot;&gt;&lt;/ListBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Right Side Content: 右侧内容区 --&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;1&quot; Grid.Row=&quot;1&quot; Spacing=&quot;10&quot; Margin=&quot;15&quot;&gt;</span><br><span class="line">            &lt;!-- SolidWorks Host --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;SolidWorks Host&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot;&gt;</span><br><span class="line">                    BatchProcess can work locally on the current machine, or on any machine accessible</span><br><span class="line">                    over the network or even internet.&lt;LineBreak /&gt;&lt;LineBreak /&gt;</span><br><span class="line">                    </span><br><span class="line">                    Enter the machines IP address, network name or localhost for this machine.</span><br><span class="line">                &lt;/TextBlock&gt;</span><br><span class="line">                &lt;ComboBox&gt;&lt;/ComboBox&gt;</span><br><span class="line">                &lt;Label Content=&quot;Connection established&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            &lt;!-- PDM Enterprise --&gt;</span><br><span class="line">            &lt;StackPanel Spacing=&quot;15&quot;&gt;</span><br><span class="line">                &lt;Label Content=&quot;PDM Enterprise&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;If you are using PDM Enterprise enter the credentials below and test login. BatchProcess can then automatically handle checking in and out files from PDM Enterprise.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                &lt;!-- </span><br><span class="line">                这里使用三列等宽的 Grid，是为了让三个输入框（ComboBox, TextBox, TextBox）平分横向空间。</span><br><span class="line">                如果使用水平 StackPanel，它们只会各自占据所需宽度，无法实现均分拉伸的效果。</span><br><span class="line">                --&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, *, *&quot;&gt;</span><br><span class="line">                    &lt;ComboBox HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/ComboBox&gt;</span><br><span class="line">                    &lt;TextBox Grid.Column=&quot;1&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                    &lt;TextBox Grid.Column=&quot;2&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">                &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE23E;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Login&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE094;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Refresh Vault&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;Connection Established&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            &lt;!-- Setting Cache --&gt;</span><br><span class="line">            &lt;StackPanel Spacing=&quot;15&quot;&gt;</span><br><span class="line">                &lt;Label Content=&quot;Setting Cache&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot;&gt;</span><br><span class="line">                    Various settings are stored locally including Processes, Actions, Macros, Reports and History. &lt;LineBreak /&gt;&lt;LineBreak /&gt;</span><br><span class="line">                    If you are experiencing issues you can try clearing the cache (this won&#x27;t remove the license).</span><br><span class="line">                &lt;/TextBlock&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEC54;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Clear Cache&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE5DE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Export Cache&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE20C;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Import Cache&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Avalonia-学习笔记07-Control-Themes（控件主题）"><a href="#Avalonia-学习笔记07-Control-Themes（控件主题）" class="headerlink" title="Avalonia 学习笔记07. Control Themes（控件主题）"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/simonoct/p/19027881">Avalonia 学习笔记07. Control Themes（控件主题）</a></h2><p>视频链接：<a target="_blank" rel="noopener" href="https://youtu.be/M3CFj0x-tts?si=n3HtIDE9YrcAKqVm">https://youtu.be/M3CFj0x-tts?si=n3HtIDE9YrcAKqVm</a></p>
<p>在本章节中，我们的目标是创建一个可复用的、带图标的按钮控件，以简化我们在视图（View）中编写的XAML代码。当前，每创建一个带图标的按钮，都需要在 <code>&lt;Button&gt;</code> 内部嵌套一个 <code>&lt;StackPanel&gt;</code> 和两个 <code>&lt;Label&gt;</code>，这非常繁琐。</p>
<p>我们将创建一个名为 <code>IconButton</code> 的新控件，它天生就包含一个图标区域和一个内容区域，使得我们可以像这样使用它：<code>&lt;IconButton IconText=&quot;...&quot; Content=&quot;...&quot;/&gt;</code>。我们将通过**控件主题（ControlTheme）**来实现这个功能，这是一种深度自定义控件外观的强大方式。</p>
<h3 id="7-1-Controls-IconButton-axaml"><a href="#7-1-Controls-IconButton-axaml" class="headerlink" title="7.1 Controls\IconButton.axaml"></a>7.1 Controls\IconButton.axaml</h3><p>首先，我们在项目中新建一个名为 <code>Controls</code> 的文件夹。然后右键点击该文件夹，选择“添加” -&gt; “新建项”，在 Avalonia 分类中选择 <strong>Templated Control（模板化控件）</strong>，并将其命名为 <code>IconButton.axaml</code>。</p>
<p>创建完成后，我们会得到一个 <code>.axaml</code> 文件和一个对应的 <code>.axaml.cs</code> 后台代码文件。</p>
<p>我们的目标是让 <code>IconButton</code> 拥有标准按钮的所有外观和行为，并在此基础上增加一个图标。最简单的方式就是复制 Avalonia Fluent 主题中 <code>Button</code> 的默认模板，然后进行修改。</p>
<p>以下代码就是从 Avalonia 源码中复制并修改而来的 <code>Button</code> 的 <code>ControlTheme</code>。</p>
<p>这个初始的模板可以在这个链接获取：<a target="_blank" rel="noopener" href="https://github.com/AvaloniaUI/Avalonia/blob/master/src/Avalonia.Themes.Fluent/Controls/Button.xaml">https://github.com/AvaloniaUI/Avalonia/blob/master/src/Avalonia.Themes.Fluent/Controls/Button.xaml</a></p>
<p><strong>关键修改点解释：</strong></p>
<ol>
<li><strong><code>&lt;ControlTheme x:Key=&quot;{x:Type IconButton}&quot; TargetType=&quot;IconButton&quot;&gt;</code></strong><ul>
<li><strong>用途</strong>：这行代码声明了我们正在定义一个控件主题。<code>TargetType=&quot;IconButton&quot;</code> 指定了这个主题是为我们自己的 <code>IconButton</code> 控件设计的。它会成为 <code>IconButton</code> 的默认外观。</li>
</ul>
</li>
<li><strong><code>&lt;ContentPresenter.ContentTemplate&gt;</code></strong><ul>
<li><strong>用途</strong>：我们不再让 <code>ContentPresenter</code> 简单地显示内容，而是为它提供了一个 <code>DataTemplate</code>（数据模板）。这个模板定义了内容的具体结构：一个水平排列的 <code>StackPanel</code>，里面包含一个用于显示图标的 <code>Label</code> 和一个用于显示主要内容的 <code>ContentControl</code>。</li>
</ul>
</li>
<li><strong>图标绑定：<code>Content=&quot;{Binding $parent[IconButton].IconText}&quot;</code></strong><ul>
<li><strong>用途</strong>：这是 <code>DataTemplate</code> 内部的绑定语法。<code>$parent[IconButton]</code> 的意思是“从当前位置向上查找，找到第一个名为 <code>IconButton</code> 的父控件”，然后 <code>.IconText</code> 表示绑定到该控件的 <code>IconText</code> 属性。这样，我们在XAML中设置的 <code>IconText</code> 就能正确地显示为图标了。</li>
<li><strong>注意</strong>：<code>Label</code> 的 <code>Classes=&quot;icon&quot;</code> 是为了能让 <code>AppDefaultStyles.axaml</code> 中定义的图标字体样式应用到这个 <code>Label</code> 上。</li>
</ul>
</li>
<li><strong>内容和数据上下文绑定</strong><ul>
<li><strong>用途</strong>：<code>&lt;ContentControl DataContext=&quot;{...}&quot; Content=&quot;{...}&quot; /&gt;</code> 这一部分是为了修复一个在视频后面会遇到的 <code>DataContext</code>（数据上下文）问题。当我们在 <code>IconButton</code> 内部放置一个需要绑定到视图模型（ViewModel）的控件时（比如侧边栏可以折叠的文字），这个设置可以确保数据上下文被正确地传递下去，让绑定能够正常工作。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 备注：这是 IconButton 的视觉模板定义文件。 --&gt;</span><br><span class="line">&lt;!-- 它决定了 IconButton 在界面上看起来是什么样子。 --&gt;</span><br><span class="line">&lt;ResourceDictionary xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">                    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">                    x:ClassModifier=&quot;internal&quot;&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;!-- Design.PreviewWith 用于在设计器中预览控件效果，不影响程序运行 --&gt;</span><br><span class="line">  &lt;Design.PreviewWith&gt;</span><br><span class="line">    &lt;Border Padding=&quot;20&quot;&gt;</span><br><span class="line">      &lt;StackPanel Spacing=&quot;20&quot;&gt;</span><br><span class="line">        &lt;IconButton IconText=&quot;&amp;#xe7f2;&quot; Content=&quot;Click Me!&quot; /&gt;</span><br><span class="line">        &lt;IconButton IconText=&quot;&amp;#xe3ee;&quot; Classes=&quot;accent&quot; Content=&quot;Click Me!&quot; /&gt;</span><br><span class="line">        &lt;Button Content=&quot;Click Me!&quot; /&gt;</span><br><span class="line">        &lt;Button Classes=&quot;accent&quot; Content=&quot;Click Me!&quot; /&gt;</span><br><span class="line">      &lt;/StackPanel&gt;</span><br><span class="line">    &lt;/Border&gt;</span><br><span class="line">  &lt;/Design.PreviewWith&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 这是 IconButton 控件的主题定义 --&gt;</span><br><span class="line">  &lt;ControlTheme x:Key=&quot;&#123;x:Type IconButton&#125;&quot; TargetType=&quot;IconButton&quot;&gt;</span><br><span class="line">    &lt;!-- 下面是按钮在各种状态下的默认样式设置（背景、前景、边框等） --&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource ButtonBackground&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource ButtonForeground&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource ButtonBorderBrush&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;BorderThickness&quot; Value=&quot;&#123;DynamicResource ButtonBorderThemeThickness&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;&#123;DynamicResource ControlCornerRadius&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Padding&quot; Value=&quot;&#123;DynamicResource ButtonPadding&#125;&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;HorizontalAlignment&quot; Value=&quot;Left&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;VerticalAlignment&quot; Value=&quot;Center&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;none&quot; /&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">      &lt;Transitions&gt;</span><br><span class="line">        &lt;TransformOperationsTransition Property=&quot;RenderTransform&quot; Duration=&quot;0:0:.075&quot; /&gt;</span><br><span class="line">      &lt;/Transitions&gt;</span><br><span class="line">    &lt;/Setter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Template 定义了控件的内部结构 (ControlTemplate) --&gt;</span><br><span class="line">    &lt;Setter Property=&quot;Template&quot;&gt;</span><br><span class="line">      &lt;ControlTemplate&gt;</span><br><span class="line">        &lt;ContentPresenter x:Name=&quot;PART_ContentPresenter&quot;</span><br><span class="line">                          Background=&quot;&#123;TemplateBinding Background&#125;&quot;</span><br><span class="line">                          BorderBrush=&quot;&#123;TemplateBinding BorderBrush&#125;&quot;</span><br><span class="line">                          BorderThickness=&quot;&#123;TemplateBinding BorderThickness&#125;&quot;</span><br><span class="line">                          CornerRadius=&quot;&#123;TemplateBinding CornerRadius&#125;&quot;</span><br><span class="line">                          Padding=&quot;&#123;TemplateBinding Padding&#125;&quot;</span><br><span class="line">                          RecognizesAccessKey=&quot;True&quot;</span><br><span class="line">                          HorizontalContentAlignment=&quot;&#123;TemplateBinding HorizontalContentAlignment&#125;&quot;</span><br><span class="line">                          VerticalContentAlignment=&quot;&#123;TemplateBinding VerticalContentAlignment&#125;&quot;&gt;</span><br><span class="line">          </span><br><span class="line">          &lt;!-- 这里是我们自定义的内容模板，用于显示图标和文字 --&gt;</span><br><span class="line">          &lt;ContentPresenter.ContentTemplate&gt;</span><br><span class="line">            &lt;DataTemplate DataType=&quot;x:Object&quot;&gt;</span><br><span class="line">              &lt;StackPanel Orientation=&quot;Horizontal&quot; Spacing=&quot;8&quot;&gt;</span><br><span class="line">                &lt;!-- 这个 Label 用于显示图标，它的 Content 绑定到 IconButton 的 IconText 属性 --&gt;</span><br><span class="line">                &lt;Label Classes=&quot;icon&quot; Content=&quot;&#123;Binding $parent[IconButton].IconText&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;!-- 这个 ContentControl 用于显示 IconButton 的主要内容，并修复了 DataContext 的问题 --&gt;</span><br><span class="line">                &lt;ContentControl DataContext=&quot;&#123;Binding $parent[IconButton].DataContext&#125;&quot; Content=&quot;&#123;Binding $parent[IconButton].Content&#125;&quot; /&gt;</span><br><span class="line">              &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/DataTemplate&gt;</span><br><span class="line">          &lt;/ContentPresenter.ContentTemplate&gt;</span><br><span class="line">          </span><br><span class="line">        &lt;/ContentPresenter&gt;</span><br><span class="line">      &lt;/ControlTemplate&gt;</span><br><span class="line">    &lt;/Setter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 下面是按钮在不同交互状态（如鼠标悬浮、按下）下的样式变化 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;^:pointerover /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource ButtonBackgroundPointerOver&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource ButtonBorderBrushPointerOver&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource ButtonForegroundPointerOver&#125;&quot; /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Style Selector=&quot;^:pressed&quot;&gt;</span><br><span class="line">      &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(0.98)&quot; /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Style Selector=&quot;^:pressed  /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource ButtonBackgroundPressed&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource ButtonBorderBrushPressed&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource ButtonForegroundPressed&#125;&quot; /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Style Selector=&quot;^:disabled /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource ButtonBackgroundDisabled&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource ButtonBorderBrushDisabled&#125;&quot; /&gt;</span><br><span class="line">      &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource ButtonForegroundDisabled&#125;&quot; /&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 这是对拥有 &quot;accent&quot; 样式的按钮的特殊处理 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;^.accent&quot;&gt;</span><br><span class="line">      &lt;Style Selector=&quot;^ /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource AccentButtonBackground&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource AccentButtonBorderBrush&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource AccentButtonForeground&#125;&quot; /&gt;</span><br><span class="line">      &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Style Selector=&quot;^:pointerover /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource AccentButtonBackgroundPointerOver&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource AccentButtonBorderBrushPointerOver&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource AccentButtonForegroundPointerOver&#125;&quot; /&gt;</span><br><span class="line">      &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Style Selector=&quot;^:pressed  /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource AccentButtonBackgroundPressed&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource AccentButtonBorderBrushPressed&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource AccentButtonForegroundPressed&#125;&quot; /&gt;</span><br><span class="line">      &lt;/Style&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Style Selector=&quot;^:disabled /template/ ContentPresenter#PART_ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource AccentButtonBackgroundDisabled&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;BorderBrush&quot; Value=&quot;&#123;DynamicResource AccentButtonBorderBrushDisabled&#125;&quot; /&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource AccentButtonForegroundDisabled&#125;&quot; /&gt;</span><br><span class="line">      &lt;/Style&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">  &lt;/ControlTheme&gt;</span><br><span class="line">&lt;/ResourceDictionary&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-Controls-IconButton-axaml-cs"><a href="#7-2-Controls-IconButton-axaml-cs" class="headerlink" title="7.2 Controls\IconButton.axaml.cs"></a>7.2 Controls\IconButton.axaml.cs</h3><p>这是 <code>IconButton</code> 的后台代码文件。</p>
<p><strong>关键修改点解释：</strong></p>
<ol>
<li><strong><code>public class IconButton : Button</code></strong><ul>
<li><strong>用途</strong>：我们将基类从默认的 <code>TemplatedControl</code> 修改为了 <code>Button</code>。这是至关重要的一步。通过继承 <code>Button</code>，我们的 <code>IconButton</code> 自动获得了按钮的所有核心功能，例如 <code>Click</code> 事件、<code>Command</code> 绑定、可点击性等。它现在“是”一个按钮了。</li>
</ul>
</li>
<li><strong><code>IconTextProperty</code></strong><ul>
<li><strong>用途</strong>：我们在这里定义了一个新的 <strong><code>StyledProperty</code>（样式化属性）</strong>，名为 <code>IconText</code>。<code>StyledProperty</code> 是 Avalonia 中的一种特殊属性，它支持数据绑定、样式设置和在模板中使用。这使得我们可以在 XAML 文件中像这样 <code>&lt;IconButton IconText=&quot;...&quot;/&gt;</code> 来给它赋值。</li>
</ul>
</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 备注：这是 IconButton 的后台逻辑代码文件。</span></span><br><span class="line"><span class="keyword">using</span> Avalonia;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Controls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2.Controls</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键：让 IconButton 继承自 Button，这样它就拥有了按钮的所有功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IconButton</span> : <span class="title">Button</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义一个名为 IconText 的新属性，这样我们就可以在 XAML 中设置它</span></span><br><span class="line">    <span class="comment">// StyledProperty 是一种支持数据绑定和样式的特殊属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> StyledProperty&lt;<span class="built_in">string</span>&gt; IconTextProperty = AvaloniaProperty.Register&lt;IconButton, <span class="built_in">string</span>&gt;(</span><br><span class="line">        <span class="keyword">nameof</span>(IconText));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是 IconText 属性的常规 C# 包装器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> IconText</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> =&gt; GetValue(IconTextProperty);</span><br><span class="line">        <span class="keyword">set</span> =&gt; SetValue(IconTextProperty, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-Styles-AppDefaultStyles-axaml"><a href="#7-3-Styles-AppDefaultStyles-axaml" class="headerlink" title="7.3 Styles\AppDefaultStyles.axaml"></a>7.3 Styles\AppDefaultStyles.axaml</h3><p><strong>关键修改点解释：</strong></p>
<ol>
<li><code>:is(Button)</code> 选择器<ul>
<li><strong>用途</strong>：我们将之前所有针对 <code>Button</code> 的样式选择器，例如 <code>Style Selector=&quot;Button&quot;</code>，都修改为了 <code>Style Selector=&quot;:is(Button)&quot;</code>。</li>
<li><strong>原因</strong>：<code>:is()</code> 是一个伪类选择器，它会匹配所有符合括号内条件的控件。<code>:is(Button)</code> 不仅会匹配标准的 <code>&lt;Button&gt;</code>，还会匹配任何<strong>继承</strong>自 <code>Button</code> 的控件。因为我们的 <code>IconButton</code> 继承自 <code>Button</code>，所以这个修改可以确保我们为普通按钮编写的通用样式（如圆角、字体大小、颜色等）也能自动应用到 <code>IconButton</code> 上，保持了应用的视觉统一性。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">&lt;Styles xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;&gt;</span><br><span class="line">    &lt;Design.PreviewWith&gt;</span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot; Width=&quot;200&quot;&gt;</span><br><span class="line">            &lt;!-- 此处预览代码未更改 --&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;200&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE2C2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE346;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE7F2;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE3EE;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xEB7A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button HorizontalAlignment=&quot;Stretch&quot;&gt;</span><br><span class="line">                        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;icon&quot; Content=&quot;&amp;#xE03A;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                            &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                        &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                    &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/Button&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Design.PreviewWith&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 未更改的样式 --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Window&quot;&gt;</span><br><span class="line">        &lt;!-- &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt; --&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Border&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">            &lt;Transitions&gt;</span><br><span class="line">                &lt;DoubleTransition Property=&quot;Width&quot; Duration=&quot;0:0:1&quot;&gt;&lt;/DoubleTransition&gt;</span><br><span class="line">            &lt;/Transitions&gt;</span><br><span class="line">        &lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon, Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor-Fill&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0 2 5 0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;19&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Margin&quot; Value=&quot;0&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;Button, Label.akko&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource AkkoPro&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 关键修改：将 &quot;Button&quot; 选择器改为 &quot;:is(Button)&quot;，以使其能应用到 IconButton --&gt;</span><br><span class="line">    &lt;Style Selector=&quot;:is(Button)&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontSize&quot; Value=&quot;20&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;CornerRadius&quot; Value=&quot;10&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button) /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Setter Property=&quot;Transitions&quot;&gt;</span><br><span class="line">            &lt;Transitions&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Foreground&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;BrushTransition Property=&quot;Background&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/BrushTransition&gt;</span><br><span class="line">                &lt;TransformOperationsTransition Property=&quot;RenderTransform&quot; Duration=&quot;0:0:0.1&quot;&gt;&lt;/TransformOperationsTransition&gt;</span><br><span class="line">            &lt;/Transitions&gt;</span><br><span class="line">        &lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button).transparent:pointerover Label&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;RenderTransform&quot; Value=&quot;scale(1.2)&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button):pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Foreground&quot; Value=&quot;&#123;DynamicResource PrimaryHoverForeground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryHoverBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button).active /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;&#123;DynamicResource PrimaryActiveBackground&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button).transparent&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    &lt;Style Selector=&quot;:is(Button).transparent Label.icon-only&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;FontFamily&quot; Value=&quot;&#123;DynamicResource Phosphor&#125;&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Style Selector=&quot;:is(Button).transparent:pointerover /template/ ContentPresenter&quot;&gt;</span><br><span class="line">        &lt;Setter Property=&quot;Background&quot; Value=&quot;Transparent&quot;&gt;&lt;/Setter&gt;</span><br><span class="line">    &lt;/Style&gt;</span><br><span class="line">&lt;/Styles&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-App-axaml"><a href="#7-4-App-axaml" class="headerlink" title="7.4 App.axaml"></a>7.4 App.axaml</h3><p><strong>关键修改点解释：</strong></p>
<ol>
<li><code>&lt;MergeResourceInclude Source=&quot;/Controls/IconButton.axaml&quot;/&gt;</code><ul>
<li><strong>用途</strong>：这行代码的作用是将我们刚刚创建的 <code>IconButton.axaml</code> 文件（它是一个资源字典）合并到应用的主资源中。</li>
<li><strong>原因</strong>：如果不进行这一步，整个应用程序将不知道 <code>IconButton</code> 的样式定义在哪里，导致 <code>IconButton</code> 无法被正确渲染，会显示为一个没有样式的空白控件。这一步使得 <code>IconButton</code> 的主题在整个应用范围内都是可用的。</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;Application xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.App&quot;</span><br><span class="line">             xmlns:local=&quot;clr-namespace:AvaloniaApplication2&quot;</span><br><span class="line">             RequestedThemeVariant=&quot;Default&quot;&gt;</span><br><span class="line">             &lt;!-- &quot;Default&quot; ThemeVariant follows system theme variant. &quot;Dark&quot; or &quot;Light&quot; are other available options. --&gt;</span><br><span class="line"></span><br><span class="line">     &lt;Application.DataTemplates&gt;</span><br><span class="line">         &lt;local:ViewLocator&gt;&lt;/local:ViewLocator&gt;</span><br><span class="line">     &lt;/Application.DataTemplates&gt;</span><br><span class="line">             </span><br><span class="line">    &lt;Application.Styles&gt;</span><br><span class="line">        &lt;FluentTheme /&gt;</span><br><span class="line">        &lt;StyleInclude Source=&quot;Styles/AppDefaultStyles.axaml&quot;&gt;&lt;/StyleInclude&gt;</span><br><span class="line">    &lt;/Application.Styles&gt;</span><br><span class="line">     </span><br><span class="line">     &lt;!-- 在这里添加了对 IconButton 样式文件的引用 --&gt;</span><br><span class="line">     &lt;Application.Resources&gt;</span><br><span class="line">         &lt;ResourceDictionary&gt;</span><br><span class="line">             &lt;ResourceDictionary.MergedDictionaries&gt;</span><br><span class="line">                 &lt;!-- 这行代码将 IconButton.axaml 中定义的样式合并到整个应用中 --&gt;</span><br><span class="line">                 &lt;MergeResourceInclude Source=&quot;/Controls/IconButton.axaml&quot;&gt;&lt;/MergeResourceInclude&gt;</span><br><span class="line">             &lt;/ResourceDictionary.MergedDictionaries&gt;</span><br><span class="line">         &lt;/ResourceDictionary&gt;</span><br><span class="line">         &lt;!-- 此处其他资源未更改 --&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryForeground&quot;&gt;#CFCFCF&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryBackground&quot;&gt;#14172D&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;LinearGradientBrush x:Key=&quot;PrimaryBackgroundGradient&quot; StartPoint=&quot;0%, 0%&quot; EndPoint=&quot;100%, 0%&quot;&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;0&quot; Color=&quot;#111214&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">             &lt;GradientStop Offset=&quot;1&quot; Color=&quot;#151E3E&quot;&gt;&lt;/GradientStop&gt;</span><br><span class="line">         &lt;/LinearGradientBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverBackground&quot;&gt;#333B5A&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryActiveBackground&quot;&gt;#6633dd&lt;/SolidColorBrush&gt;</span><br><span class="line">         &lt;SolidColorBrush x:Key=&quot;PrimaryHoverForeground&quot;&gt;White&lt;/SolidColorBrush&gt;</span><br><span class="line">         </span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoPro&quot;&gt;/Assets/Fonts/AkkoPro-Regular.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;AkkoProBold&quot;&gt;/Assets/Fonts/AkkoPro-Bold.ttf#Akko Pro&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor&quot;&gt;/Assets/Fonts/Phosphor.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line">         &lt;FontFamily x:Key=&quot;Phosphor-Fill&quot;&gt;/Assets/Fonts/Phosphor-Fill.ttf#Phosphor&lt;/FontFamily&gt;</span><br><span class="line">     &lt;/Application.Resources&gt;</span><br><span class="line">&lt;/Application&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-5-App-axaml-cs"><a href="#7-5-App-axaml-cs" class="headerlink" title="7.5 App.axaml.cs"></a>7.5 App.axaml.cs</h3><p><strong>关键修改点解释：</strong></p>
<ol>
<li><code>[assembly: XmlnsDefinition(...)]</code><ul>
<li><strong>用途</strong>：这是一个程序集级别的特性（Attribute），它将一个 C# 命名空间（<code>AvaloniaApplication2.Controls</code>）映射到一个 XML 命名空间（<code>https://github.com/avaloniaui</code>）。</li>
<li><strong>原因</strong>：这是一个非常有用的“语法糖”。添加它之后，我们就可以在 XAML 中直接使用 <code>&lt;IconButton /&gt;</code>，而不需要先在文件顶部定义一个像 <code>xmlns:c=&quot;clr-namespace:AvaloniaApplication2.Controls&quot;</code> 这样的前缀，然后再使用 <code>&lt;c:IconButton /&gt;</code>。它让我们的自定义控件使用起来和 Avalonia 的内置控件一样方便、自然。</li>
</ul>
</li>
</ol>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Avalonia;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Controls.ApplicationLifetimes;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Markup.Xaml;</span><br><span class="line"><span class="keyword">using</span> Avalonia.Metadata; <span class="comment">// 需要引入这个命名空间</span></span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Data;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.Factories;</span><br><span class="line"><span class="keyword">using</span> AvaloniaApplication2.ViewModels;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键：添加这个程序集特性，让我们可以不带前缀地在 XAML 中使用 IconButton</span></span><br><span class="line">[<span class="meta">assembly: XmlnsDefinition(<span class="string">&quot;https://github.com/avaloniaui&quot;</span>, <span class="string">&quot;AvaloniaApplication2.Controls&quot;</span>)</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">AvaloniaApplication2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">App</span> : <span class="title">Application</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 此文件中的其他代码在本节教程中未发生变更</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Initialize</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        AvaloniaXamlLoader.Load(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnFrameworkInitializationCompleted</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> collection = <span class="keyword">new</span> ServiceCollection();</span><br><span class="line">        collection.AddSingleton&lt;MainViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;ActionsPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;HomePageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;MacrosPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;ProcessPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;ReporterPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;HistoryPageViewModel&gt;();</span><br><span class="line">        collection.AddTransient&lt;SettingsPageViewModel&gt;();</span><br><span class="line"></span><br><span class="line">        collection.AddSingleton&lt;Func&lt;ApplicationPageNames, PageViewModel&gt;&gt;(x =&gt; name =&gt; name <span class="keyword">switch</span></span><br><span class="line">        &#123;</span><br><span class="line">            ApplicationPageNames.Home =&gt; x.GetRequiredService&lt;HomePageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Process =&gt; x.GetRequiredService&lt;ProcessPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Macros =&gt; x.GetRequiredService&lt;MacrosPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Actions =&gt; x.GetRequiredService&lt;ActionsPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Reporter =&gt; x.GetRequiredService&lt;ReporterPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.History =&gt; x.GetRequiredService&lt;HistoryPageViewModel&gt;(),</span><br><span class="line">            ApplicationPageNames.Settings =&gt; x.GetRequiredService&lt;SettingsPageViewModel&gt;(),</span><br><span class="line">            _ =&gt; <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException()</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        collection.AddSingleton&lt;PageFactory&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> services = collection.BuildServiceProvider();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (ApplicationLifetime <span class="keyword">is</span> IClassicDesktopStyleApplicationLifetime desktop)</span><br><span class="line">        &#123;</span><br><span class="line">            desktop.MainWindow = <span class="keyword">new</span> MainView</span><br><span class="line">            &#123;</span><br><span class="line">                DataContext = services.GetService&lt;MainViewModel&gt;()</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">base</span>.OnFrameworkInitializationCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-6-Views-MainView-axaml"><a href="#7-6-Views-MainView-axaml" class="headerlink" title="7.6 Views\MainView.axaml"></a>7.6 Views\MainView.axaml</h3><p><strong>关键修改点解释：</strong></p>
<ul>
<li><strong>替换为 <code>&lt;IconButton&gt;</code></strong>：这里是应用我们新控件最直观的地方。之前所有左侧菜单的按钮都是由 <code>&lt;Button&gt;&lt;StackPanel&gt;&lt;Label/&gt;&lt;Label/&gt;&lt;/StackPanel&gt;&lt;/Button&gt;</code> 这样的复杂结构组成的。</li>
<li><strong>简化XAML</strong>：现在，我们用一行简洁的 <code>&lt;IconButton&gt;</code> 就完成了同样的功能。图标通过 <code>IconText</code> 属性设置，而需要折叠的文字 <code>Label</code> 则直接作为 <code>IconButton</code> 的内容（Content）传入。这使得 XAML 代码大大减少，并且更易于阅读和维护。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;Window xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">        mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1400&quot; d:DesignHeight=&quot;800&quot;</span><br><span class="line">        Width=&quot;1400&quot; Height=&quot;800&quot;</span><br><span class="line">        MinWidth=&quot;1400&quot; MinHeight=&quot;800 &quot;</span><br><span class="line">        x:Class=&quot;AvaloniaApplication2.MainView&quot;</span><br><span class="line">        xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">        xmlns:view=&quot;clr-namespace:AvaloniaApplication2.Views&quot;</span><br><span class="line">        x:DataType=&quot;vm:MainViewModel&quot;</span><br><span class="line">        Title=&quot;AvaloniaApplication2&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:MainViewModel&gt;&lt;/vm:MainViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Grid Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot; ColumnDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;ContentControl Grid.Column=&quot;1&quot; Content=&quot;&#123;Binding CurrentPage&#125;&quot; /&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;Border Padding=&quot;20&quot; Background=&quot;&#123;DynamicResource PrimaryBackgroundGradient&#125;&quot;&gt;</span><br><span class="line">            &lt;Grid RowDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                &lt;StackPanel Spacing=&quot;12&quot;&gt;</span><br><span class="line">                    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage /Assets/Images/logo.svg&#125;&quot; Width=&quot;220&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    &lt;Image PointerPressed=&quot;InputElement_OnPointerPressed&quot; Source=&quot;&#123;SvgImage /Assets/Images/icon.svg&#125;&quot; Width=&quot;22&quot; IsVisible=&quot;&#123;Binding !SideMenuExpanded&#125;&quot;&gt;&lt;/Image&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;!-- 关键修改：将原来的复杂 Button 结构替换为简洁的 IconButton --&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE2C2;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding HomePageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToHomeCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;Home&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE346;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ProcessPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToProcessCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;Process&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE7F2;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ActionsPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToActionsCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;Actions&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE3EE;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding MacrosPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToMacrosCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;Macros&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xEB7A;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding ReporterPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToReporterCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;Reporter&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE03A;&quot; HorizontalAlignment=&quot;Stretch&quot; Classes.active=&quot;&#123;Binding HistoryPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToHistoryCommand&#125;&quot;&gt;</span><br><span class="line">                        &lt;Label Classes=&quot;akko&quot; Content=&quot;History&quot; IsVisible=&quot;&#123;Binding SideMenuExpanded&#125;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                    &lt;/IconButton&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;!-- 这个设置按钮未在本节修改，但因为它也是Button，所以会受到 :is(Button) 样式的影响 --&gt;</span><br><span class="line">                &lt;Button Classes=&quot;transparent&quot; Grid.Row=&quot;1&quot; Classes.active=&quot;&#123;Binding SettingsPageIsActive&#125;&quot; Command=&quot;&#123;Binding GoToSettingsCommand&#125;&quot;&gt;</span><br><span class="line">                    &lt;Label Classes=&quot;icon-only&quot; Content=&quot;&amp;#xE272;&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;/Button&gt;</span><br><span class="line">            &lt;/Grid&gt;</span><br><span class="line">        &lt;/Border&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">&lt;/Window&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-7-Views-SettingsPageView-axaml"><a href="#7-7-Views-SettingsPageView-axaml" class="headerlink" title="7.7 Views\SettingsPageView.axaml"></a>7.7 Views\SettingsPageView.axaml</h3><p>与 <code>MainView</code> 类似，<code>SettingsPageView</code> 中的所有带图标的按钮也被替换成了我们新的 <code>IconButton</code>。</p>
<p><strong>关键修改点解释：</strong></p>
<ul>
<li><strong>代码简化</strong>：这里的修改效果更加明显。对于那些内容只是简单文本的按钮，例如“Release License”，之前的XAML结构被极大地简化了。</li>
<li><strong>统一接口</strong>：现在，无论是只需要文本的按钮，还是需要图标+文本的按钮，我们都使用同一个 <code>IconButton</code> 控件，通过 <code>IconText</code> 和 <code>Content</code> 属性来控制其显示，使得API非常统一和清晰。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;UserControl xmlns=&quot;https://github.com/avaloniaui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br><span class="line">             xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br><span class="line">             xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br><span class="line">             xmlns:vm=&quot;clr-namespace:AvaloniaApplication2.ViewModels&quot;</span><br><span class="line">             mc:Ignorable=&quot;d&quot; d:DesignWidth=&quot;1100&quot; d:DesignHeight=&quot;900&quot;</span><br><span class="line">             Background=&quot;&#123;DynamicResource PrimaryBackground&#125;&quot;</span><br><span class="line">             Foreground=&quot;&#123;DynamicResource PrimaryForeground&#125;&quot;</span><br><span class="line">             x:DataType=&quot;vm:SettingsPageViewModel&quot;</span><br><span class="line">             x:Class=&quot;AvaloniaApplication2.Views.SettingsPageView&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Design.DataContext&gt;&lt;vm:SettingsPageViewModel&gt;&lt;/vm:SettingsPageViewModel&gt;&lt;/Design.DataContext&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Grid ColumnDefinitions=&quot;*, *&quot; RowDefinitions=&quot;Auto, *&quot;&gt;</span><br><span class="line">        &lt;!-- Header 未更改 --&gt;</span><br><span class="line">        &lt;Grid Name=&quot;HeaderGrid&quot; Grid.ColumnSpan=&quot;2&quot;&gt;</span><br><span class="line">            &lt;Image Source=&quot;&#123;SvgImage /Assets/Images/background-settings.svg&#125;&quot; Height=&quot;160&quot; Stretch=&quot;UniformToFill&quot;&gt;&lt;/Image&gt;</span><br><span class="line">            &lt;StackPanel HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot;&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Settings&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Version 3.0.0.2 Beta&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Label HorizontalAlignment=&quot;Center&quot; Content=&quot;Compiled Jul 07 2025&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Left side content --&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;0&quot; Grid.Row=&quot;1&quot; Spacing=&quot;10&quot; Margin=&quot;15&quot;&gt;</span><br><span class="line">            &lt;!-- General --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;General&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, Auto&quot; RowDefinitions=&quot;Auto, Auto, Auto&quot;&gt;</span><br><span class="line">                    &lt;!-- Release license --&gt;</span><br><span class="line">                    &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;Remove license of BatchProcess from this machine and release the license back to the server ready to be transferred to another machine.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;!-- 关键修改：替换为 IconButton --&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE2FE;&quot; Content=&quot;Release License&quot; Grid.Row=&quot;0&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;!-- Skip Files --&gt;</span><br><span class="line">                    &lt;TextBlock Grid.Row=&quot;1&quot; Grid.Column=&quot;0&quot; TextWrapping=&quot;Wrap&quot; Text=&quot;Skip files if only Open, Save (Optional) and Close are Valid actions.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;CheckBox Grid.Row=&quot;1&quot; Grid.Column=&quot;1&quot;&gt;&lt;/CheckBox&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;!-- Duplicate Entries --&gt;</span><br><span class="line">                    &lt;TextBlock Grid.Row=&quot;2&quot; Grid.Column=&quot;0&quot; TextWrapping=&quot;Wrap&quot; Text=&quot;Allow duplicate entries of the same file in project list&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                    &lt;CheckBox Grid.Row=&quot;2&quot; Grid.Column=&quot;1&quot;&gt;&lt;/CheckBox&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;!-- Location --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;Location&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, Auto&quot;&gt;</span><br><span class="line">                    &lt;StackPanel&gt;</span><br><span class="line">                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;Add or remove the locations to search for Reporter Templates, Macros, Actions and other custom files or templates.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                        &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;All sub-directories will be searched automatically&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                        </span><br><span class="line">                        </span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;Button Grid.Column=&quot;1&quot; Content=&quot;+ Folder&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/Button&gt;</span><br><span class="line">                    </span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">                &lt;ListBox ItemsSource=&quot;&#123;Binding LocationPaths&#125;&quot;&gt;</span><br><span class="line">                    </span><br><span class="line">                &lt;/ListBox&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Right Side Content --&gt;</span><br><span class="line">        &lt;StackPanel Grid.Column=&quot;1&quot; Grid.Row=&quot;1&quot; Spacing=&quot;10&quot; Margin=&quot;15&quot;&gt;</span><br><span class="line">            &lt;!-- SolidWorks Host (未更改) --&gt;</span><br><span class="line">            &lt;StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;SolidWorks Host&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot;&gt;</span><br><span class="line">                    BatchProcess can work locally on the current machine, or on any machine accessible</span><br><span class="line">                    over the network or even internet.&lt;LineBreak /&gt;&lt;LineBreak /&gt;</span><br><span class="line">                    </span><br><span class="line">                    Enter the machines IP address, network name or localhost for this machine.</span><br><span class="line">                &lt;/TextBlock&gt;</span><br><span class="line">                &lt;ComboBox&gt;&lt;/ComboBox&gt;</span><br><span class="line">                &lt;Label Content=&quot;Connection established&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            &lt;!-- PDM Enterprise --&gt;</span><br><span class="line">            &lt;StackPanel Spacing=&quot;15&quot;&gt;</span><br><span class="line">                &lt;Label Content=&quot;PDM Enterprise&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot; Text=&quot;If you are using PDM Enterprise enter the credentials below and test login. BatchProcess can then automatically handle checking in and out files from PDM Enterprise.&quot;&gt;&lt;/TextBlock&gt;</span><br><span class="line">                &lt;Grid ColumnDefinitions=&quot;*, *, *&quot;&gt;</span><br><span class="line">                    &lt;ComboBox HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/ComboBox&gt;</span><br><span class="line">                    &lt;TextBox Grid.Column=&quot;1&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                    &lt;TextBox Grid.Column=&quot;2&quot;&gt;&lt;/TextBox&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">                &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                    &lt;!-- 关键修改：替换为 IconButton --&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE23E;&quot; Content=&quot;Login&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE094;&quot; Content=&quot;Refresh Vault&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">                &lt;Label Content=&quot;Connection Established&quot;&gt;&lt;/Label&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">            &lt;!-- Setting Cache --&gt;</span><br><span class="line">            &lt;StackPanel Spacing=&quot;15&quot;&gt;</span><br><span class="line">                &lt;Label Content=&quot;Setting Cache&quot;&gt;&lt;/Label&gt;</span><br><span class="line">                &lt;TextBlock TextWrapping=&quot;Wrap&quot;&gt;</span><br><span class="line">                    Various settings are stored locally including Processes, Actions, Macros, Reports and History. &lt;LineBreak /&gt;&lt;LineBreak /&gt;</span><br><span class="line">                    If you are experiencing issues you can try clearing the cache (this won&#x27;t remove the license).</span><br><span class="line">                &lt;/TextBlock&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;</span><br><span class="line">                    &lt;!-- 关键修改：替换为 IconButton --&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xEC54;&quot; Content=&quot;Clear Cache&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE5DE;&quot; Content=&quot;Export Cache&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                    &lt;IconButton IconText=&quot;&amp;#xE20C;&quot; Content=&quot;Import Cache&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Stretch&quot;&gt;&lt;/IconButton&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/StackPanel&gt;</span><br><span class="line">        &lt;/StackPanel&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-8-当前目录结构"><a href="#7-8-当前目录结构" class="headerlink" title="7.8 当前目录结构"></a>7.8 当前目录结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">│  App.axaml</span><br><span class="line">│  App.axaml.cs</span><br><span class="line">│  app.manifest</span><br><span class="line">│  AvaloniaApplication2.csproj</span><br><span class="line">│  Program.cs</span><br><span class="line">│  ViewLocator.cs</span><br><span class="line">│</span><br><span class="line">├─Assets</span><br><span class="line">│  ├─Fonts</span><br><span class="line">│  │      AkkoPro-Bold.ttf</span><br><span class="line">│  │      AkkoPro-Regular.ttf</span><br><span class="line">│  │      Phosphor-Fill.ttf</span><br><span class="line">│  │      Phosphor.ttf</span><br><span class="line">│  │</span><br><span class="line">│  └─Images</span><br><span class="line">│          background-actions.svg</span><br><span class="line">│          background-settings.svg</span><br><span class="line">│          icon.svg</span><br><span class="line">│          logo.svg</span><br><span class="line">│</span><br><span class="line">├─Controls</span><br><span class="line">│      IconButton.axaml</span><br><span class="line">│      IconButton.axaml.cs</span><br><span class="line">│</span><br><span class="line">├─Data</span><br><span class="line">│      ApplicationPageNames.cs</span><br><span class="line">│</span><br><span class="line">├─Factories</span><br><span class="line">│      PageFactory.cs</span><br><span class="line">│</span><br><span class="line">├─Styles</span><br><span class="line">│      AppDefaultStyles.axaml</span><br><span class="line">│</span><br><span class="line">├─ViewModels</span><br><span class="line">│      ActionsPageViewModel.cs</span><br><span class="line">│      HistoryPageViewModel.cs</span><br><span class="line">│      HomePageViewModel.cs</span><br><span class="line">│      MacrosPageViewModel.cs</span><br><span class="line">│      MainViewModel.cs</span><br><span class="line">│      PageViewModel.cs</span><br><span class="line">│      ProcessPageViewModel.cs</span><br><span class="line">│      ReporterPageViewModel.cs</span><br><span class="line">│      SettingsPageViewModel.cs</span><br><span class="line">│      ViewModelBase.cs</span><br><span class="line">│</span><br><span class="line">└─Views</span><br><span class="line">        ActionsPageView.axaml</span><br><span class="line">        ActionsPageView.axaml.cs</span><br><span class="line">        HistoryPageView.axaml</span><br><span class="line">        HistoryPageView.axaml.cs</span><br><span class="line">        HomePageView.axaml</span><br><span class="line">        HomePageView.axaml.cs</span><br><span class="line">        MacrosPageView.axaml</span><br><span class="line">        MacrosPageView.axaml.cs</span><br><span class="line">        MainView.axaml</span><br><span class="line">        MainView.axaml.cs</span><br><span class="line">        ProcessPageView.axaml</span><br><span class="line">        ProcessPageView.axaml.cs</span><br><span class="line">        ReporterPageView.axaml</span><br><span class="line">        ReporterPageView.axaml.cs</span><br><span class="line">        SettingsPageView.axaml</span><br><span class="line">        SettingsPageView.axaml.cs</span><br></pre></td></tr></table></figure>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="../../../../about" rel="external nofollow noreferrer">时代的寒流</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://gao-hongfei123.github.io">http://gao-hongfei123.github.io</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="../../../../about" target="_blank">时代的寒流</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="../../../../libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="../../../../libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="../../../../medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="../../../../medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="../blazor%E5%AD%A6%E4%B9%A0/">
                    <div class="card-image">
                        
                        
                        <img src="../../../../medias/featureimages/2.jpg" class="responsive-img" alt="blazor">
                        
                        <span class="card-title">blazor</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Blazor Server 托管模型具有以下优点：（网页文件都是cshtml类型，因为是服务端渲染）

下载项大小明显小于 Blazor WebAssembly 应用，且应用加载速度快得多。
支持瘦客户端。 例如，Blazor Server
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2026-01-29
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            时代的寒流
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="../../28/csharp%E5%AD%A6%E4%B9%A0/">
                    <div class="card-image">
                        
                        
                        <img src="../../../../medias/featureimages/17.jpg" class="responsive-img" alt="csharp语法">
                        
                        <span class="card-title">csharp语法</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            vs设置vs中F6键：生成语法错误，可以定位到错误位置。
输出快捷键：cw+两次tab键 ，foreach快捷键，foreach +两次tab键
构造器快捷键：ctor+两次tab键
快速创建属性的快捷键：porp+两次tab键
激活key
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2026-01-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            时代的寒流
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="../../../../libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="../../../../libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="../../../../libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="../../../../libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="../../../../libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="../../../../libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="../../../../libs/aplayer/APlayer.min.js"></script>
<script src="../../../../libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2016-2026</span>
            
            <a href="../../../../about" target="_blank">时代的寒流</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="../../../../atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('../../../../search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="../../../../libs/materialize/materialize.min.js"></script>
    <script src="../../../../libs/masonry/masonry.pkgd.min.js"></script>
    <script src="../../../../libs/aos/aos.js"></script>
    <script src="../../../../libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="../../../../libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="../../../../js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="../../../../libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="../../../../libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="../../../../libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="../../../../libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
